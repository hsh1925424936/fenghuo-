define(["webuploader"],function(e){"use strict";function i(e){var i=$.extend(!0,{},e,{auto:e.auto===!1?e.auto:!0,fileVal:e.fileVal?e.fileVal:"file",swf:r+"plugins/webuploader/Uploader.swf",server:e.server?e.server:"http://up.qiniu.com/",pick:e.pick,accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/*"},fileNumLimit:e.fileNumLimit,resize:!1,formData:e.formData?e.formData:{}});if(i.crop)return require(["cropper"],function(){var e=function(){function s(e,t){typeof r=="undefined"&&function(){var t=new Image,n=!0;t.onload=t.onerror=function(){if(this.width!=1||this.height!=1)n=!1},t.src=e,r=n}(),r?t(e):$.ajax("../../server/preview.php",{method:"POST",data:e,dataType:"json"}).done(function(e){e.result?t(e.result):alert("Ԥ������")})}var e=$(".cropper-wraper"),t=e.find(".img-container img"),n=$(".upload-btn"),r,i;return t.cropper({aspectRatio:16/9,preview:".img-preview",done:function(e){}}),n.on("click",function(){return i&&i(t.cropper("getData")),!1}),{setSource:function(n){return s(n,function(e){t.cropper("setImgSrc",e)}),e.removeClass("webuploader-element-invisible"),this},getImageSize:function(){var e=t.get(0);return{width:e.naturalWidth,height:e.naturalHeight}},setCallback:function(e){return i=e,this},disable:function(){return t.cropper("disable"),this},enable:function(){return t.cropper("enable"),this}}}(),t=$(".uploader-container");n.init(function(r){e.setSource(r),t.addClass("webuploader-element-invisible"),e.setCallback(function(e){n.crop(e),n.upload()})})}),n.register({"before-send-file":"cropImage"},{cropImage:function(e){var n=e._cropData,r,i;return e=this.request("get-file",e),i=t.Deferred(),r=new t.Lib.Image,i.always(function(){r.destroy(),r=null}),r.once("error",i.reject),r.once("load",function(){r.crop(n.x,n.y,n.width,n.height,n.scale)}),r.once("complete",function(){var t,n;try{t=r.getAsBlob(),n=e.size,e.source=t,e.size=t.size,e.trigger("resize",t.size,n),i.resolve()}catch(s){console.log(s),i.resolve()}}),e._info&&r.info(e._info),e._meta&&r.meta(e._meta),r.loadFromBlob(e.source),i.promise()}}),new n(i);var s=t.create(i);return s}var t=e,n=t.Uploader,r=window.path?window.path+"/oasisl/js/":"/oasisl/js/";return{getImgUploader:i,Webuploader:t}});