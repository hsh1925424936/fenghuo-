define(["oasisUf","tpl/pagin/pagin","util","oasDropdown"],function(e,t,n){"use strict";$.oasUiFactory("oasPagin",{VERSION:"1.0.0",options:{type:"normal",size:"normal",showMsg:!0,current:1,total:null,pageItems:10,customPageItems:[10,20,50],skipto:!0,setPageItems:!0,displayStyle:[2,3,2]},_create:function(){var e=this.options,t=this;this.$el.addClass("oas-pagin clearfix").addClass("pagination-"+e.size),this._preRenderData()},events:{"focus input":function(e,t){$(e).val(this.current),$(e).select()},"blur input":function(e,t){if($(e).hasClass("oas-disabled"))return!1;var r=parseInt(n.DBC2SBC($(e).val()));r!=this.current&&r>0&&r<=this.totalPages?this._setCurrentPagin(r):$(e).val("")},"click .pagin-no":function(e,t){var n=parseInt($(e).text(),10);this._setCurrentPagin(n)},"keypress input":function(e,t){var n;t.keyCode===13&&$(e).trigger("blur")},"click .pagin-btn":function(e,t){if($(e).hasClass("disabled"))return!1;$(e).hasClass("homepage")?this._setCurrentPagin(1):$(e).hasClass("prev")?this._prevPagin():$(e).hasClass("next")&&this._nextPagin()},"click .dropdown-menu>li":function(e,t){var n=+$(e).find("a").text().match(/[0-9][0-9]/g)[0],r=this;setTimeout(function(){r._iCall("pageItems",[n]),r._emit("pageItemsChange",[n,r.current])},0)}},_prevPagin:function(){var e=this,t;this.current>1&&(t=parseInt(this.current,10)-1,setTimeout(function(){e._setCurrentPagin(t)},0))},_nextPagin:function(){var e=this,t;this.current<this.totalPages&&(t=parseInt(this.current,10)+1,setTimeout(function(){e._setCurrentPagin(t)},0))},_preRenderData:function(){if(this.options.total===null)return;var e=this.options,t={},n=this.total!==undefined?this.total:e.total,r=this.options.pageItems||(this.options.pageItems=e.customPageItems[0]),i=this.totalPages=Math.ceil(n/r),s=this.current||(this.current=e.current),o=r*(s-1)+1,u=r*s,a=this._paginList();if(+n===0){this.$el.hide();return}this.$el.show(),this._renderData=t={total:n,pageItems:r,totalPages:i,current:s,startItems:o,endItems:u,setPageItems:e.setPageItems,skipto:e.skipto,list:a,showMsg:e.showMsg,type:e.type,customPageItems:e.customPageItems},this._createDom()},_setCurrentPagin:function(e,t){if(this.current===e)return;this.current=e,this._preRenderData(),t!==!1&&this._emit("pageNoChange",[e,this.options.pageItems])},_paginList:function(){var e=this.options,t=this._getInterval(),n=e.displayStyle,r=[];if(t[0]>0&&n[2]>0){var i=Math.min(n[2],t[0]);for(var s=0;s<i;s++)this._addToPaginList(r,s);n[2]<t[0]&&r.push("...")}for(var s=t[0];s<t[1];s++)this._addToPaginList(r,s);if(t[1]<this.totalPages&&n[2]>0){this.totalPages-n[2]>t[1]&&r.push("...");var o=Math.max(this.totalPages-n[2],t[1]);for(var s=o;s<this.totalPages;s++)this._addToPaginList(r,s)}return r},_getInterval:function(){var e=this.current-1,t=this.options,n=t.displayStyle,r=parseInt(n[1])+parseInt(n[2]),i=this.totalPages,s=i-n[1],o=e+1>=r?Math.max(Math.min(parseInt(e)+2-n[1],s),0):0,u=e+1>=r?Math.min(parseInt(e)+2,i):Math.min(r,i);return[o,u]},_addToPaginList:function(e,t){t=t<0?0:t<this.totalPages?t:this.totalPages-1,t++,e.push(t)},_createDom:function(){var e=t(this._renderData);this.$el.find('[data-toggle="oasDropdown"]').oasDropdown("destroy"),this.$el.empty().html(e),this.$el.find('[data-toggle="oasDropdown"]').oasDropdown({})},invoke:{total:function(e){this.options.total=this.total=e,this._preRenderData()},pageItems:function(e){this.options.pageItems=e,this.totalPages=Math.ceil(this.total/e),this.current>this.totalPages&&this.totalPages>0&&(this.current=this.totalPages,this._emit("pageNoChange",[this.current,this.options.pageItems])),this._preRenderData()},current:function(e){if(!e||!(e<=this.totalPages))return this.current;this._setCurrentPagin(e,!1)},jumpTo:function(e){if(!e||!(e<=this.totalPages))return this.current;this._setCurrentPagin(e)}}})});