define(["oasisUf"],function(e){"use strict";$.oasUiFactory("oasScrollspy",{VERSION:"1.0.0",options:{target:"",offset:10,activeTarget:null},_create:function(){this.$body=$(document.body),this.$scrollElement=this.$el.is(document.body)?$(window):this.$el,this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.scrollHeight=0,this.$scrollElement.on("scroll.oasScrollspy",$.proxy(this._process,this)),this._refresh(),this._process()},_getScrollHeight:function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},_refresh:function(){var e=this.options,t=this,n="offset",r=0;this.offsets=[],this.targets=[],this.scrollHeight=this._getScrollHeight(),$.isWindow(this.$scrollElement[0])||(n="position",r=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var e=$(this),t=e.data("target")||e.attr("href"),i=/^#./.test(t)&&$(t);return i&&i.length&&i.is(":visible")&&[[i[n]().top+r,t]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},_process:function(){var e=this.$scrollElement.scrollTop()+this.options.offset,t=this._getScrollHeight(),n=this.options.offset+t-this.$scrollElement.height(),r=this.offsets,i=this.targets,s=this.options.activeTarget,o;this.scrollHeight!=t&&this._refresh();if(e>=n)return s!=(o=i[i.length-1])&&this._activate(o);if(s&&e<r[0])return this._clear();for(o=r.length;o--;)s!=i[o]&&e>=r[o]&&(r[o+1]===undefined||e<r[o+1])&&this._activate(i[o])},_activate:function(e){var t=this.options;this._clear(),this.options.activeTarget=e;var n=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',r=$(n).parents("li").addClass("active");r.parent(".dropdown-menu").length&&(r=r.closest("li.dropdown").addClass("active")),r.trigger("activate.oasScrollspy")},_clear:function(){$(this.selector).parentsUntil(this.options.target,".active").removeClass("active"),this.options.activeTarget=null},invoke:{refresh:function(){this._refresh(),this._process()},cancel:function(){this.$scrollElement.off("scroll.oasScrollspy"),this._clear()},yes:function(){this.$scrollElement.on("scroll.oasScrollspy",$.proxy(this._process,this)),this._iCall("refresh")}}}),$("[oasScrollspy]").oasScrollspy({})});