define(["oasisUf","Position"],function(e,t){"use strict";function s(e){$.each(oasOverlay.blurOverlays,function(t,n){if(!n||!n.visible)return;if(!n.options.blurHide)return;for(var r=0,i=n._relativeElements.length;r<i;r++)if(!!n._relativeElements[r].size()&&$.contains($("body")[0],$(n._relativeElements[r])[0]))if(n._relativeElements[r].selector)if(n._relativeElements[r].size()==$(n._relativeElements[r].selector).size())for(var s=0,o=n._relativeElements[r].length;s<o;s++){var u=$(n._relativeElements[r][s])[0];if(u===e.target||$.contains(u,e.target))return}else{var a=$(n._relativeElements[r].selector);if(!!a.size())for(var f=0,l=a.length;f<l;f++){var u=$(a[f])[0];if(u===e.target||$.contains(u,e.target))return}}else for(var s=0,o=n._relativeElements[r].length;s<o;s++){var u=$(n._relativeElements[r][s])[0];if(u===e.target||$.contains(u,e.target))return}else{var u=$(n._relativeElements[r])[0];if(u==undefined||u==null||!$.contains($("body")[0],u)){var a=$(n._relativeElements[r].selector);if(!!a.size())for(var f=0,l=a.length;f<l;f++){var u=$(a[f])[0];if(u===e.target||$.contains(u,e.target))return}}else if(u===e.target||$.contains(u,e.target))return}if(!(!$(e.target).is(".oas-overlay")&&!$(e.target).closest(".oas-overlay").size()||!$(e.target).closest(".oas-overlay").is(n.$el)))return;n._iCall("hide")})}$.oasUiFactory("oasOverlay",{options:{triggerType:"hover",delay:150,target:null,align:{selfXY:[0,0],baseElement:t.VIEWPORT,baseXY:[0,0],direction:">",alignType:1},parentNode:document.body,advPin:!1,blurHide:!0,isNeedAnimation:!1},_create:function(){var e=this,t=this.options,n=$(t.target),r=t.delay,i=t.triggerType;this.target=n,oasOverlay.allOverlays.push(this),this.$el.addClass("oas-overlay"),i==="hover"&&n?(n.on("mouseenter."+this.uiName,function(t){if($(this).hasClass("disabled"))return;clearTimeout(e.hideTime),e.target=this,e.showTime=setTimeout(function(){e._iCall("show")},r)}).on("mouseleave."+this.uiName,function(){if($(this).hasClass("disabled"))return;clearTimeout(e.showTime),e.hideTime=setTimeout(function(t){e._iCall("hide")},r)}),this.$el.on("mouseenter."+this.uiName,function(){clearTimeout(e.hideTime)}),this.$el.on("mouseleave."+this.uiName,function(){e.hideTime=setTimeout(function(){e._iCall("hide")},r)})):i==="click"&&n?(n.context=n.context&&n.context!=undefined?n.context:n.parent(),n.live("click."+this.uiName,function(){if($(this).hasClass("disabled"))return;e.target=this,e._iCall("show")})):i==="focus"&&n&&n.on("focus."+this.uiName,function(){if($(this).hasClass("disabled"))return;e.target=this,e._iCall("show")}),this._blurHide()},_setPosition:function(e){var t=this.options,n=t.advPin;e||(e=t.align);if(!e)return;return n?this._setAdvPosition(e,n):this._setNomalPosition(e)},_setNomalPosition:function(e){var n=this.$el,r=n.css("display")==="none",i=this.options.parentNode,s=e.baseXY,o=e.direction,u=e.alignType,a=e.isSuitable,f,l=e.centerDist,c=e.selfXY;return r&&n.css({visible:"hidden",display:"block"}),i!==document.body&&i!==$(document.body)?f=t.pin({element:n,x:c[0],y:c[1]},{element:this.target,x:s[0],y:s[1]},i,o,u,l,a):f=t.pin({element:n,x:c[0],y:c[1]},{element:this.target,x:s[0],y:s[1]},undefined,o,u,l,a),r&&n.css({visibility:"",display:"none"}),f},_setAdvPosition:function(e,n){var r=this.$el,i=r.css("display")==="none";i&&r.css({visible:"hidden",display:"block"}),t.advPin(r,e.baseElement,{offset:e.baseXY,direction:n.direction}),i&&r.css({visibility:"",display:"none"})},_blurHide:function(e){e||oasOverlay.blurOverlays.push(this),e=$.makeArray(e),e.push(this.options.target),this._relativeElements=e},_judgeDirection:function(){var e={},t=this.$el.css("display")==="none";t&&this.$el.css({visible:"hidden",display:"block"});var n=this.$el,r=$(this.target),i={top:this.$el.offset().top,left:this.$el.offset().left},s={top:r.offset().top,left:r.offset().left};return this.options.parentNode!==document.body&&this.options.parentNode!==$(document.body)&&(i={top:this.$el.position().top,left:this.$el.position().left},s={top:r.position().top,left:r.position().left}),i.top>=s.top+r.outerHeight()?e.direction="bottom":s.top>=i.top+n.outerHeight()?e.direction="top":i.left>=s.left+r.outerWidth()?e.direction="right":s.left>=i.left+n.outerWidth()&&(e.direction="left"),e.selfPos=i,t&&this.$el.css({visibility:"",display:"none"}),e},invoke:{show:function(){this._emit("beforeOpen",[this.$el,this]),this.visible=!0;var e=this._setPosition();this._emit("afterSetPosition",[this.$el,e]);if(this.options.isNeedAnimation){var t=this._judgeDirection(),n=this.$el,r=n.css("display")==="none";t.direction=="bottom"?(n.css("top",t.selfPos.top+15),r||n.hide(),n.animate({top:t.selfPos.top,opacity:"show"},300)):t.direction=="top"?(n.css("top",t.selfPos.top-15),r||n.hide(),n.animate({top:t.selfPos.top,opacity:"show"},300)):t.direction=="left"?(n.css("left",t.selfPos.left-15),r||n.hide(),n.animate({left:t.selfPos.left,opacity:"show"},300)):t.direction=="right"?(n.css("left",t.selfPos.left+15),r||n.hide(),n.animate({left:t.selfPos.left,opacity:"show"},300)):n.show()}else this.$el.show();this.options.hasOpacity&&$("body").find(".oas-mask-opacity").show(),this._emit("open",[this.$el,this])},hide:function(){this.visible=!1,this.$el.hide(),this.options.hasOpacity&&$("body").find(".oas-mask-opacity").hide(),this._emit("close",[this.$el,this])},showSelf:function(){this.visible=!0,this.$el.show(),this.options.onOpen.call(this.$el,this)},align:function(e){e&&(this.options.align=$.extend({},this.options.align,e),this._setPosition(this.options.align))},blurHide:function(e){this._blurHide(e)},destroyOverlay:function(){function s(e,t){for(var n=0,r=t.length;n<r;n++)if(e===t[n])return t.splice(n,1),t}var e=this,t=this.options,n=$(t.target),r=t.delay,i=t.triggerType;s(oasOverlay.allOverlays,this),this.$el.unbind("."+this.uiName).removeData(this.uiName),i==="hover"&&n?(n.off("mouseover."+this.uiName).off("mouseleave."+this.uiName),this.$el.off("mouseover."+this.uiName),this.$el.off("mouseleave."+this.uiName)):i==="click"&&n?(n.context=n.context&&n.context!=undefined?n.context:n.parent(),n.die("click."+this.uiName)):i==="focus"&&n&&n.off("focus."+this.uiName)}}}),window.oasOverlay={},oasOverlay.allOverlays=[],oasOverlay.blurOverlays=[],$(document).off(".oasOverlay"),$(document).on("click.oasOverlay",function(e){s(e)});var n,r=$(window).width(),i=$(window).height();$(window).resize(function(){n&&clearTimeout(n),n=setTimeout(function(){var e=$(window).width(),t=$(window).height();if(r!==e||i!==t)$.each(oasOverlay.allOverlays,function(e,t){if(!t||!t.visible)return;t._setPosition()}),r=e,i=t},80)})});