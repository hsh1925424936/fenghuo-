/*!
 * UEditor Mini版本
 * version: 1.2.2
 * build: Wed Mar 19 2014 17:14:25 GMT+0800 (中国标准时间)
 */

(function($){function getListener(e,t,n){var r;return t=t.toLowerCase(),(r=e.__allListeners||n&&(e.__allListeners={}))&&(r[t]||n&&(r[t]=[]))}function getDomNode(e,t,n,r,i,s){var o=r&&e[t],u;!o&&(o=e[n]);while(!o&&(u=(u||e).parentNode)){if(u.tagName=="BODY"||s&&!s(u))return null;o=u[n]}return o&&i&&!i(o)?getDomNode(o,t,n,!1,i):o}UMEDITOR_CONFIG=window.UMEDITOR_CONFIG||{},window.UM={plugins:{},commands:{},I18N:{},version:"1.2.2"};var dom=UM.dom={},browser=UM.browser=function(){var e=navigator.userAgent.toLowerCase(),t=window.opera,n={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(e),opera:!!t&&t.version,webkit:e.indexOf(" applewebkit/")>-1,mac:e.indexOf("macintosh")>-1,quirks:document.compatMode=="BackCompat"};n.gecko=navigator.product=="Gecko"&&!n.webkit&&!n.opera&&!n.ie;var r=0;if(n.ie){var i=e.match(/(?:msie\s([\w.]+))/),s=e.match(/(?:trident.*rv:([\w.]+))/);i&&s&&i[1]&&s[1]?r=Math.max(i[1]*1,s[1]*1):i&&i[1]?r=i[1]*1:s&&s[1]?r=s[1]*1:r=0,n.ie11Compat=document.documentMode==11,n.ie9Compat=document.documentMode==9,n.ie8=!!document.documentMode,n.ie8Compat=document.documentMode==8,n.ie7Compat=r==7&&!document.documentMode||document.documentMode==7,n.ie6Compat=r<7||n.quirks,n.ie9above=r>8,n.ie9below=r<9}if(n.gecko){var o=e.match(/rv:([\d\.]+)/);o&&(o=o[1].split("."),r=o[0]*1e4+(o[1]||0)*100+(o[2]||0)*1)}return/chrome\/(\d+\.\d)/i.test(e)&&(n.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome/i.test(e)&&(n.safari=+(RegExp.$1||RegExp.$2)),n.opera&&(r=parseFloat(t.version())),n.webkit&&(r=parseFloat(e.match(/ applewebkit\/(\d+)/)[1])),n.version=r,n.isCompatible=!n.mobile&&(n.ie&&r>=6||n.gecko&&r>=10801||n.opera&&r>=9.5||n.air&&r>=1||n.webkit&&r>=522||!1),n}(),ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera,utils=UM.utils={each:function(e,t,n){if(e==null)return;if(e.length===+e.length){for(var r=0,i=e.length;r<i;r++)if(t.call(n,e[r],r,e)===!1)return!1}else for(var s in e)if(e.hasOwnProperty(s)&&t.call(n,e[s],s,e)===!1)return!1},makeInstance:function(e){var t=new Function;return t.prototype=e,e=new t,t.prototype=null,e},extend:function(e,t,n){if(t)for(var r in t)if(!n||!e.hasOwnProperty(r))e[r]=t[r];return e},extend2:function(e){var t=arguments;for(var n=1;n<t.length;n++){var r=t[n];for(var i in r)e.hasOwnProperty(i)||(e[i]=r[i])}return e},inherits:function(e,t){var n=e.prototype,r=utils.makeInstance(t.prototype);return utils.extend(r,n,!0),e.prototype=r,r.constructor=e},bind:function(e,t){return function(){return e.apply(t,arguments)}},defer:function(e,t,n){var r;return function(){n&&clearTimeout(r),r=setTimeout(e,t)}},indexOf:function(e,t,n){var r=-1;return n=this.isNumber(n)?n:0,this.each(e,function(e,i){if(i>=n&&e===t)return r=i,!1}),r},removeItem:function(e,t){for(var n=0,r=e.length;n<r;n++)e[n]===t&&(e.splice(n,1),n--)},trim:function(e){return e.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(e){if(!e)return{};e=utils.isArray(e)?e:e.split(",");for(var t=0,n,r={};n=e[t++];)r[n.toUpperCase()]=r[n]=1;return r},unhtml:function(e,t){return e?e.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(e,t){return t?e:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[e]}):""},html:function(e){return e?e.replace(/&((g|l|quo)t|amp|#39);/g,function(e){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[e]}):""},cssStyleToDomStyle:function(){var e=document.createElement("div").style,t={"float":e.cssFloat!=undefined?"cssFloat":e.styleFloat!=undefined?"styleFloat":"float"};return function(e){return t[e]||(t[e]=e.toLowerCase().replace(/-./g,function(e){return e.charAt(1).toUpperCase()}))}}(),loadFile:function(){function t(t,n){try{for(var r=0,i;i=e[r++];)if(i.doc===t&&i.url==(n.src||n.href))return i}catch(s){return null}}var e=[];return function(n,r,i){var s=t(n,r);if(s){s.ready?i&&i():s.funs.push(i);return}e.push({doc:n,url:r.src||r.href,funs:[i]});if(!n.body){var o=[];for(var u in r){if(u=="tag")continue;o.push(u+'="'+r[u]+'"')}n.write("<"+r.tag+" "+o.join(" ")+" ></"+r.tag+">");return}if(r.id&&n.getElementById(r.id))return;var a=n.createElement(r.tag);delete r.tag;for(var u in r)a.setAttribute(u,r[u]);a.onload=a.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){s=t(n,r);if(s.funs.length>0){s.ready=1;for(var e;e=s.funs.pop();)e()}a.onload=a.onreadystatechange=null}},a.onerror=function(){throw Error("The load "+(r.href||r.src)+" fails,check the url settings of file umeditor.config.js ")},n.getElementsByTagName("head")[0].appendChild(a)}}(),isEmptyObject:function(e){if(e==null)return!0;if(this.isArray(e)||this.isString(e))return e.length===0;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},fixColor:function(e,t){if(/color/i.test(e)&&/rgba?/.test(t)){var n=t.split(",");if(n.length>3)return"";t="#";for(var r=0,i;i=n[r++];)i=parseInt(i.replace(/[^\d]/gi,""),10).toString(16),t+=i.length==1?"0"+i:i;t=t.toUpperCase()}return t},clone:function(e,t){var n;t=t||{};for(var r in e)e.hasOwnProperty(r)&&(n=e[r],typeof n=="object"?(t[r]=utils.isArray(n)?[]:{},utils.clone(e[r],t[r])):t[r]=n);return t},transUnitToPx:function(e){if(!/(pt|cm)/.test(e))return e;var t;e.replace(/([\d.]+)(\w+)/,function(n,r,i){e=r,t=i});switch(t){case"cm":e=parseFloat(e)*25;break;case"pt":e=Math.round(parseFloat(e)*96/72)}return e+(e?"px":"")},cssRule:browser.ie&&browser.version!=11?function(e,t,n){var r,i;n=n||document,n.indexList?r=n.indexList:r=n.indexList={};var s;if(!r[e]){if(t===undefined)return"";s=n.createStyleSheet("",i=n.styleSheets.length),r[e]=i}else s=n.styleSheets[r[e]];if(t===undefined)return s.cssText;s.cssText=t||""}:function(e,t,n){n=n||document;var r=n.getElementsByTagName("head")[0],i;if(!(i=n.getElementById(e))){if(t===undefined)return"";i=n.createElement("style"),i.id=e,r.appendChild(i)}if(t===undefined)return i.innerHTML;t!==""?i.innerHTML=t:r.removeChild(i)}};utils.each(["String","Function","Array","Number","RegExp","Object"],function(e){UM.utils["is"+e]=function(t){return Object.prototype.toString.apply(t)=="[object "+e+"]"}});var EventBase=UM.EventBase=function(){};EventBase.prototype={addListener:function(e,t){e=utils.trim(e).split(" ");for(var n=0,r;r=e[n++];)getListener(this,r,!0).push(t)},removeListener:function(e,t){e=utils.trim(e).split(" ");for(var n=0,r;r=e[n++];)utils.removeItem(getListener(this,r)||[],t)},fireEvent:function(){var e=arguments[0];e=utils.trim(e).split(" ");for(var t=0,n;n=e[t++];){var r=getListener(this,n),i,s,o;if(r){o=r.length;while(o--){if(!r[o])continue;s=r[o].apply(this,arguments);if(s===!0)return s;s!==undefined&&(i=s)}}if(s=this["on"+n.toLowerCase()])i=s.apply(this,arguments)}return i}};var dtd=dom.dtd=function(){function e(e){for(var t in e)e[t.toUpperCase()]=e[t];return e}var t=utils.extend2,n=e({isindex:1,fieldset:1}),r=e({input:1,button:1,select:1,textarea:1,label:1}),i=t(e({a:1}),r),s=t({iframe:1},i),o=e({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),u=e({ins:1,del:1,script:1,style:1}),a=t(e({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),u),f=t(e({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),a),l=t(e({p:1}),f),c=t(e({iframe:1}),f,r),h=e({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),p=t(e({a:0}),c),d=e({tr:1}),v=e({"#":1}),m=t(e({param:1}),h),g=t(e({form:1}),n,s,o,l),y=e({li:1,ol:1,ul:1}),b=e({style:1,script:1}),w=e({base:1,link:1,meta:1,title:1}),E=t(w,b),S=e({head:1,body:1}),x=e({html:1}),T=e({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),N=e({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return e({$nonBodyContent:t(x,S,w),$block:T,$inline:p,$inlineWithA:t(e({a:1}),p),$body:t(e({script:1,style:1}),T),$cdata:e({script:1,style:1}),$empty:N,$nonChild:e({iframe:1,textarea:1}),$listItem:e({dd:1,dt:1,li:1}),$list:e({ul:1,ol:1,dl:1}),$isNotEmpty:e({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:e({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:e({p:1,div:1}),$tableContent:e({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:e({pre:1,script:1,style:1,textarea:1}),html:S,head:E,style:v,script:v,body:g,base:{},link:{},meta:{},title:v,col:{},tr:e({td:1,th:1}),img:{},embed:{},colgroup:e({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:g,td:g,br:{},th:g,center:g,kbd:p,button:t(l,o),basefont:{},h5:p,h4:p,samp:p,h6:p,ol:y,h1:p,h3:p,option:v,h2:p,form:t(n,s,o,l),select:e({optgroup:1,option:1}),font:p,ins:p,menu:y,abbr:p,label:p,table:e({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:p,tfoot:d,cite:p,li:g,input:{},iframe:g,strong:p,textarea:v,noframes:g,big:p,small:p,span:e({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:p,dt:p,sub:p,optgroup:e({option:1}),param:{},bdo:p,"var":p,div:g,object:m,sup:p,dd:g,strike:p,area:{},dir:y,map:t(e({area:1,form:1,p:1}),n,u,o),applet:m,dl:e({dt:1,dd:1}),del:p,isindex:{},fieldset:t(e({legend:1}),h),thead:d,ul:y,acronym:p,b:p,a:t(e({a:1}),c),blockquote:t(e({td:1,tr:1,tbody:1,li:1}),g),caption:p,i:p,u:p,tbody:d,s:p,address:t(s,l),tt:p,legend:p,q:p,pre:t(a,i),p:t(e({a:1}),p),em:p,dfn:p})}(),attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&browser.version=="6"?"﻿":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},breakParent:function(e,t){var n,r=e,i=e,s,o;do{r=r.parentNode,s?(n=r.cloneNode(!1),n.appendChild(s),s=n,n=r.cloneNode(!1),n.appendChild(o),o=n):(s=r.cloneNode(!1),o=s.cloneNode(!1));while(n=i.previousSibling)s.insertBefore(n,s.firstChild);while(n=i.nextSibling)o.appendChild(n);i=r}while(t!==r);return n=t.parentNode,n.insertBefore(s,t),n.insertBefore(o,t),n.insertBefore(e,o),domUtils.remove(t),e},trimWhiteTextNode:function(e){function t(t){var n;while((n=e[t])&&n.nodeType==3&&domUtils.isWhitespace(n))e.removeChild(n)}t("firstChild"),t("lastChild")},getPosition:function(e,t){if(e===t)return 0;var n,r=[e],i=[t];n=e;while(n=n.parentNode){if(n===t)return 10;r.push(n)}n=t;while(n=n.parentNode){if(n===e)return 20;i.push(n)}r.reverse(),i.reverse();if(r[0]!==i[0])return 1;var s=-1;while(s++,r[s]===i[s]);e=r[s],t=i[s];while(e=e.nextSibling)if(e===t)return 4;return 2},getNodeIndex:function(e,t){var n=e,r=0;while(n=n.previousSibling){if(t&&n.nodeType==3){n.nodeType!=n.nextSibling.nodeType&&r++;continue}r++}return r},inDoc:function(e,t){return domUtils.getPosition(e,t)==10},findParent:function(e,t,n){if(e&&!domUtils.isBody(e)){e=n?e:e.parentNode;while(e){if(!t||t(e)||domUtils.isBody(e))return t&&!t(e)&&domUtils.isBody(e)?null:e;e=e.parentNode}}return null},findParentByTagName:function(e,t,n,r){return t=utils.listToMap(utils.isArray(t)?t:[t]),domUtils.findParent(e,function(e){return t[e.tagName]&&(!r||!r(e))},n)},findParents:function(e,t,n,r){var i=t&&(n&&n(e)||!n)?[e]:[];while(e=domUtils.findParent(e,n))i.push(e);return r?i:i.reverse()},insertAfter:function(e,t){return e.parentNode.insertBefore(t,e.nextSibling)},remove:function(e,t){var n=e.parentNode,r;if(n){if(t&&e.hasChildNodes())while(r=e.firstChild)n.insertBefore(r,e);n.removeChild(e)}return e},getNextDomNode:function(e,t,n,r){return getDomNode(e,"firstChild","nextSibling",t,n,r)},getPreDomNode:function(e,t,n,r){return getDomNode(e,"lastChild","previousSibling",t,n,r)},isBookmarkNode:function(e){return e.nodeType==1&&e.id&&/^_baidu_bookmark_/i.test(e.id)},getWindow:function(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow},getCommonAncestor:function(e,t){if(e===t)return e;var n=[e],r=[t],i=e,s=-1;while(i=i.parentNode){if(i===t)return i;n.push(i)}i=t;while(i=i.parentNode){if(i===e)return i;r.push(i)}n.reverse(),r.reverse();while(s++,n[s]===r[s]);return s==0?null:n[s-1]},clearEmptySibling:function(e,t,n){function r(e,t){var n;while(e&&!domUtils.isBookmarkNode(e)&&(domUtils.isEmptyInlineElement(e)||!(new RegExp("[^	\n\r"+domUtils.fillChar+"]")).test(e.nodeValue)))n=e[t],domUtils.remove(e),e=n}!t&&r(e.nextSibling,"nextSibling"),!n&&r(e.previousSibling,"previousSibling")},split:function(e,t){var n=e.ownerDocument;if(browser.ie&&t==e.nodeValue.length){var r=n.createTextNode("");return domUtils.insertAfter(e,r)}var i=e.splitText(t);if(browser.ie8){var s=n.createTextNode("");domUtils.insertAfter(i,s),domUtils.remove(s)}return i},isWhitespace:function(e){return!(new RegExp("[^ 	\n\r"+domUtils.fillChar+"]")).test(e.nodeValue)},getXY:function(e){var t=0,n=0;while(e.offsetParent)n+=e.offsetTop,t+=e.offsetLeft,e=e.offsetParent;return{x:t,y:n}},isEmptyInlineElement:function(e){if(e.nodeType!=1||!dtd.$removeEmpty[e.tagName])return 0;e=e.firstChild;while(e){if(domUtils.isBookmarkNode(e))return 0;if(e.nodeType==1&&!domUtils.isEmptyInlineElement(e)||e.nodeType==3&&!domUtils.isWhitespace(e))return 0;e=e.nextSibling}return 1},isBlockElm:function(e){return e.nodeType==1&&(dtd.$block[e.tagName]||styleBlock[domUtils.getComputedStyle(e,"display")])&&!dtd.$nonChild[e.tagName]},getElementsByTagName:function(e,t,n){if(n&&utils.isString(n)){var r=n;n=function(e){var t=!1;return $.each(utils.trim(r).replace(/[ ]{2,}/g," ").split(" "),function(n,r){if($(e).hasClass(r))return t=!0,!1}),t}}t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");var i=[];for(var s=0,o;o=t[s++];){var u=e.getElementsByTagName(o);for(var a=0,f;f=u[a++];)(!n||n(f))&&i.push(f)}return i},unSelectable:ie&&browser.ie9below||browser.opera?function(e){e.onselectstart=function(){return!1},e.onclick=e.onkeyup=e.onkeydown=function(){return!1},e.unselectable="on",e.setAttribute("unselectable","on");for(var t=0,n;n=e.all[t++];)switch(n.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:n.unselectable="on",e.setAttribute("unselectable","on")}}:function(e){e.style.MozUserSelect=e.style.webkitUserSelect=e.style.msUserSelect=e.style.KhtmlUserSelect="none"},removeAttributes:function(e,t){t=utils.isArray(t)?t:utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var n=0,r;r=t[n++];){r=attrFix[r]||r;switch(r){case"className":e[r]="";break;case"style":e.style.cssText="",!browser.ie&&e.removeAttributeNode(e.getAttributeNode("style"))}e.removeAttribute(r)}},createElement:function(e,t,n){return domUtils.setAttributes(e.createElement(t),n)},setAttributes:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];switch(n){case"class":e.className=r;break;case"style":e.style.cssText=e.style.cssText+";"+r;break;case"innerHTML":e[n]=r;break;case"value":e.value=r;break;default:e.setAttribute(attrFix[n]||n,r)}}return e},getComputedStyle:function(e,t){return utils.transUnitToPx(utils.fixColor(t,$(e).css(t)))},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},removeStyle:function(e,t){browser.ie?(t=="color"&&(t="(^|;)"+t),e.style.cssText=e.style.cssText.replace(new RegExp(t+"[^:]*:[^;]+;?","ig"),"")):e.style.removeProperty?e.style.removeProperty(t):e.style.removeAttribute(utils.cssStyleToDomStyle(t)),e.style.cssText||domUtils.removeAttributes(e,["style"])},getStyle:function(e,t){var n=e.style[utils.cssStyleToDomStyle(t)];return utils.fixColor(t,n)},setStyle:function(e,t,n){e.style[utils.cssStyleToDomStyle(t)]=n,utils.trim(e.style.cssText)||this.removeAttributes(e,"style")},removeDirtyAttr:function(e){for(var t=0,n,r=e.getElementsByTagName("*");n=r[t++];)n.removeAttribute("_moz_dirty");e.removeAttribute("_moz_dirty")},getChildCount:function(e,t){var n=0,r=e.firstChild;t=t||function(){return 1};while(r)t(r)&&n++,r=r.nextSibling;return n},isEmptyNode:function(e){return!e.firstChild||domUtils.getChildCount(e,function(e){return!domUtils.isBr(e)&&!domUtils.isBookmarkNode(e)&&!domUtils.isWhitespace(e)})==0},isBr:function(e){return e.nodeType==1&&e.tagName=="BR"},isFillChar:function(e,t){return e.nodeType==3&&!e.nodeValue.replace(new RegExp((t?"^":"")+domUtils.fillChar),"").length},isEmptyBlock:function(e,t){if(e.nodeType!=1)return 0;t=t||new RegExp("[ 	\r\n"+domUtils.fillChar+"]","g");if(e[browser.ie?"innerText":"textContent"].replace(t,"").length>0)return 0;for(var n in dtd.$isNotEmpty)if(e.getElementsByTagName(n).length)return 0;return 1},isCustomeNode:function(e){return e.nodeType==1&&e.getAttribute("_ue_custom_node_")},fillNode:function(e,t){var n=browser.ie?e.createTextNode(domUtils.fillChar):e.createElement("br");t.innerHTML="",t.appendChild(n)},isBoundaryNode:function(e,t){var n;while(!domUtils.isBody(e)){n=e,e=e.parentNode;if(n!==e[t])return!1}return!0},isFillChar:function(e,t){return e.nodeType==3&&!e.nodeValue.replace(new RegExp((t?"^":"")+domUtils.fillChar),"").length},isBody:function(e){return $(e).hasClass("edui-body-container")}},fillCharReg=new RegExp(domUtils.fillChar,"g");(function(){function r(e){e.collapsed=e.startContainer&&e.endContainer&&e.startContainer===e.endContainer&&e.startOffset==e.endOffset}function i(e){return!e.collapsed&&e.startContainer.nodeType==1&&e.startContainer===e.endContainer&&e.endOffset-e.startOffset==1}function s(e,t,n,i){return t.nodeType==1&&(dtd.$empty[t.tagName]||dtd.$nonChild[t.tagName])&&(n=domUtils.getNodeIndex(t)+(e?0:1),t=t.parentNode),e?(i.startContainer=t,i.startOffset=n,i.endContainer||i.collapse(!0)):(i.endContainer=t,i.endOffset=n,i.startContainer||i.collapse(!1)),r(i),i}function u(e,t){try{if(n&&domUtils.inDoc(n,e))if(!n.nodeValue.replace(fillCharReg,"").length){var r=n.parentNode;domUtils.remove(n);while(r&&domUtils.isEmptyInlineElement(r)&&(browser.safari?!(domUtils.getPosition(r,t)&domUtils.POSITION_CONTAINS):!r.contains(t)))n=r.parentNode,domUtils.remove(r),r=n}else n.nodeValue=n.nodeValue.replace(fillCharReg,"")}catch(i){}}function a(e,t){var n;e=e[t];while(e&&domUtils.isFillChar(e))n=e[t],domUtils.remove(e),e=n}function f(e,t){var n=e.startContainer,r=e.endContainer,i=e.startOffset,s=e.endOffset,o=e.document,u=o.createDocumentFragment(),a,f;n.nodeType==1&&(n=n.childNodes[i]||(a=n.appendChild(o.createTextNode("")))),r.nodeType==1&&(r=r.childNodes[s]||(f=r.appendChild(o.createTextNode(""))));if(n===r&&n.nodeType==3)return u.appendChild(o.createTextNode(n.substringData(i,s-i))),t&&(n.deleteData(i,s-i),e.collapse(!0)),u;var l,c,h=u,p=domUtils.findParents(n,!0),d=domUtils.findParents(r,!0);for(var v=0;p[v]==d[v];)v++;for(var m=v,g;g=p[m];m++){l=g.nextSibling,g==n?a||(e.startContainer.nodeType==3?(h.appendChild(o.createTextNode(n.nodeValue.slice(i))),t&&n.deleteData(i,n.nodeValue.length-i)):h.appendChild(t?n:n.cloneNode(!0))):(c=g.cloneNode(!1),h.appendChild(c));while(l){if(l===r||l===d[m])break;g=l.nextSibling,h.appendChild(t?l:l.cloneNode(!0)),l=g}h=c}h=u,p[v]||(h.appendChild(p[v-1].cloneNode(!1)),h=h.firstChild);for(var m=v,y;y=d[m];m++){l=y.previousSibling,y==r?!f&&e.endContainer.nodeType==3&&(h.appendChild(o.createTextNode(r.substringData(0,s))),t&&r.deleteData(0,s)):(c=y.cloneNode(!1),h.appendChild(c));if(m!=v||!p[v])while(l){if(l===n)break;y=l.previousSibling,h.insertBefore(t?l:l.cloneNode(!0),h.firstChild),l=y}h=c}return t&&e.setStartBefore(d[v]?p[v]?d[v]:p[v-1]:d[v-1]).collapse(!0),a&&domUtils.remove(a),f&&domUtils.remove(f),u}var e=0,t=domUtils.fillChar,n,o=dom.Range=function(e,t){var n=this;n.startContainer=n.startOffset=n.endContainer=n.endOffset=null,n.document=e,n.collapsed=!0,n.body=t};o.prototype={deleteContents:function(){var e;return this.collapsed||f(this,1),browser.webkit&&(e=this.startContainer,e.nodeType==3&&!e.nodeValue.length&&(this.setStartBefore(e).collapse(!0),domUtils.remove(e))),this},inFillChar:function(){var e=this.startContainer;return this.collapsed&&e.nodeType==3&&e.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==e.nodeValue.length?!0:!1},setStart:function(e,t){return s(!0,e,t,this)},setEnd:function(e,t){return s(!1,e,t,this)},setStartAfter:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e)+1)},setStartBefore:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e))},setEndAfter:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e)+1)},setEndBefore:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e))},setStartAtFirst:function(e){return this.setStart(e,0)},setStartAtLast:function(e){return this.setStart(e,e.nodeType==3?e.nodeValue.length:e.childNodes.length)},setEndAtFirst:function(e){return this.setEnd(e,0)},setEndAtLast:function(e){return this.setEnd(e,e.nodeType==3?e.nodeValue.length:e.childNodes.length)},selectNode:function(e){return this.setStartBefore(e).setEndAfter(e)},selectNodeContents:function(e){return this.setStart(e,0).setEndAtLast(e)},cloneRange:function(){var e=this;return(new o(e.document)).setStart(e.startContainer,e.startOffset).setEnd(e.endContainer,e.endOffset)},collapse:function(e){var t=this;return e?(t.endContainer=t.startContainer,t.endOffset=t.startOffset):(t.startContainer=t.endContainer,t.startOffset=t.endOffset),t.collapsed=!0,t},shrinkBoundary:function(e){function i(e){return e.nodeType==1&&!domUtils.isBookmarkNode(e)&&!dtd.$empty[e.tagName]&&!dtd.$nonChild[e.tagName]}var t=this,n,r=t.collapsed;while(t.startContainer.nodeType==1&&(n=t.startContainer.childNodes[t.startOffset])&&i(n))t.setStart(n,0);if(r)return t.collapse(!0);if(!e)while(t.endContainer.nodeType==1&&t.endOffset>0&&(n=t.endContainer.childNodes[t.endOffset-1])&&i(n))t.setEnd(n,n.childNodes.length);return t},trimBoundary:function(e){this.txtToElmBoundary();var t=this.startContainer,n=this.startOffset,r=this.collapsed,i=this.endContainer;if(t.nodeType==3){if(n==0)this.setStartBefore(t);else if(n>=t.nodeValue.length)this.setStartAfter(t);else{var s=domUtils.split(t,n);t===i?this.setEnd(s,this.endOffset-n):t.parentNode===i&&(this.endOffset+=1),this.setStartBefore(s)}if(r)return this.collapse(!0)}return e||(n=this.endOffset,i=this.endContainer,i.nodeType==3&&(n==0?this.setEndBefore(i):(n<i.nodeValue.length&&domUtils.split(i,n),this.setEndAfter(i)))),this},txtToElmBoundary:function(e){function t(e,t){var n=e[t+"Container"],r=e[t+"Offset"];n.nodeType==3&&(r?r>=n.nodeValue.length&&e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"After"](n):e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"Before"](n))}if(e||!this.collapsed)t(this,"start"),t(this,"end");return this},insertNode:function(e){var t=e,n=1;e.nodeType==11&&(t=e.firstChild,n=e.childNodes.length),this.trimBoundary(!0);var r=this.startContainer,i=this.startOffset,s=r.childNodes[i];return s?r.insertBefore(e,s):r.appendChild(e),t.parentNode===this.endContainer&&(this.endOffset=this.endOffset+n),this.setStartBefore(t)},setCursor:function(e,t){return this.collapse(!e).select(t)},createBookmark:function(t,n){var r,i=this.document.createElement("span");return i.style.cssText="display:none;line-height:0px;",i.appendChild(this.document.createTextNode("‍")),i.id="_baidu_bookmark_start_"+(n?"":e++),this.collapsed||(r=i.cloneNode(!0),r.id="_baidu_bookmark_end_"+(n?"":e++)),this.insertNode(i),r&&this.collapse().insertNode(r).setEndBefore(r),this.setStartAfter(i),{start:t?i.id:i,end:r?t?r.id:r:null,id:t}},moveToBookmark:function(e){var t=e.id?this.document.getElementById(e.start):e.start,n=e.end&&e.id?this.document.getElementById(e.end):e.end;return this.setStartBefore(t),domUtils.remove(t),n?(this.setEndBefore(n),domUtils.remove(n)):this.collapse(!0),this},adjustmentBoundary:function(){if(!this.collapsed){while(!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length&&this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length)this.setStartAfter(this.startContainer);while(!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[this.endContainer.nodeType==3?"nodeValue":"childNodes"].length)this.setEndBefore(this.endContainer)}return this},getClosedNode:function(){var e;if(!this.collapsed){var t=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(i(t)){var n=t.startContainer.childNodes[t.startOffset];n&&n.nodeType==1&&(dtd.$empty[n.tagName]||dtd.$nonChild[n.tagName])&&(e=n)}}return e},select:browser.ie?function(e,r){var i;this.collapsed||this.shrinkBoundary();var s=this.getClosedNode();if(s&&!r){try{i=this.document.body.createControlRange(),i.addElement(s),i.select()}catch(o){}return this}var f=this.createBookmark(),l=f.start,c;i=this.document.body.createTextRange(),i.moveToElementText(l),i.moveStart("character",1);if(!this.collapsed){var h=this.document.body.createTextRange();c=f.end,h.moveToElementText(c),i.setEndPoint("EndToEnd",h)}else if(!e&&this.startContainer.nodeType!=3){var p=this.document.createTextNode(t),d=this.document.createElement("span");d.appendChild(this.document.createTextNode(t)),l.parentNode.insertBefore(d,l),l.parentNode.insertBefore(p,l),u(this.document,p),n=p,a(d,"previousSibling"),a(l,"nextSibling"),i.moveStart("character",-1),i.collapse(!0)}this.moveToBookmark(f),d&&domUtils.remove(d);try{i.select()}catch(o){}return this}:function(e){function r(e){function t(t,n,r){t.nodeType==3&&t.nodeValue.length<n&&(e[r+"Offset"]=t.nodeValue.length)}t(e.startContainer,e.startOffset,"start"),t(e.endContainer,e.endOffset,"end")}var i=domUtils.getWindow(this.document),s=i.getSelection(),o;browser.gecko?this.body.focus():i.focus();if(s){s.removeAllRanges();if(this.collapsed&&!e){var f=this.startContainer,l=f;f.nodeType==1&&(l=f.childNodes[this.startOffset]),(f.nodeType!=3||!this.startOffset)&&(l?!l.previousSibling||l.previousSibling.nodeType!=3:!f.lastChild||f.lastChild.nodeType!=3)&&(o=this.document.createTextNode(t),this.insertNode(o),u(this.document,o),a(o,"previousSibling"),a(o,"nextSibling"),n=o,this.setStart(o,browser.webkit?1:0).collapse(!0))}var c=this.document.createRange();if(this.collapsed&&browser.opera&&this.startContainer.nodeType==1){var l=this.startContainer.childNodes[this.startOffset];if(!l)l=this.startContainer.lastChild,l&&domUtils.isBr(l)&&this.setStartBefore(l).collapse(!0);else{while(l&&domUtils.isBlockElm(l)){if(l.nodeType!=1||!l.childNodes[0])break;l=l.childNodes[0]}l&&this.setStartBefore(l).collapse(!0)}}r(this),c.setStart(this.startContainer,this.startOffset),c.setEnd(this.endContainer,this.endOffset),s.addRange(c)}return this},createAddress:function(e,t){function i(e){var n=e?r.startContainer:r.endContainer,i=domUtils.findParents(n,!0,function(e){return!domUtils.isBody(e)}),s=[];for(var o=0,u;u=i[o++];)s.push(domUtils.getNodeIndex(u,t));var a=0;if(t)if(n.nodeType==3){var f=n.previousSibling;while(f&&f.nodeType==3)a+=f.nodeValue.replace(fillCharReg,"").length,f=f.previousSibling;a+=e?r.startOffset:r.endOffset}else{n=n.childNodes[e?r.startOffset:r.endOffset];if(n)a=domUtils.getNodeIndex(n,t);else{n=e?r.startContainer:r.endContainer;var l=n.firstChild;while(l){if(domUtils.isFillChar(l)){l=l.nextSibling;continue}a++;if(l.nodeType==3)while(l&&l.nodeType==3)l=l.nextSibling;else l=l.nextSibling}}}else a=e?domUtils.isFillChar(n)?0:r.startOffset:r.endOffset;return a<0&&(a=0),s.push(a),s}var n={},r=this;return n.startAddress=i(!0),e||(n.endAddress=r.collapsed?[].concat(n.startAddress):i()),n},moveToAddress:function(e,t){function r(e,t){var r=n.body,i,s;for(var o=0,u,a=e.length;o<a;o++){u=e[o],i=r,r=r.childNodes[u];if(!r){s=u;break}}t?r?n.setStartBefore(r):n.setStart(i,s):r?n.setEndBefore(r):n.setEnd(i,s)}var n=this;return r(e.startAddress,!0),!t&&e.endAddress&&r(e.endAddress),n},equals:function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]!==e[t])return!1;return!0},scrollIntoView:function(){var e=$('<span style="padding:0;margin:0;display:block;border:0">&nbsp;</span>');this.cloneRange().insertNode(e.get(0));var t=$(window).scrollTop(),n=$(window).height(),r=e.offset().top;if(r<t-n||r>t+n)r>t+n&&options.autoHeightEnabled?window.scrollTo(0,r-n+e.height()):window.scrollTo(0,t-r);e.remove()},getOffset:function(){var e=this.createBookmark(),t=$(e.start).css("display","inline-block").offset();return this.moveToBookmark(e),t}}})(),function(){function e(e,t){var n=domUtils.getNodeIndex;e=e.duplicate(),e.collapse(t);var r=e.parentElement();if(!r.hasChildNodes())return{container:r,offset:0};var i=r.children,s,o=e.duplicate(),u=0,a=i.length-1,f=-1,l;while(u<=a){f=Math.floor((u+a)/2),s=i[f],o.moveToElementText(s);var c=o.compareEndPoints("StartToStart",e);if(c>0)a=f-1;else{if(!(c<0))return{container:r,offset:n(s)};u=f+1}}if(f==-1){o.moveToElementText(r),o.setEndPoint("StartToStart",e),l=o.text.replace(/(\r\n|\r)/g,"\n").length,i=r.childNodes;if(!l)return s=i[i.length-1],{container:s,offset:s.nodeValue.length};var h=i.length;while(l>0)l-=i[--h].nodeValue.length;return{container:i[h],offset:-l}}o.collapse(c>0),o.setEndPoint(c>0?"StartToStart":"EndToStart",e),l=o.text.replace(/(\r\n|\r)/g,"\n").length;if(!l)return dtd.$empty[s.tagName]||dtd.$nonChild[s.tagName]?{container:r,offset:n(s)+(c>0?0:1)}:{container:s,offset:c>0?0:s.childNodes.length};while(l>0)try{var p=s;s=s[c>0?"previousSibling":"nextSibling"],l-=s.nodeValue.length}catch(d){return{container:r,offset:n(p)}}return{container:s,offset:c>0?-l:s.nodeValue.length+l}}function t(t,n){if(t.item)n.selectNode(t.item(0));else{var r=e(t,!0);n.setStart(r.container,r.offset),t.compareEndPoints("StartToEnd",t)!=0&&(r=e(t,!1),n.setEnd(r.container,r.offset))}return n}function n(e,t){var n;try{n=e.getNative(t).createRange()}catch(r){return null}var i=n.item?n.item(0):n.parentElement();return(i.ownerDocument||i)===e.document?n:null}var r=dom.Selection=function(e,t){var r=this;r.document=e,r.body=t,browser.ie9below&&$(t).on("beforedeactivate",function(){r._bakIERange=r.getIERange()}).on("activate",function(){try{var e=n(r);(!e||!r.rangeInBody(e))&&r._bakIERange&&r._bakIERange.select()}catch(t){}r._bakIERange=null})};r.prototype={hasNativeRange:function(){var e;if(!browser.ie||browser.ie9above){var t=this.getNative();if(!t.rangeCount)return!1;e=t.getRangeAt(0)}else e=n(this);return this.rangeInBody(e)},getNative:function(e){var t=this.document;try{return t?browser.ie9below||e?t.selection:domUtils.getWindow(t).getSelection():null}catch(n){return null}},getIERange:function(e){var t=n(this,e);if(!t||!this.rangeInBody(t,e))if(this._bakIERange)return this._bakIERange;return t},rangeInBody:function(e,t){var n=browser.ie9below||t?e.item?e.item():e.parentElement():e.startContainer;return n===this.body||domUtils.inDoc(n,this.body)},cache:function(){this.clear(),this._cachedRange=this.getRange(),this._cachedStartElement=this.getStart(),this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var e=this.getStart();return e?domUtils.findParents(e,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){return this.hasNativeRange()},getRange:function(){function n(t){var n=e.body.firstChild,r=t.collapsed;while(n&&n.firstChild)t.setStart(n,0),n=n.firstChild;t.startContainer||t.setStart(e.body,0),r&&t.collapse(!0)}var e=this;if(e._cachedRange!=null)return this._cachedRange;var r=new dom.Range(e.document,e.body);if(browser.ie9below){var i=e.getIERange();if(i&&this.rangeInBody(i))try{t(i,r)}catch(s){n(r)}else n(r)}else{var o=e.getNative();if(o&&o.rangeCount&&e.rangeInBody(o.getRangeAt(0))){var u=o.getRangeAt(0),a=o.getRangeAt(o.rangeCount-1);r.setStart(u.startContainer,u.startOffset).setEnd(a.endContainer,a.endOffset),r.collapsed&&domUtils.isBody(r.startContainer)&&!r.startOffset&&n(r)}else{if(this._bakRange&&(this._bakRange.startContainer===this.body||domUtils.inDoc(this._bakRange.startContainer,this.body)))return this._bakRange;n(r)}}return this._bakRange=r},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var e=browser.ie9below?this.getIERange():this.getRange(),t,n,r,i;if(browser.ie9below){if(!e)return this.document.body.firstChild;if(e.item)return e.item(0);t=e.duplicate(),t.text.length>0&&t.moveStart("character",1),t.collapse(1),n=t.parentElement(),i=r=e.parentElement();while(r=r.parentNode)if(r==n){n=i;break}}else{n=e.startContainer,n.nodeType==1&&n.hasChildNodes()&&(n=n.childNodes[Math.min(n.childNodes.length-1,e.startOffset)]);if(n.nodeType==3)return n.parentNode}return n},getText:function(){var e,t;return this.isFocus()&&(e=this.getNative())?(t=browser.ie9below?e.createRange():e.getRangeAt(0),browser.ie9below?t.text:t.toString()):""}}}(),function(){function n(e,t){var n;if(t.textarea)if(utils.isString(t.textarea)){for(var r=0,i,s=domUtils.getElementsByTagName(e,"textarea");i=s[r++];)if(i.id=="umeditor_textarea_"+t.options.textarea){n=i;break}}else n=t.textarea;n||(e.appendChild(n=domUtils.createElement(document,"textarea",{name:t.options.textarea,id:"umeditor_textarea_"+t.options.textarea,style:"display:none"})),t.textarea=n),n.value=t.hasContents()?t.options.allHtmlEnabled?t.getAllHtml():t.getContent(null,null,!0):""}function r(e){for(var t in UM.plugins)e.options.excludePlugins.indexOf(t)==-1&&(UM.plugins[t].call(e),e.plugins[t]=1);e.langIsReady=!0,e.fireEvent("langReady")}function i(e){for(var t in e)return t}var e=0,t,s=UM.Editor=function(t){var n=this;n.uid=e++,EventBase.call(n),n.commands={},n.options=utils.extend(utils.clone(t||{}),UMEDITOR_CONFIG,!0),n.shortcutkeys={},n.inputRules=[],n.outputRules=[],n.setOpt({isShow:!0,initialContent:"",initialStyle:"",autoClearinitialContent:!1,textarea:"editorValue",focus:!1,focusInEnd:!0,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,enterTag:"p",lang:"zh-cn",langPath:n.options.UMEDITOR_HOME_URL+"lang/",theme:"default",themePath:n.options.UMEDITOR_HOME_URL+"themes/",allHtmlEnabled:!1,autoSyncData:!0,autoHeightEnabled:!0,excludePlugins:""}),n.plugins={},utils.isEmptyObject(UM.I18N)?utils.loadFile(document,{src:n.options.langPath+n.options.lang+"/"+n.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){r(n)}):(n.options.lang=i(UM.I18N),r(n))};s.prototype={ready:function(e){var t=this;e&&(t.isReady?e.apply(t):t.addListener("ready",e))},setOpt:function(e,t){var n={};utils.isString(e)?n[e]=t:n=e,utils.extend(this.options,n,!0)},getOpt:function(e){return this.options[e]||""},destroy:function(){var e=this;e.fireEvent("destroy");var t=e.container.parentNode;t===document.body&&(t=e.container);var n=e.textarea;n?n.style.display="":(n=document.createElement("textarea"),t.parentNode.insertBefore(n,t)),n.style.width=e.body.offsetWidth+"px",n.style.height=e.body.offsetHeight+"px",n.value=e.getContent(),n.id=e.key,t.contains(n)&&$(n).insertBefore(t),t.innerHTML="",domUtils.remove(t),UM.clearCache(e.id);for(var r in e)e.hasOwnProperty(r)&&delete this[r]},initialCont:function(e){if(e){e.getAttribute("name")&&(this.options.textarea=e.getAttribute("name"));if(e&&/script|textarea/ig.test(e.tagName)){var t=document.createElement("div");e.parentNode.insertBefore(t,e),this.options.initialContent=UM.htmlparser(e.value||e.innerHTML||this.options.initialContent).toHtml(),e.className&&(t.className=e.className),e.style.cssText&&(t.style.cssText=e.style.cssText),/textarea/i.test(e.tagName)?(this.textarea=e,this.textarea.style.display="none"):(e.parentNode.removeChild(e),e.id&&(t.id=e.id)),e=t,e.innerHTML=""}return e}return null},render:function(e){var t=this,n=t.options,r=function(t){return parseInt($(e).css(t))};utils.isString(e)&&(e=document.getElementById(e));if(e){this.id=e.getAttribute("id"),UM.setEditor(this),utils.cssRule("edui-style-body",t.options.initialStyle,document),e=this.initialCont(e),e.className+=" edui-body-container",n.initialFrameWidth?n.minFrameWidth=n.initialFrameWidth:n.minFrameWidth=n.initialFrameWidth=$(e).width()||UM.defaultWidth,n.initialFrameHeight?n.minFrameHeight=n.initialFrameHeight:n.initialFrameHeight=n.minFrameHeight=$(e).height()||UM.defaultHeight,e.style.width=/%$/.test(n.initialFrameWidth)?"100%":n.initialFrameWidth-r("padding-left")-r("padding-right")+"px";var i=/%$/.test(n.initialFrameHeight)?"100%":n.initialFrameHeight-r("padding-top")-r("padding-bottom");this.options.autoHeightEnabled?(e.style.minHeight=i+"px",e.style.height="",browser.ie&&browser.version<=6&&(e.style.height=i,e.style.setExpression("height","this.scrollHeight <= "+i+' ? "'+i+'px" : "auto"'))):$(e).height(i),e.style.zIndex=n.zIndex,this._setup(e)}},_setup:function(e){var t=this,r=t.options;e.contentEditable=!0,document.body.spellcheck=!1,t.document=document,t.window=document.defaultView||document.parentWindow,t.body=e,t.$body=$(e),t.selection=new dom.Selection(document,t.body),t._isEnabled=!1;var i;browser.gecko&&(i=this.selection.getNative())&&i.removeAllRanges(),this._initEvents();for(var s=e.parentNode;s&&!domUtils.isBody(s);s=s.parentNode)if(s.tagName=="FORM"){t.form=s,t.options.autoSyncData?$(e).on("blur",function(){n(s,t)}):$(s).on("submit",function(){n(this,t)});break}if(r.initialContent)if(r.autoClearinitialContent){var o=t.execCommand;t.execCommand=function(){return t.fireEvent("firstBeforeExecCommand"),o.apply(t,arguments)},this._setDefaultContent(r.initialContent)}else this.setContent(r.initialContent,!1,!0);domUtils.isEmptyNode(t.body)&&(t.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),r.focus&&setTimeout(function(){t.focus(t.options.focusInEnd),!t.options.autoClearinitialContent&&t._selectionChange()},0),t.container||(t.container=e.parentNode),t._bindshortcutKeys(),t.isReady=1,t.fireEvent("ready"),r.onready&&r.onready.call(t),(!browser.ie||browser.ie9above)&&$(t.body).on("blur focus",function(e){var n=t.selection.getNative();if(e.type=="blur")n.rangeCount>0&&(t._bakRange=n.getRangeAt(0));else{try{t._bakRange&&(n.removeAllRanges(),n.addRange(t._bakRange))}catch(e){}t._bakRange=null}}),!r.isShow&&t.setHide(),r.readonly&&t.setDisabled()},sync:function(e){var t=this,r=e?document.getElementById(e):domUtils.findParent(t.body.parentNode,function(e){return e.tagName=="FORM"},!0);r&&n(r,t)},setHeight:function(e,t){!t&&(this.options.initialFrameHeight=e),this.options.autoHeightEnabled?($(this.body).css({"min-height":e+"px"}),browser.ie&&browser.version<=6&&this.container&&(this.container.style.height=e,this.container.style.setExpression("height","this.scrollHeight <= "+e+' ? "'+e+'px" : "auto"'))):$(this.body).height(e),this.fireEvent("resize")},setWidth:function(e){this.$container&&this.$container.width(e),$(this.body).width(e-$(this.body).css("padding-left").replace("px","")*1-$(this.body).css("padding-right").replace("px","")*1),this.fireEvent("resize")},addshortcutkey:function(e,t){var n={};t?n[e]=t:n=e,utils.extend(this.shortcutkeys,n)},_bindshortcutKeys:function(){var e=this,t=this.shortcutkeys;e.addListener("keydown",function(n,r){var i=r.keyCode||r.which;for(var s in t){var o=t[s].split(",");for(var u=0,a;a=o[u++];){a=a.split(":");var f=a[0],l=a[1];if(/^(ctrl)(\+shift)?\+(\d+)$/.test(f.toLowerCase())||/^(\d+)$/.test(f))if((RegExp.$1=="ctrl"?r.ctrlKey||r.metaKey:0)&&(RegExp.$2!=""?r[RegExp.$2.slice(1)+"Key"]:1)&&i==RegExp.$3||i==RegExp.$1)e.queryCommandState(s,l)!=-1&&e.execCommand(s,l),domUtils.preventDefault(r)}}})},getContent:function(e,t,n,r,i){var s=this;e&&utils.isFunction(e)&&(t=e,e="");if(t?!t():!this.hasContents())return"";s.fireEvent("beforegetcontent");var o=UM.htmlparser(s.body.innerHTML,r);return s.filterOutputRule(o),s.fireEvent("aftergetcontent",o),o.toHtml(i)},getAllHtml:function(){var e=this,t=[],n="";e.fireEvent("getAllHtml",t);if(browser.ie&&browser.version>8){var r="";utils.each(e.document.styleSheets,function(e){r+=e.href?'<link rel="stylesheet" type="text/css" href="'+e.href+'" />':"<style>"+e.cssText+"</style>"}),utils.each(e.document.getElementsByTagName("script"),function(e){r+=e.outerHTML})}return"<html><head>"+(e.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+e.options.charset+'"/>':"")+(r||e.document.getElementsByTagName("head")[0].innerHTML)+t.join("\n")+"</head>"+"<body "+(ie&&browser.version<9?'class="view"':"")+">"+e.getContent(null,null,!0)+"</body></html>"},getPlainTxt:function(){var e=new RegExp(domUtils.fillChar,"g"),t=this.body.innerHTML.replace(/[\n\r]/g,"");return t=t.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(e,t,n){return dtd.$block[n]?"\n":t?t:""}),t.replace(e,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var e=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(e,"").replace(/\u00a0/g," ")},setContent:function(e,t,r){function o(e){return e.tagName=="DIV"&&e.getAttribute("cdata_tag")}var i=this;i.fireEvent("beforesetcontent",e);var s=UM.htmlparser(e);i.filterInputRule(s),e=s.toHtml(),i.body.innerHTML=(t?i.body.innerHTML:"")+e;if(i.options.enterTag=="p"){var u=this.body.firstChild,a;if(!u||u.nodeType==1&&(dtd.$cdata[u.tagName]||o(u)||domUtils.isCustomeNode(u))&&u===this.body.lastChild)this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;else{var f=i.document.createElement("p");while(u){while(u&&(u.nodeType==3||u.nodeType==1&&dtd.p[u.tagName]&&!dtd.$cdata[u.tagName]))a=u.nextSibling,f.appendChild(u),u=a;if(f.firstChild){if(!u){i.body.appendChild(f);break}u.parentNode.insertBefore(f,u),f=i.document.createElement("p")}u=u.nextSibling}}}i.fireEvent("aftersetcontent"),i.fireEvent("contentchange"),!r&&i._selectionChange(),i._bakRange=i._bakIERange=i._bakNativeRange=null;var l;browser.gecko&&(l=this.selection.getNative())&&l.removeAllRanges(),i.options.autoSyncData&&i.form&&n(i.form,i)},focus:function(e){try{var t=this,n=t.selection.getRange();e?n.setStartAtLast(t.body.lastChild).setCursor(!1,!0):n.select(!0),this.fireEvent("focus")}catch(r){}},blur:function(){var e=this.selection.getNative();e.empty?e.empty():e.removeAllRanges(),this.fireEvent("blur")},isFocus:function(){return this.fireEvent("isfocus")===!0?!0:this.selection.isFocus()},_initEvents:function(){var e=this,t=e.body,n=function(){e._proxyDomEvent.apply(e,arguments)};$(t).on("click contextmenu mousedown keydown keyup keypress mouseup mouseover mouseout selectstart",n).on("focus blur",n).on("mouseup keydown",function(t){if(t.type=="keydown"&&(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey))return;if(t.button==2)return;e._selectionChange(250,t)})},_proxyDomEvent:function(e){return this.fireEvent(e.type.replace(/^on/,""),e)},_selectionChange:function(e,n){var r=this,i=!1,s,o;if(browser.ie&&browser.version<9&&n&&n.type=="mouseup"){var u=this.selection.getRange();u.collapsed||(i=!0,s=n.clientX,o=n.clientY)}clearTimeout(t),t=setTimeout(function(){if(!r.selection.getNative())return;var e;if(i&&r.selection.getNative().type=="None"){e=r.document.body.createTextRange();try{e.moveToPoint(s,o)}catch(t){e=null}}var u;e&&(u=r.selection.getIERange,r.selection.getIERange=function(){return e}),r.selection.cache(),u&&(r.selection.getIERange=u),r.selection._cachedRange&&r.selection._cachedStartElement&&(r.fireEvent("beforeselectionchange"),r.fireEvent("selectionchange",!!n),r.fireEvent("afterselectionchange"),r.selection.clear())},e||50)},_callCmdFn:function(e,t){t=Array.prototype.slice.call(t,0);var n=t.shift().toLowerCase(),r,i;r=this.commands[n]||UM.commands[n],i=r&&r[e];if((!r||!i)&&e=="queryCommandState")return 0;if(i)return i.apply(this,[n].concat(t))},execCommand:function(e){if(!this.isFocus()){var t=this.selection._bakRange;t?t.select():this.focus(!0)}e=e.toLowerCase();var n=this,r,i=n.commands[e]||UM.commands[e];return!i||!i.execCommand?null:(!i.notNeedUndo&&!n.__hasEnterExecCommand?(n.__hasEnterExecCommand=!0,n.queryCommandState.apply(n,arguments)!=-1&&(n.fireEvent("saveScene"),n.fireEvent("beforeexeccommand",e),r=this._callCmdFn("execCommand",arguments),!i.ignoreContentChange&&!n._ignoreContentChange&&n.fireEvent("contentchange"),n.fireEvent("afterexeccommand",e),n.fireEvent("saveScene")),n.__hasEnterExecCommand=!1):(r=this._callCmdFn("execCommand",arguments),!n.__hasEnterExecCommand&&!i.ignoreContentChange&&!n._ignoreContentChange&&n.fireEvent("contentchange")),!n.__hasEnterExecCommand&&!i.ignoreContentChange&&!n._ignoreContentChange&&n._selectionChange(),r)},queryCommandState:function(e){try{return this._callCmdFn("queryCommandState",arguments)}catch(t){return 0}},queryCommandValue:function(e){try{return this._callCmdFn("queryCommandValue",arguments)}catch(t){return null}},hasContents:function(e){if(e)for(var t=0,n;n=e[t++];)if(this.body.getElementsByTagName(n).length>0)return!0;if(!domUtils.isEmptyBlock(this.body))return!0;e=["div"];for(t=0;n=e[t++];){var r=domUtils.getElementsByTagName(this.body,n);for(var i=0,s;s=r[i++];)if(domUtils.isCustomeNode(s))return!0}return!1},reset:function(){this.fireEvent("reset")},isEnabled:function(){return this._isEnabled!=1},setEnabled:function(){var e=this,t;e.body.contentEditable=!0;if(e.lastBk){t=e.selection.getRange();try{t.moveToBookmark(e.lastBk),delete e.lastBk}catch(n){t.setStartAtFirst(e.body).collapse(!0)}t.select(!0)}e.bkqueryCommandState&&(e.queryCommandState=e.bkqueryCommandState,delete e.bkqueryCommandState),e._bkproxyDomEvent&&(e._proxyDomEvent=e._bkproxyDomEvent,delete e._bkproxyDomEvent),e.fireEvent("setEnabled")},enable:function(){return this.setEnabled()},setDisabled:function(e,t){var n=this;n.body.contentEditable=!1,n._except=e?utils.isArray(e)?e:[e]:[],n.lastBk||(n.lastBk=n.selection.getRange().createBookmark(!0)),n.bkqueryCommandState||(n.bkqueryCommandState=n.queryCommandState,n.queryCommandState=function(e){return utils.indexOf(n._except,e)!=-1?n.bkqueryCommandState.apply(n,arguments):-1}),!t&&!n._bkproxyDomEvent&&(n._bkproxyDomEvent=n._proxyDomEvent,n._proxyDomEvent=function(){return!1}),n.fireEvent("selectionchange"),n.fireEvent("setDisabled",n._except)},disable:function(e){return this.setDisabled(e)},_setDefaultContent:function(){function e(){var t=this;t.document.getElementById("initContent")&&(t.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",t.removeListener("firstBeforeExecCommand focus",e),setTimeout(function(){t.focus(),t._selectionChange()},0))}return function(t){var n=this;n.body.innerHTML='<p id="initContent">'+t+"</p>",n.addListener("firstBeforeExecCommand focus",e)}}(),setShow:function(){var e=this,t=e.selection.getRange();if(e.container.style.display=="none"){try{t.moveToBookmark(e.lastBk),delete e.lastBk}catch(n){t.setStartAtFirst(e.body).collapse(!0)}setTimeout(function(){t.select(!0)},100),e.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var e=this;e.lastBk||(e.lastBk=e.selection.getRange().createBookmark(!0)),e.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(e){var t=UM.I18N[this.options.lang];if(!t)throw Error("not import language file");e=(e||"").split(".");for(var n=0,r;r=e[n++];){t=t[r];if(!t)break}return t},getContentLength:function(e,t){var n=this.getContent(!1,!1,!0).length;if(e){t=(t||[]).concat(["hr","img","iframe"]),n=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var r=0,i;i=t[r++];)n+=this.body.getElementsByTagName(i).length}return n},addInputRule:function(e,t){e.ignoreUndo=t,this.inputRules.push(e)},filterInputRule:function(e,t){for(var n=0,r;r=this.inputRules[n++];){if(t&&r.ignoreUndo)continue;r.call(this,e)}},addOutputRule:function(e,t){e.ignoreUndo=t,this.outputRules.push(e)},filterOutputRule:function(e,t){for(var n=0,r;r=this.outputRules[n++];){if(t&&r.ignoreUndo)continue;r.call(this,e)}}},utils.inherits(s,EventBase)}();var filterWord=UM.filterWord=function(){function e(e){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/ig.test(e)}function t(e){return e=e.replace(/[\d.]+\w+/g,function(e){return utils.transUnitToPx(e)}),e}function n(e){return e.replace(/[\t\r\n]+/g," ").replace(/<!--[\s\S]*?-->/ig,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(e){if(browser.opera)return"";try{if(/Bitmap/i.test(e))return"";var n=e.match(/width:([ \d.]*p[tx])/i)[1],r=e.match(/height:([ \d.]*p[tx])/i)[1],i=e.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+t(n)+'" height="'+t(r)+'" src="'+i+'" />'}catch(s){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/ig,function(e,t,n,r){return t=="class"&&r=="MsoListParagraph"?e:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(e,t,n){return n.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(e,n,r,i){var s=[],o=i.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g);for(var u=0,a;a=o[u];u++){var f,l,c=a.split(":");if(c.length==2){f=c[0].toLowerCase(),l=c[1].toLowerCase();if(/^(background)\w*/.test(f)&&l.replace(/(initial|\s)/g,"").length==0||/^(margin)\w*/.test(f)&&/^0\w+$/.test(l))continue;switch(f){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(n)||(s[u]=f.replace(/^mso-|-alt$/g,"")+":"+t(l));continue;case"horiz-align":s[u]="text-align:"+l;continue;case"vert-align":s[u]="vertical-align:"+l;continue;case"font-color":case"mso-foreground":s[u]="color:"+l;continue;case"mso-background":case"mso-highlight":s[u]="background:"+l;continue;case"mso-default-height":s[u]="min-height:"+t(l);continue;case"mso-default-width":s[u]="min-width:"+t(l);continue;case"mso-padding-between-alt":s[u]="border-collapse:separate;border-spacing:"+t(l);continue;case"text-line-through":if(l=="single"||l=="double")s[u]="text-decoration:line-through";continue;case"mso-zero-height":l=="yes"&&(s[u]="display:none");continue;case"margin":if(!/[1-9]/.test(l))continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(f)||/text\-indent|padding|margin/.test(f)&&/\-[\d.]+/.test(l))continue;s[u]=f+":"+c[1]}}return n+(s.length?' style="'+s.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(e){return utils.transUnitToPx(e)})}return function(t){return e(t)?n(t):t}}();(function(){function s(e,t,n){return e.push(i),t+(n?1:-1)}function o(e,t){for(var n=0;n<t;n++)e.push(r)}function u(e,t,n,r){switch(e.type){case"root":for(var i=0,c;c=e.children[i++];)n&&c.type=="element"&&!dtd.$inlineWithA[c.tagName]&&i>1&&(s(t,r,!0),o(t,r)),u(c,t,n,r);break;case"text":a(e,t);break;case"element":f(e,t,n,r);break;case"comment":l(e,t,n)}return t}function a(e,t){e.parentNode.tagName=="pre"?t.push(e.data):t.push(n[e.parentNode.tagName]?utils.html(e.data):e.data.replace(/[ ]{2}/g," &nbsp;"))}function f(e,n,r,i){var a="";if(e.attrs){a=[];var f=e.attrs;for(var l in f)a.push(l+(f[l]!==undefined?'="'+(t[l]?utils.html(f[l]).replace(/["]/g,function(e){return"&quot;"}):utils.unhtml(f[l]))+'"':""));a=a.join(" ")}n.push("<"+e.tagName+(a?" "+a:"")+(dtd.$empty[e.tagName]?"/":"")+">"),r&&!dtd.$inlineWithA[e.tagName]&&e.tagName!="pre"&&e.children&&e.children.length&&(i=s(n,i,!0),o(n,i));if(e.children&&e.children.length)for(var c=0,h;h=e.children[c++];)r&&h.type=="element"&&!dtd.$inlineWithA[h.tagName]&&c>1&&(s(n,i),o(n,i)),u(h,n,r,i);dtd.$empty[e.tagName]||(r&&!dtd.$inlineWithA[e.tagName]&&e.tagName!="pre"&&e.children&&e.children.length&&(i=s(n,i),o(n,i)),n.push("</"+e.tagName+">"))}function l(e,t){t.push("<!--"+e.data+"-->")}function c(e,t){var n;if(e.type=="element"&&e.getAttr("id")==t)return e;if(e.children&&e.children.length)for(var r=0,i;i=e.children[r++];)if(n=c(i,t))return n}function h(e,t,n){e.type=="element"&&e.tagName==t&&n.push(e);if(e.children&&e.children.length)for(var r=0,i;i=e.children[r++];)h(i,t,n)}function p(e,t){if(e.children&&e.children.length)for(var n=0,r;r=e.children[n];)p(r,t),r.parentNode&&(r.children&&r.children.length&&t(r),r.parentNode&&n++);else t(e)}var e=UM.uNode=function(e){this.type=e.type,this.data=e.data,this.tagName=e.tagName,this.parentNode=e.parentNode,this.attrs=e.attrs||{},this.children=e.children},t={href:1,src:1,_src:1,_href:1,cdata_data:1},n={style:1,script:1},r="    ",i="\n";e.createElement=function(t){return/[<>]/.test(t)?UM.htmlparser(t).children[0]:new e({type:"element",children:[],tagName:t})},e.createText=function(e,t){return new UM.uNode({type:"text",data:t?e:utils.unhtml(e||"")})},e.prototype={toHtml:function(e){var t=[];return u(this,t,e,0),t.join("")},innerHTML:function(e){if(this.type!="element"||dtd.$empty[this.tagName])return this;if(utils.isString(e)){if(this.children)for(var t=0,n;n=this.children[t++];)n.parentNode=null;this.children=[];var r=UM.htmlparser(e);for(var t=0,n;n=r.children[t++];)this.children.push(n),n.parentNode=this;return this}var r=new UM.uNode({type:"root",children:this.children});return r.toHtml()},innerText:function(t,n){if(this.type!="element"||dtd.$empty[this.tagName])return this;if(t){if(this.children)for(var r=0,i;i=this.children[r++];)i.parentNode=null;return this.children=[],this.appendChild(e.createText(t,n)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return this.type=="element"?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){var e=this.parentNode;for(var t=0,n;n=e.children[t];t++)if(n===this)return t==0?null:e.children[t-1]},nextSibling:function(){var e=this.parentNode;for(var t=0,n;n=e.children[t++];)if(n===this)return e.children[t]},replaceChild:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n=0,r;r=this.children[n];n++)if(r===t)return this.children.splice(n,1,e),t.parentNode=null,e.parentNode=this,e}},appendChild:function(e){if(this.type=="root"||this.type=="element"&&!dtd.$empty[this.tagName]){this.children||(this.children=[]),e.parentNode&&e.parentNode.removeChild(e);for(var t=0,n;n=this.children[t];t++)if(n===e){this.children.splice(t,1);break}return this.children.push(e),e.parentNode=this,e}},insertBefore:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n=0,r;r=this.children[n];n++)if(r===t)return this.children.splice(n,0,e),e.parentNode=this,e}},insertAfter:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n=0,r;r=this.children[n];n++)if(r===t)return this.children.splice(n+1,0,e),e.parentNode=this,e}},removeChild:function(e,t){if(this.children)for(var n=0,r;r=this.children[n];n++)if(r===e){this.children.splice(n,1),r.parentNode=null;if(t&&r.children&&r.children.length)for(var i=0,s;s=r.children[i];i++)this.children.splice(n+i,0,s),s.parentNode=this;return r}},getAttr:function(e){return this.attrs&&this.attrs[e.toLowerCase()]},setAttr:function(e,t){if(!e){delete this.attrs;return}this.attrs||(this.attrs={});if(utils.isObject(e))for(var n in e)e[n]?this.attrs[n.toLowerCase()]=e[n]:delete this.attrs[n];else t?this.attrs[e.toLowerCase()]=t:delete this.attrs[e]},hasAttr:function(e){var t=this.getAttr(e);return t!==null&&t!==undefined},getIndex:function(){var e=this.parentNode;for(var t=0,n;n=e.children[t];t++)if(n===this)return t;return-1},getNodeById:function(e){var t;if(this.children&&this.children.length)for(var n=0,r;r=this.children[n++];)if(t=c(r,e))return t},getNodesByTagName:function(e){e=utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");var t=[],n=this;return utils.each(e,function(e){if(n.children&&n.children.length)for(var r=0,i;i=n.children[r++];)h(i,e,t)}),t},getStyle:function(e){var t=this.getAttr("style");if(!t)return"";var n=new RegExp("(^|;)\\s*"+e+":([^;]+)","i"),r=t.match(n);return r&&r[0]?r[2]:""},setStyle:function(e,t){function n(e,t){var n=new RegExp("(^|;)\\s*"+e+":([^;]+;?)","gi");r=r.replace(n,"$1"),t&&(r=e+":"+utils.unhtml(t)+";"+r)}var r=this.getAttr("style");r||(r="");if(utils.isObject(e))for(var i in e)n(i,e[i]);else n(e,t);this.setAttr("style",utils.trim(r))},hasClass:function(e){if(this.hasAttr("class")){var t=this.getAttr("class").split(/\s+/),n=!1;return $.each(t,function(t,r){r===e&&(n=!0)}),n}return!1},addClass:function(e){var t=null,n=!1;this.hasAttr("class")?(t=this.getAttr("class"),t=t.split(/\s+/),t.forEach(function(t){if(t===e){n=!0;return}}),!n&&t.push(e),this.setAttr("class",t.join(" "))):this.setAttr("class",e)},removeClass:function(e){if(this.hasAttr("class")){var t=this.getAttr("class");t=t.replace(new RegExp("\\b"+e+"\\b","g"),""),this.setAttr("class",utils.trim(t).replace(/[ ]{2,}/g," "))}},traversal:function(e){return this.children&&this.children.length&&p(this,e),this}}})();var htmlparser=UM.htmlparser=function(e,t){function f(e,t){if(a[e.tagName]){var n=o.createElement(a[e.tagName]);e.appendChild(n),n.appendChild(o.createText(t)),e=n}else e.appendChild(o.createText(t))}function l(e,t,n){var i;if(i=u[t]){var a=e,f;while(a.type!="root"){if(utils.isArray(i)?utils.indexOf(i,a.tagName)!=-1:i==a.tagName){e=a,f=!0;break}a=a.parentNode}f||(e=l(e,utils.isArray(i)?i[0]:i))}var c=new o({parentNode:e,type:"element",tagName:t.toLowerCase(),children:dtd.$empty[t]?null:[]});if(n){var h={},p;while(p=r.exec(n))h[p[1].toLowerCase()]=s[p[1].toLowerCase()]?p[2]||p[3]||p[4]:utils.unhtml(p[2]||p[3]||p[4]);c.attrs=h}return e.children.push(c),dtd.$empty[t]?e:c}function c(e,t){e.children.push(new o({type:"comment",data:t,parentNode:e}))}var n=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,r=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,i={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};e=e.replace(new RegExp(domUtils.fillChar,"g"),""),t||(e=e.replace(new RegExp("[\\r\\t\\n"+(t?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(t?"":" ")+"]*","g"),function(e,n){return n&&i[n.toLowerCase()]?e.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):e.replace(new RegExp("^[\\r\\n"+(t?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(t?"":" ")+"]+$"),"")}));var s={href:1,src:1},o=UM.uNode,u={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},a={ol:"li",ul:"li"},h,p=0,d=0,v=new o({type:"root",children:[]}),m=v;while(h=n.exec(e)){p=h.index;try{p>d&&f(m,e.slice(d,p));if(h[3])dtd.$cdata[m.tagName]?f(m,h[0]):m=l(m,h[3].toLowerCase(),h[4]);else if(h[1]){if(m.type!="root")if(dtd.$cdata[m.tagName]&&!dtd.$cdata[h[1]])f(m,h[0]);else{var g=m;while(m.type=="element"&&m.tagName!=h[1].toLowerCase()){m=m.parentNode;if(m.type=="root")throw m=g,"break"}m=m.parentNode}}else h[2]&&c(m,h[2])}catch(y){}d=n.lastIndex}return d<e.length&&f(m,e.slice(d)),v},filterNode=UM.filterNode=function(){function e(t,n){switch(t.type){case"text":break;case"element":var r;if(r=n[t.tagName])if(r==="-")t.parentNode.removeChild(t);else if(utils.isFunction(r)){var i=t.parentNode,s=t.getIndex();r(t);if(t.parentNode){if(t.children)for(var o=0,u;u=t.children[o];)e(u,n),u.parentNode&&o++}else for(var o=s,u;u=i.children[o];)e(u,n),u.parentNode&&o++}else{var a=r.$;if(a&&t.attrs){var f={},l;for(var c in a){l=t.getAttr(c);if(c=="style"&&utils.isArray(a[c])){var h=[];utils.each(a[c],function(e){var n;(n=t.getStyle(e))&&h.push(e+":"+n)}),l=h.join(";")}l&&(f[c]=l)}t.attrs=f}if(t.children)for(var o=0,u;u=t.children[o];)e(u,n),u.parentNode&&o++}else if(dtd.$cdata[t.tagName])t.parentNode.removeChild(t);else{var i=t.parentNode,s=t.getIndex();t.parentNode.removeChild(t,!0);for(var o=s,u;u=i.children[o];)e(u,n),u.parentNode&&o++}break;case"comment":t.parentNode.removeChild(t)}}return function(t,n){if(utils.isEmptyObject(n))return t;var r;(r=n["-"])&&utils.each(r.split(" "),function(e){n[e]="-"});for(var i=0,s;s=t.children[i];)e(s,n),s.parentNode&&i++;return t}}();UM.commands.inserthtml={execCommand:function(e,t,n){var r=this,i,s;if(!t)return;if(r.fireEvent("beforeinserthtml",t)===!0)return;i=r.selection.getRange(),s=i.document.createElement("div"),s.style.display="inline";if(!n){var o=UM.htmlparser(t);r.options.filterRules&&UM.filterNode(o,r.options.filterRules),r.filterInputRule(o),t=o.toHtml()}s.innerHTML=utils.trim(t);if(!i.collapsed){var u=i.startContainer;domUtils.isFillChar(u)&&i.setStartBefore(u),u=i.endContainer,domUtils.isFillChar(u)&&i.setEndAfter(u),i.txtToElmBoundary(),i.endContainer&&i.endContainer.nodeType==1&&(u=i.endContainer.childNodes[i.endOffset],u&&domUtils.isBr(u)&&i.setEndAfter(u)),i.startOffset==0&&(u=i.startContainer,domUtils.isBoundaryNode(u,"firstChild")&&(u=i.endContainer,i.endOffset==(u.nodeType==3?u.nodeValue.length:u.childNodes.length)&&domUtils.isBoundaryNode(u,"lastChild")&&(r.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",i.setStart(r.body.firstChild,0).collapse(!0)))),!i.collapsed&&i.deleteContents();if(i.startContainer.nodeType==1){var a=i.startContainer.childNodes[i.startOffset],f;if(a&&domUtils.isBlockElm(a)&&(f=a.previousSibling)&&domUtils.isBlockElm(f)){i.setEnd(f,f.childNodes.length).collapse();while(a.firstChild)f.appendChild(a.firstChild);domUtils.remove(a)}}}var a,l,f,c,h=0,p;i.inFillChar()&&(a=i.startContainer,domUtils.isFillChar(a)?(i.setStartBefore(a).collapse(!0),domUtils.remove(a)):domUtils.isFillChar(a,!0)&&(a.nodeValue=a.nodeValue.replace(fillCharReg,""),i.startOffset--,i.collapsed&&i.collapse(!0)));while(a=s.firstChild){if(h){var d=r.document.createElement("p");while(a&&(a.nodeType==3||!dtd.$block[a.tagName]))p=a.nextSibling,d.appendChild(a),a=p;d.firstChild&&(a=d)}i.insertNode(a),p=a.nextSibling;if(!h&&a.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(a)){l=domUtils.findParent(a,function(e){return domUtils.isBlockElm(e)});if(l&&l.tagName.toLowerCase()!="body"&&(!dtd[l.tagName][a.nodeName]||a.parentNode!==l)){if(!dtd[l.tagName][a.nodeName])f=l;else{c=a.parentNode;while(c!==l)f=c,c=c.parentNode}domUtils.breakParent(a,f||c);var f=a.previousSibling;domUtils.trimWhiteTextNode(f),f.childNodes.length||domUtils.remove(f),!browser.ie&&(v=a.nextSibling)&&domUtils.isBlockElm(v)&&v.lastChild&&!domUtils.isBr(v.lastChild)&&v.appendChild(r.document.createElement("br")),h=1}}var v=a.nextSibling;if(!s.firstChild&&v&&domUtils.isBlockElm(v)){i.setStart(v,0).collapse(!0);break}i.setEndAfter(a).collapse()}a=i.startContainer,p&&domUtils.isBr(p)&&domUtils.remove(p);if(domUtils.isBlockElm(a)&&domUtils.isEmptyNode(a))if(p=a.nextSibling)domUtils.remove(a),p.nodeType==1&&dtd.$block[p.tagName]&&i.setStart(p,0).collapse(!0).shrinkBoundary();else try{a.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(m){i.setStartBefore(a),domUtils.remove(a)}try{if(browser.ie9below&&i.startContainer.nodeType==1&&!i.startContainer.childNodes[i.startOffset]){var g=i.startContainer,f=g.childNodes[i.startOffset-1];if(f&&f.nodeType==1&&dtd.$empty[f.tagName]){var y=this.document.createTextNode(domUtils.fillChar);i.insertNode(y).setStart(y,0).collapse(!0)}}setTimeout(function(){i.select(!0)})}catch(m){}setTimeout(function(){i=r.selection.getRange(),i.scrollIntoView(r.options),r.fireEvent("afterinserthtml")},200)}},UM.commands.insertimage={execCommand:function(e,t){t=utils.isArray(t)?t:[t];if(!t.length)return;var n=this,r=[],i="",s;s=t[0];if(t.length==1)i='<img src="'+s.src+'" '+(s._src?' _src="'+s._src+'" ':"")+(s.width?'width="'+s.width+'" ':"")+(s.height?' height="'+s.height+'" ':"")+(s["floatStyle"]=="left"||s["floatStyle"]=="right"?' style="float:'+s.floatStyle+';"':"")+(s.title&&s.title!=""?' title="'+s.title+'"':"")+(s.border&&s.border!="0"?' border="'+s.border+'"':"")+(s.alt&&s.alt!=""?' alt="'+s.alt+'"':"")+(s.hspace&&s.hspace!="0"?' hspace = "'+s.hspace+'"':"")+(s.vspace&&s.vspace!="0"?' vspace = "'+s.vspace+'"':"")+"/>",s["floatStyle"]=="center"&&(i='<p style="text-align: center">'+i+"</p>"),r.push(i);else for(var o=0;s=t[o++];)i="<p "+(s["floatStyle"]=="center"?'style="text-align: center" ':"")+'><img src="'+s.src+'" '+(s.width?'width="'+s.width+'" ':"")+(s._src?' _src="'+s._src+'" ':"")+(s.height?' height="'+s.height+'" ':"")+' style="'+(s.floatStyle&&s["floatStyle"]!="center"?"float:"+s.floatStyle+";":"")+(s.border||"")+'" '+(s.title?' title="'+s.title+'"':"")+" /></p>",r.push(i);n.execCommand("insertHtml",r.join(""),!0)}},UM.plugins.justify=function(){var e=this;$.each("justifyleft justifyright justifycenter justifyfull".split(" "),function(t,n){e.commands[n]={execCommand:function(e){return this.document.execCommand(e)},queryCommandValue:function(e){var t=this.document.queryCommandValue(e);return t===!0||t==="true"?e.replace(/justify/,""):""},queryCommandState:function(e){return this.document.queryCommandState(e)?1:0}}})},UM.plugins.font=function(){var e=this,t={forecolor:"forecolor",backcolor:"backcolor",fontsize:"fontsize",fontfamily:"fontname"},n={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"},r={forecolor:"color",fontsize:"size",fontfamily:"face"};e.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"},{name:"sans-serif",val:"sans-serif"}],fontsize:[10,12,16,18,24,32,48]}),e.addOutputRule(function(e){utils.each(e.getNodesByTagName("font"),function(e){if(e.tagName=="font"){var t=[];for(var n in e.attrs)switch(n){case"size":var r=e.attrs[n];$.each({10:"1",12:"2",16:"3",18:"4",24:"5",32:"6",48:"7"},function(e,t){if(t==r)return r=e,!1}),t.push("font-size:"+r+"px");break;case"color":t.push("color:"+e.attrs[n]);break;case"face":t.push("font-family:"+e.attrs[n]);break;case"style":t.push(e.attrs[n])}e.attrs={style:t.join(";")}}e.tagName="span",e.parentNode.tagName=="span"&&e.parentNode.children.length==1&&($.each(e.attrs,function(t,n){e.parentNode.attrs[t]=t=="style"?e.parentNode.attrs[t]+n:n}),e.parentNode.removeChild(e,!0))})});for(var i in t)(function(i){e.commands[i]={execCommand:function(e,r){if(r=="transparent")return;var i=this.selection.getRange();if(!i.collapsed){e=="fontsize"&&(r={10:"1",12:"2",16:"3",18:"4",24:"5",32:"6",48:"7"}[(r+"").replace(/px/,"")]),this.document.execCommand(t[e],!1,r),browser.gecko&&$.each(this.$body.find("a"),function(e,t){var n=t.parentNode;if(n.lastChild===n.firstChild&&/FONT|SPAN/.test(n.tagName)){var r=n.cloneNode(!1);r.innerHTML=t.innerHTML,$(t).html("").append(r).insertBefore(n),$(n).remove()}});if(!browser.ie){var o=this.selection.getNative().getRangeAt(0),u=o.commonAncestorContainer,i=this.selection.getRange(),a=i.createBookmark(!0);$(u).find("a").each(function(e,t){var n=t.parentNode;if(n.nodeName=="FONT"){var r=n.cloneNode(!1);r.innerHTML=t.innerHTML,$(t).html("").append(r)}}),i.moveToBookmark(a).select()}return!0}var s=$("<span></span>").css(n[e],r)[0];i.insertNode(s).setStart(s,0).setCursor()},queryCommandValue:function(t){var i=e.selection.getStart(),s=$(i).css(n[t]);return s===undefined&&(s=$(i).attr(r[t])),s?utils.fixColor(t,s).replace(/px/,""):""},queryCommandState:function(e){return this.queryCommandValue(e)}}})(i)},UM.plugins.link=function(){var e=this;e.setOpt("autourldetectinie",!1),browser.ie&&this.options.autourldetectinie===!1&&this.addListener("keyup",function(e,t){var n=this,r=t.keyCode;if(r==13||r==32){var i=n.selection.getRange(),s=i.startContainer;if(r==13){if(s.nodeName=="P"){var o=s.previousSibling;if(o&&o.nodeType==1){var o=o.lastChild;o&&o.nodeName=="A"&&!o.getAttribute("_href")&&domUtils.remove(o,!0)}}}else r==32&&s.nodeType==3&&/^\s$/.test(s.nodeValue)&&(s=s.previousSibling,s&&s.nodeName=="A"&&!s.getAttribute("_href")&&domUtils.remove(s,!0))}}),this.addOutputRule(function(e){$.each(e.getNodesByTagName("a"),function(e,t){var n=utils.html(t.getAttr("_href"));/^(ftp|https?|\/|file)/.test(n)||(n="http://"+n),t.setAttr("href",n),t.setAttr("_href"),t.getAttr("title")==""&&t.setAttr("title")})}),this.addInputRule(function(e){$.each(e.getNodesByTagName("a"),function(e,t){t.setAttr("_href",utils.html(t.getAttr("href")))})}),e.commands.link={execCommand:function(e,t){var n=this,r=n.selection.getRange();if(r.collapsed){var i=r.startContainer;(i=domUtils.findParentByTagName(i,"a",!0))?($(i).attr(t),r.selectNode(i).select()):r.insertNode($("<a>"+t.href+"</a>").attr(t)[0]).select()}else n.document.execCommand("createlink",!1,"_umeditor_link"),utils.each(domUtils.getElementsByTagName(n.body,"a",function(e){return e.getAttribute("href")=="_umeditor_link"}),function(e){$(e).text()=="_umeditor_link"&&$(e).text(t.href),domUtils.setAttributes(e,t),r.selectNode(e).select()})},queryCommandState:function(){return this.queryCommandValue("link")?1:0},queryCommandValue:function(){var e=this.selection.getStartElementPath(),t;return $.each(e,function(e,n){if(n.nodeName=="A")return t=n,!1}),t}},e.commands.unlink={execCommand:function(){this.document.execCommand("unlink")}}},UM.commands.print={execCommand:function(){var e=this,t="editor_print_"+ +(new Date);$('<iframe src="" id="'+t+'" name="'+t+'" frameborder="0"></iframe>').attr("id",t).css({width:"0px",height:"0px",overflow:"hidden","float":"left",position:"absolute",top:"-10000px",left:"-10000px"}).appendTo(e.$container.find(".edui-dialog-container"));var n=window.open("",t,""),r=n.document;r.open(),r.write("<html><head></head><body><div>"+this.getContent(null,null,!0)+"</div><script>"+"setTimeout(function(){"+"window.print();"+"setTimeout(function(){"+"window.parent.$('#"+t+"').remove();"+"},100);"+"},200);"+"</script></body></html>"),r.close()},notNeedUndo:1},UM.plugins.paragraph=function(){var e=this;e.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""}),e.commands.paragraph={execCommand:function(e,t){return this.document.execCommand("formatBlock",!1,"<"+t+">")},queryCommandValue:function(){try{var e=this.document.queryCommandValue("formatBlock")}catch(t){}return e}}},UM.plugins.horizontal=function(){var e=this;e.commands.horizontal={execCommand:function(){this.document.execCommand("insertHorizontalRule");var t=e.selection.getRange().txtToElmBoundary(!0),n=t.startContainer;if(domUtils.isBody(t.startContainer)){var r=t.startContainer.childNodes[t.startOffset];r||(r=$("<p></p>").appendTo(t.startContainer).html(browser.ie?"&nbsp;":"<br/>")[0]),t.setStart(r,0).setCursor()}else{while(dtd.$inline[n.tagName]&&n.lastChild===n.firstChild){var i=n.parentNode;i.appendChild(n.firstChild),i.removeChild(n),n=i}while(dtd.$inline[n.tagName])n=n.parentNode;if(n.childNodes.length==1&&n.lastChild.nodeName=="HR"){var s=n.lastChild;$(s).insertBefore(n),t.setStart(n,0).setCursor()}else{s=$("hr",n)[0],domUtils.breakParent(s,n);var o=s.previousSibling;o&&domUtils.isEmptyBlock(o)&&$(o).remove(),t.setStart(s.nextSibling,0).setCursor()}}}}},UM.commands.cleardoc={execCommand:function(){var e=this,t=e.selection.getRange();e.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",t.setStart(e.body.firstChild,0).setCursor(!1,!0),setTimeout(function(){e.fireEvent("clearDoc")},0)}},UM.plugins.undo=function(){function u(e,t){if(e.length!=t.length)return 0;for(var n=0,r=e.length;n<r;n++)if(e[n]!=t[n])return 0;return 1}function a(e,t){return e.collapsed!=t.collapsed?0:!u(e.startAddress,t.startAddress)||!u(e.endAddress,t.endAddress)?0:1}function f(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&this.list.length==1){this.reset();return}while(this.list[this.index].content==this.list[this.index-1].content){this.index--;if(this.index==0)return this.restore(0)}this.restore(--this.index)}},this.redo=function(){if(this.hasRedo){while(this.list[this.index].content==this.list[this.index+1].content){this.index++;if(this.index==this.list.length-1)return this.restore(this.index)}this.restore(++this.index)}},this.restore=function(){var e=this.editor,t=this.list[this.index],n=UM.htmlparser(t.content.replace(i,""));e.options.autoClearEmptyNode=!1,e.filterInputRule(n,!0),e.options.autoClearEmptyNode=o,e.body.innerHTML=n.toHtml(),e.fireEvent("afterscencerestore"),browser.ie&&utils.each(domUtils.getElementsByTagName(e.document,"td th caption p"),function(t){domUtils.isEmptyNode(t)&&domUtils.fillNode(e.document,t)});try{var r=(new dom.Range(e.document,e.body)).moveToAddress(t.address);if(browser.ie&&r.collapsed&&r.startContainer.nodeType==1){var u=r.startContainer.childNodes[r.startOffset];(!u||u.nodeType==1&&dtd.$empty[u])&&r.insertNode(e.document.createTextNode(" ")).collapse(!0)}r.select(s[r.startContainer.nodeName.toLowerCase()])}catch(a){}this.update(),this.clearKey(),e.fireEvent("reset",!0)},this.getScene=function(){var e=this.editor,t=e.selection.getRange(),n=t.createAddress(!1,!0);e.fireEvent("beforegetscene");var r=UM.htmlparser(e.body.innerHTML,!0);e.options.autoClearEmptyNode=!1,e.filterOutputRule(r,!0),e.options.autoClearEmptyNode=o;var i=r.toHtml();return browser.ie&&(i=i.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">")),e.fireEvent("aftergetscene"),{address:n,content:i}},this.save=function(t,r){clearTimeout(e);var i=this.getScene(r),s=this.list[this.index];if(s&&s.content==i.content&&(t?1:a(s.address,i.address)))return;this.list=this.list.slice(0,this.index+1),this.list.push(i),this.list.length>n&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update()},this.update=function(){this.hasRedo=!!this.list[this.index+1],this.hasUndo=!!this.list[this.index-1]},this.reset=function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.clearKey()},this.clearKey=function(){h=0,p=null}}function l(){this.undoManger.save()}var e,t=this,n=t.options.maxUndoCount||20,r=t.options.maxInputCount||20,i=new RegExp(domUtils.fillChar+"|</hr>","gi"),s={ol:1,ul:1,table:1,tbody:1,tr:1,body:1},o=t.options.autoClearEmptyNode;t.undoManger=new f,t.undoManger.editor=t,t.addListener("saveScene",function(){var e=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,e)}),t.addListener("beforeexeccommand",l),t.addListener("afterexeccommand",l),t.addListener("reset",function(e,t){t||this.undoManger.reset()}),t.commands.redo=t.commands.undo={execCommand:function(e){this.undoManger[e]()},queryCommandState:function(e){return this.undoManger["has"+(e.toLowerCase()=="undo"?"Undo":"Redo")]?0:-1},notNeedUndo:1};var c={16:1,17:1,18:1,37:1,38:1,39:1,40:1},h=0,p,d=!1;t.addListener("ready",function(){$(this.body).on("compositionstart",function(){d=!0}).on("compositionend",function(){d=!1})}),t.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89,shift+ctrl+z"});var v=!0;t.addListener("keydown",function(t,n){var i=this,s=n.keyCode||n.which;if(!c[s]&&!n.ctrlKey&&!n.metaKey&&!n.shiftKey&&!n.altKey){if(d)return;if(!i.selection.getRange().collapsed){i.undoManger.save(!1,!0),v=!1;return}i.undoManger.list.length==0&&i.undoManger.save(!0),clearTimeout(e);function o(e){e.selection.getRange().collapsed&&e.fireEvent("contentchange"),e.undoManger.save(!1,!0),e.fireEvent("selectionchange")}e=setTimeout(function(){if(d){var e=setInterval(function(){d||(o(i),clearInterval(e))},300);return}o(i)},200),p=s,h++,h>=r&&o(i)}}),t.addListener("keyup",function(e,t){var n=t.keyCode||t.which;if(!c[n]&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){if(d)return;v||(this.undoManger.save(!1,!0),v=!0)}})},UM.plugins.paste=function(){function e(e){var t=this.document;if(t.getElementById("baidu_pastebin"))return;var n=this.selection.getRange(),r=n.createBookmark(),i=t.createElement("div");i.id="baidu_pastebin",browser.webkit&&i.appendChild(t.createTextNode(domUtils.fillChar+domUtils.fillChar)),this.body.appendChild(i),r.start.style.display="",i.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+$(r.start).position().top+"px",n.selectNodeContents(i).select(!0),setTimeout(function(){if(browser.webkit)for(var s=0,o=t.querySelectorAll("#baidu_pastebin"),u;u=o[s++];){if(!domUtils.isEmptyNode(u)){i=u;break}domUtils.remove(u)}try{i.parentNode.removeChild(i)}catch(a){}n.moveToBookmark(r).select(!0),e(i)},0)}function n(e){var n;if(e.firstChild){var r=domUtils.getElementsByTagName(e,"span");for(var i=0,s;s=r[i++];)(s.id=="_baidu_cut_start"||s.id=="_baidu_cut_end")&&domUtils.remove(s);if(browser.webkit){var o=e.querySelectorAll("div br");for(var i=0,u;u=o[i++];){var a=u.parentNode;a.tagName=="DIV"&&a.childNodes.length==1&&(a.innerHTML="<p><br/></p>",domUtils.remove(a))}var f=e.querySelectorAll("#baidu_pastebin");for(var i=0,l;l=f[i++];){var c=t.document.createElement("p");l.parentNode.insertBefore(c,l);while(l.firstChild)c.appendChild(l.firstChild);domUtils.remove(l)}var h=e.querySelectorAll("meta");for(var i=0,p;p=h[i++];)domUtils.remove(p);var o=e.querySelectorAll("br");for(i=0;p=o[i++];)/^apple-/i.test(p.className)&&domUtils.remove(p)}if(browser.gecko){var d=e.querySelectorAll("[_moz_dirty]");for(i=0;p=d[i++];)p.removeAttribute("_moz_dirty")}if(!browser.ie){var v=e.querySelectorAll("span.Apple-style-span");for(var i=0,p;p=v[i++];)domUtils.remove(p,!0)}n=e.innerHTML,n=UM.filterWord(n);var m=UM.htmlparser(n);t.options.filterRules&&UM.filterNode(m,t.options.filterRules),t.filterInputRule(m);if(browser.webkit){var g=m.lastChild();g&&g.type=="element"&&g.tagName=="br"&&m.removeChild(g),utils.each(t.body.querySelectorAll("div"),function(e){domUtils.isEmptyBlock(e)&&domUtils.remove(e)})}n={html:m.toHtml()},t.fireEvent("beforepaste",n,m);if(!n.html)return;t.execCommand("insertHtml",n.html,!0),t.fireEvent("afterpaste",n)}}var t=this;t.addListener("ready",function(){$(t.body).on("cut",function(){var e=t.selection.getRange();!e.collapsed&&t.undoManger&&t.undoManger.save()}).on(browser.ie||browser.opera?"keydown":"paste",function(r){if((browser.ie||browser.opera)&&(!r.ctrlKey&&!r.metaKey||r.keyCode!="86"))return;e.call(t,function(e){n(e)})})})},UM.plugins.list=function(){var e=this;e.setOpt({insertorderedlist:{decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:""}}),this.addInputRule(function(e){utils.each(e.getNodesByTagName("li"),function(e){e.children.length==0&&e.parentNode.removeChild(e)})}),e.commands.insertorderedlist=e.commands.insertunorderedlist={execCommand:function(e){this.document.execCommand(e);var t=this.selection.getRange(),n=t.createBookmark(!0);return this.$body.find("ol,ul").each(function(e,t){var n=t.parentNode;n.tagName=="P"&&n.lastChild===n.firstChild&&($(t).children().each(function(e,t){var r=n.cloneNode(!1);$(r).append(t.innerHTML),$(t).html("").append(r)}),$(t).insertBefore(n),$(n).remove()),dtd.$inline[n.tagName]&&(n.tagName=="SPAN"&&$(t).children().each(function(e,t){var r=n.cloneNode(!1);if(t.firstChild.nodeName!="P"){while(t.firstChild)r.appendChild(t.firstChild);$("<p></p>").appendTo(t).append(r)}else{while(t.firstChild)r.appendChild(t.firstChild);$(t.firstChild).append(r)}}),domUtils.remove(n,!0))}),t.moveToBookmark(n).select(),!0},queryCommandState:function(e){return this.document.queryCommandState(e)}}},function(){var e={textarea:function(e,t){var n=t.ownerDocument.createElement("textarea");return n.style.cssText="resize:none;border:0;padding:0;margin:0;overflow-y:auto;outline:0",browser.ie&&browser.version<8&&(n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px",t.onresize=function(){n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px"}),t.appendChild(n),{container:n,setContent:function(e){n.value=e},getContent:function(){return n.value},select:function(){var e;browser.ie?(e=n.createTextRange(),e.collapse(!0),e.select()):(n.setSelectionRange(0,0),n.focus())},dispose:function(){t.removeChild(n),t.onresize=null,n=null,t=null}}}};UM.plugins.source=function(){function s(n){return e.textarea(t,n)}var t=this,n=this.options,r=!1,i;n.sourceEditor="textarea",t.setOpt({sourceEditorFirst:!1});var o,u=t.getContent,a;t.commands.source={execCommand:function(){r=!r;if(r){a=t.selection.getRange().createAddress(!1,!0),t.undoManger&&t.undoManger.save(!0),browser.gecko&&(t.body.contentEditable=!1),t.body.style.cssText+=";position:absolute;left:-32768px;top:-32768px;",t.fireEvent("beforegetcontent");var e=UM.htmlparser(t.body.innerHTML);t.filterOutputRule(e),e.traversal(function(e){if(e.type=="element")switch(e.tagName){case"td":case"th":case"caption":e.children&&e.children.length==1&&e.firstChild().tagName=="br"&&e.removeChild(e.firstChild());break;case"pre":e.innerText(e.innerText().replace(/&nbsp;/g," "))}}),t.fireEvent("aftergetcontent");var n=e.toHtml(!0);i=s(t.body.parentNode),i.setContent(n);var o=function(e){return parseInt($(t.body).css(e))};$(i.container).width($(t.body).width()+o("padding-left")+o("padding-right")).height($(t.body).height()),setTimeout(function(){i.select()}),t.getContent=function(){return i.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>"}}else{t.$body.css({position:"",left:"",top:""});var f=i.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";f=f.replace(new RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(e,t){return t&&!dtd.$inlineWithA[t.toLowerCase()]?e.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,""):e.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")}),t.setContent(f),i.dispose(),i=null,t.getContent=u;var l=t.body.firstChild;l||(t.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),t.undoManger&&t.undoManger.save(!0),browser.gecko&&(t.body.contentEditable=!0);try{t.selection.getRange().moveToAddress(a).select()}catch(c){}}this.fireEvent("sourcemodechanged",r)},queryCommandState:function(){return r|0},notNeedUndo:1};var f=t.queryCommandState;t.queryCommandState=function(e){return e=e.toLowerCase(),r?e in{source:1,fullscreen:1}?f.apply(this,arguments):-1:f.apply(this,arguments)}}}(),UM.plugins.enterkey=function(){var e,t=this,n=t.options.enterTag;t.addListener("keyup",function(n,r){var i=r.keyCode||r.which;if(i==13){var s=t.selection.getRange(),o=s.startContainer,u;if(!browser.ie){if(/h\d/i.test(e)){if(browser.gecko){var a=domUtils.findParentByTagName(o,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],!0);a||(t.document.execCommand("formatBlock",!1,"<p>"),u=1)}else if(o.nodeType==1){var f=t.document.createTextNode(""),l;s.insertNode(f),l=domUtils.findParentByTagName(f,"div",!0);if(l){var c=t.document.createElement("p");while(l.firstChild)c.appendChild(l.firstChild);l.parentNode.insertBefore(c,l),domUtils.remove(l),s.setStartBefore(f).setCursor(),u=1}domUtils.remove(f)}t.undoManger&&u&&t.undoManger.save()}browser.opera&&s.select()}else t.fireEvent("saveScene",!0,!0)}}),t.addListener("keydown",function(r,i){var s=i.keyCode||i.which;if(s==13){if(t.fireEvent("beforeenterkeydown")){domUtils.preventDefault(i);return}t.fireEvent("saveScene",!0,!0),e="";var o=t.selection.getRange();if(!o.collapsed){var u=o.startContainer,a=o.endContainer,f=domUtils.findParentByTagName(u,"td",!0),l=domUtils.findParentByTagName(a,"td",!0);if(f&&l&&f!==l||!f&&l||f&&!l){i.preventDefault?i.preventDefault():i.returnValue=!1;return}}n=="p"&&(browser.ie||(u=domUtils.findParentByTagName(o.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],!0),!u&&!browser.opera?(t.document.execCommand("formatBlock",!1,"<p>"),browser.gecko&&(o=t.selection.getRange(),u=domUtils.findParentByTagName(o.startContainer,"p",!0),u&&domUtils.removeDirtyAttr(u))):(e=u.tagName,u.tagName.toLowerCase()=="p"&&browser.gecko&&domUtils.removeDirtyAttr(u))))}}),browser.ie&&t.addListener("setDisabled",function(){$(t.body).find("p").each(function(e,t){domUtils.isEmptyBlock(t)&&(t.innerHTML="&nbsp;")})})},UM.commands.preview={execCommand:function(){var e=window.open("","_blank",""),t=e.document,n=this.getContent(null,null,!0),r=this.getOpt("UMEDITOR_HOME_URL"),i=n.indexOf("mathquill-embedded-latex")!=-1?'<link rel="stylesheet" href="'+r+'third-party/mathquill/mathquill.css"/>'+'<script src="'+r+'third-party/jquery.min.js"></script>'+'<script src="'+r+'third-party/mathquill/mathquill.min.js"></script>':"";t.open(),t.write("<html><head>"+i+"</head><body><div>"+n+"</div></body></html>"),t.close()},notNeedUndo:1},UM.plugins.basestyle=function(){var e=["bold","underline","superscript","subscript","italic","strikethrough"],t=this;t.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+shift+85",strikeThrough:"ctrl+shift+83"}),t.addOutputRule(function(e){$.each(e.getNodesByTagName("b i u strike s"),function(e,t){switch(t.tagName){case"b":t.tagName="strong";break;case"i":t.tagName="em";break;case"u":t.tagName="span",t.setStyle("text-decoration","underline");break;case"s":case"strike":t.tagName="span",t.setStyle("text-decoration","line-through")}})}),$.each(e,function(e,n){t.commands[n]={execCommand:function(e){var t=this.selection.getRange();if(t.collapsed&&this.queryCommandState(e)!=1){var n=this.document.createElement({bold:"strong",underline:"u",superscript:"sup",subscript:"sub",italic:"em",strikethrough:"strike"}[e]);return t.insertNode(n).setStart(n,0).setCursor(!1),!0}return this.document.execCommand(e)},queryCommandState:function(e){if(browser.gecko)return this.document.queryCommandState(e);var t=this.selection.getStartElementPath(),n=!1;return $.each(t,function(t,r){switch(e){case"bold":if(r.nodeName=="STRONG"||r.nodeName=="B")return n=1,!1;break;case"underline":if(r.nodeName=="U"||r.nodeName=="SPAN"&&$(r).css("text-decoration")=="underline")return n=1,!1;break;case"superscript":if(r.nodeName=="SUP")return n=1,!1;break;case"subscript":if(r.nodeName=="SUB")return n=1,!1;break;case"italic":if(r.nodeName=="EM"||r.nodeName=="I")return n=1,!1;break;case"strikethrough":if(r.nodeName=="S"||r.nodeName=="STRIKE"||r.nodeName=="SPAN"&&$(r).css("text-decoration")=="line-through")return n=1,!1}}),n}}})},UM.plugins.video=function(){function n(t,n,r,i,s,o){return o?'<embed type="application/x-shockwave-flash" class="edui-faked-video" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+t+'" width="'+n+'" height="'+r+'"'+(s?' style="float:'+s+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >':"<img "+(i?'id="'+i+'"':"")+' width="'+n+'" height="'+r+'" _url="'+t+'" class="edui-faked-video"'+' src="'+e.options.UMEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+e.options.UMEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(s?"float:"+s+";":"")+'" />'}function r(e,t){utils.each(e.getNodesByTagName(t?"img":"embed"),function(e){if(e.getAttr("class")=="edui-faked-video"){var r=n(t?e.getAttr("_url"):e.getAttr("src"),e.getAttr("width"),e.getAttr("height"),null,e.getStyle("float")||"",t);e.parentNode.replaceChild(UM.uNode.createElement(r),e)}})}var e=this,t;e.addOutputRule(function(e){r(e,!0)}),e.addInputRule(function(e){r(e)}),e.commands.insertvideo={execCommand:function(t,r){r=utils.isArray(r)?r:[r];var i=[],s="tmpVedio";for(var o=0,u,a=r.length;o<a;o++)u=r[o],i.push(n(u.url,u.width||420,u.height||280,s+o,u.align,!1));e.execCommand("inserthtml",i.join(""),!0)},queryCommandState:function(){var t=e.selection.getRange().getClosedNode(),n=t&&t.className=="edui-faked-video";return n?1:0}}},UM.plugins.selectall=function(){var e=this;e.commands.selectall={execCommand:function(){var e=this,t=e.body,n=e.selection.getRange();n.selectNodeContents(t),domUtils.isEmptyBlock(t)&&(browser.opera&&t.firstChild&&t.firstChild.nodeType==1&&n.setStartAtFirst(t.firstChild),n.collapse(!0)),n.select(!0)},notNeedUndo:1},e.addshortcutkey({selectAll:"ctrl+65"})},UM.plugins.removeformat=function(){var e=this;e.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"}),e.commands.removeformat={execCommand:function(e,t,n,r,i){function h(e){if(e.nodeType==3||e.tagName.toLowerCase()!="span")return 0;if(browser.ie){var t=e.attributes;if(t.length){for(var n=0,r=t.length;n<r;n++)if(t[n].specified)return 0;return 1}}return!e.attributes.length}function p(e){var t=e.createBookmark();e.collapsed&&e.enlarge(!0);if(!i){var r=domUtils.findParentByTagName(e.startContainer,"a",!0);r&&e.setStartBefore(r),r=domUtils.findParentByTagName(e.endContainer,"a",!0),r&&e.setEndAfter(r)}a=e.createBookmark(),d=a.start;while((l=d.parentNode)&&!domUtils.isBlockElm(l))domUtils.breakParent(d,l),domUtils.clearEmptySibling(d);if(a.end){d=a.end;while((l=d.parentNode)&&!domUtils.isBlockElm(l))domUtils.breakParent(d,l),domUtils.clearEmptySibling(d);var u=domUtils.getNextDomNode(a.start,!1,c),f;while(u){if(u==a.end)break;f=domUtils.getNextDomNode(u,!0,c),!dtd.$empty[u.tagName.toLowerCase()]&&!domUtils.isBookmarkNode(u)&&(s.test(u.tagName)?n?(domUtils.removeStyle(u,n),h(u)&&n!="text-decoration"&&domUtils.remove(u,!0)):domUtils.remove(u,!0):!dtd.$tableContent[u.tagName]&&!dtd.$list[u.tagName]&&(domUtils.removeAttributes(u,o),h(u)&&domUtils.remove(u,!0))),u=f}}var p=a.start.parentNode;domUtils.isBlockElm(p)&&!dtd.$tableContent[p.tagName]&&!dtd.$list[p.tagName]&&domUtils.removeAttributes(p,o),p=a.end.parentNode,a.end&&domUtils.isBlockElm(p)&&!dtd.$tableContent[p.tagName]&&!dtd.$list[p.tagName]&&domUtils.removeAttributes(p,o),e.moveToBookmark(a).moveToBookmark(t);var d=e.startContainer,v,m=e.collapsed;while(d.nodeType==1&&domUtils.isEmptyNode(d)&&dtd.$removeEmpty[d.tagName])v=d.parentNode,e.setStartBefore(d),e.startContainer===e.endContainer&&e.endOffset--,domUtils.remove(d),d=v;if(!m){d=e.endContainer;while(d.nodeType==1&&domUtils.isEmptyNode(d)&&dtd.$removeEmpty[d.tagName])v=d.parentNode,e.setEndBefore(d),domUtils.remove(d),d=v}}var s=new RegExp("^(?:"+(t||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),o=n?[]:(r||this.options.removeFormatAttributes).split(","),u=new dom.Range(this.document),a,f,l,c=function(e){return e.nodeType==1};u=this.selection.getRange(),u.collapsed||(p(u),u.select())}}},UM.plugins.keystrokes=function(){var e=this,t=!0;e.addListener("keydown",function(n,r){var i=r.keyCode||r.which,s=e.selection.getRange();if(!s.collapsed&&!(r.ctrlKey||r.shiftKey||r.altKey||r.metaKey)&&(i>=65&&i<=90||i>=48&&i<=57||i>=96&&i<=111||{13:1,8:1,46:1}[i])){var o=s.startContainer;domUtils.isFillChar(o)&&s.setStartBefore(o),o=s.endContainer,domUtils.isFillChar(o)&&s.setEndAfter(o),s.txtToElmBoundary(),s.endContainer&&s.endContainer.nodeType==1&&(o=s.endContainer.childNodes[s.endOffset],o&&domUtils.isBr(o)&&s.setEndAfter(o));if(s.startOffset==0){o=s.startContainer;if(domUtils.isBoundaryNode(o,"firstChild")){o=s.endContainer;if(s.endOffset==(o.nodeType==3?o.nodeValue.length:o.childNodes.length)&&domUtils.isBoundaryNode(o,"lastChild")){e.fireEvent("saveScene"),e.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",s.setStart(e.body.firstChild,0).setCursor(!1,!0),e._selectionChange();return}}}}if(i==8){s=e.selection.getRange(),t=s.collapsed;if(e.fireEvent("delkeydown",r))return;var u,a;s.collapsed&&s.inFillChar()&&(u=s.startContainer,domUtils.isFillChar(u)?(s.setStartBefore(u).shrinkBoundary(!0).collapse(!0),domUtils.remove(u)):(u.nodeValue=u.nodeValue.replace(new RegExp("^"+domUtils.fillChar),""),s.startOffset--,s.collapse(!0).select(!0)));if(u=s.getClosedNode()){e.fireEvent("saveScene"),s.setStartBefore(u),domUtils.remove(u),s.setCursor(),e.fireEvent("saveScene"),domUtils.preventDefault(r);return}if(!browser.ie){u=domUtils.findParentByTagName(s.startContainer,"table",!0),a=domUtils.findParentByTagName(s.endContainer,"table",!0);if(u&&!a||!u&&a||u!==a){r.preventDefault();return}}u=s.startContainer;if(s.collapsed&&u.nodeType==1){var f=u.childNodes[s.startOffset-1];f&&f.nodeType==1&&f.tagName=="BR"&&(e.fireEvent("saveScene"),s.setStartBefore(f).collapse(!0),domUtils.remove(f),s.select(),e.fireEvent("saveScene"))}if(browser.chrome&&s.collapsed){while(s.startOffset==0&&!domUtils.isEmptyBlock(s.startContainer))s.setStartBefore(s.startContainer);var l=s.startContainer.childNodes[s.startOffset-1];l&&l.nodeName=="BR"&&(s.setStartBefore(l),e.fireEvent("saveScene"),$(l).remove(),s.setCursor(),e.fireEvent("saveScene"))}}if(browser.gecko&&i==46){var c=e.selection.getRange();if(c.collapsed){u=c.startContainer;if(domUtils.isEmptyBlock(u)){var h=u.parentNode;while(domUtils.getChildCount(h)==1&&!domUtils.isBody(h))u=h,h=h.parentNode;u===h.lastChild&&r.preventDefault();return}}}}),e.addListener("keyup",function(e,n){var r=n.keyCode||n.which,i,s=this;if(r==8){if(s.fireEvent("delkeyup"))return;i=s.selection.getRange();if(i.collapsed){var o,u=["h1","h2","h3","h4","h5","h6"];if(o=domUtils.findParentByTagName(i.startContainer,u,!0))if(domUtils.isEmptyBlock(o)){var a=o.previousSibling;if(a&&a.nodeName!="TABLE"){domUtils.remove(o),i.setStartAtLast(a).setCursor(!1,!0);return}var f=o.nextSibling;if(f&&f.nodeName!="TABLE"){domUtils.remove(o),i.setStartAtFirst(f).setCursor(!1,!0);return}}if(domUtils.isBody(i.startContainer)){var o=domUtils.createElement(s.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});i.insertNode(o).setStart(o,0).setCursor(!1,!0)}}if(!t&&(i.startContainer.nodeType==3||i.startContainer.nodeType==1&&domUtils.isEmptyBlock(i.startContainer)))if(browser.ie){var l=i.document.createElement("span");i.insertNode(l).setStartBefore(l).collapse(!0),i.select(),domUtils.remove(l)}else i.select()}})},UM.plugins.autosave=function(){function s(s){var o=null;if(new Date-t<n)return;if(!s.hasContents()){r&&i.removeItem(r);return}t=new Date,s._saveFlag=null,o=e.body.innerHTML;if(s.fireEvent("beforeautosave",{content:o})===!1)return;i.saveLocalData(r,o),s.fireEvent("afterautosave",{content:o})}var e=this,t=new Date,n=20,r=null;e.setOpt("saveInterval",500);var i=UM.LocalStorage=function(){function n(){var e=document.createElement("div");return e.style.display="none",e.addBehavior?(e.addBehavior("#default#userdata"),{getItem:function(n){var r=null;try{document.body.appendChild(e),e.load(t),r=e.getAttribute(n),document.body.removeChild(e)}catch(i){}return r},setItem:function(n,r){document.body.appendChild(e),e.setAttribute(n,r),e.save(t),document.body.removeChild(e)},removeItem:function(n){document.body.appendChild(e),e.removeAttribute(n),e.save(t),document.body.removeChild(e)}}):null}var e=window.localStorage||n()||null,t="localStorage";return{saveLocalData:function(t,n){return e&&n?(e.setItem(t,n),!0):!1},getLocalData:function(t){return e?e.getItem(t):null},removeItem:function(t){e&&e.removeItem(t)}}}();e.addListener("ready",function(){var t="-drafts-data",n=null;e.key?n=e.key+t:n=(e.container.parentNode.id||"ue-common")+t,r=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+n}),e.addListener("contentchange",function(){if(!r)return;e._saveFlag&&window.clearTimeout(e._saveFlag),e.options.saveInterval>0?e._saveFlag=window.setTimeout(function(){s(e)},e.options.saveInterval):s(e)}),e.commands.clearlocaldata={execCommand:function(e,t){r&&i.getLocalData(r)&&i.removeItem(r)},notNeedUndo:!0,ignoreContentChange:!0},e.commands.getlocaldata={execCommand:function(e,t){return r?i.getLocalData(r)||"":""},notNeedUndo:!0,ignoreContentChange:!0},e.commands.drafts={execCommand:function(t,n){r&&(e.body.innerHTML=i.getLocalData(r)||"<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>",e.focus(!0))},queryCommandState:function(){return r?i.getLocalData(r)===null?-1:0:-1},notNeedUndo:!0,ignoreContentChange:!0}},UM.plugins.autoupload=function(){function getPasteImage(e){return e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length==1&&/^image\//.test(e.clipboardData.items[0].type)?e.clipboardData.items:null}function getDropImage(e){return e.dataTransfer&&e.dataTransfer.files?e.dataTransfer.files:null}var me=this;me.setOpt("pasteImageEnabled",!0),me.setOpt("dropFileEnabled",!0);var sendAndInsertImage=function(file,editor){var fd=new FormData;fd.append(editor.options.imageFieldName||"upfile",file,file.name||"blob."+file.type.substr("image/".length)),fd.append("type","ajax");var xhr=new XMLHttpRequest;xhr.open("post",me.options.imageUrl,!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.addEventListener("load",function(e){try{var json=eval("("+e.target.response+")"),link=json.url,picLink=me.options.imagePath+link;editor.execCommand("insertimage",{src:picLink,_src:picLink})}catch(er){}}),xhr.send(fd)};me.addListener("ready",function(){if(window.FormData&&window.FileReader){var e=function(e){var t=!1,n;n=e.type=="paste"?getPasteImage(e.originalEvent):getDropImage(e.originalEvent);if(n){var r=n.length,i;while(r--)i=n[r],i.getAsFile&&(i=i.getAsFile()),i&&i.size>0&&/image\/\w+/i.test(i.type)&&(sendAndInsertImage(i,me),t=!0);if(t)return!1}};me.getOpt("pasteImageEnabled")&&me.$body.on("paste",e),me.getOpt("dropFileEnabled")&&me.$body.on("drop",e),me.$body.on("dragover",function(e){if(e.originalEvent.dataTransfer.types[0]=="Files")return!1})}})},UM.plugins.formula=function(){function t(){return e.$body.find("iframe.edui-formula-active")[0]||null}function n(){var e=t();e&&e.contentWindow.formula.blur()}var e=this;e.addInputRule(function(t){$.each(t.getNodesByTagName("span"),function(t,n){if(n.hasClass("mathquill-embedded-latex")){var r,i="";while(r=n.firstChild())i+=r.data,n.removeChild(r);n.tagName="iframe",n.setAttr({frameborder:"0",src:e.getOpt("UMEDITOR_HOME_URL")+"dialogs/formula/formula.html","data-latex":utils.unhtml(i)})}})}),e.addOutputRule(function(e){$.each(e.getNodesByTagName("iframe"),function(e,t){t.hasClass("mathquill-embedded-latex")&&(t.tagName="span",t.appendChild(UM.uNode.createText(t.getAttr("data-latex"))),t.setAttr({frameborder:"",src:"","data-latex":""}))})}),e.addListener("click",function(){n()}),e.addListener("afterexeccommand",function(e,t){t!="formula"&&n()}),e.commands.formula={execCommand:function(n,r){var i=t();i?i.contentWindow.formula.insertLatex(r):(e.execCommand("inserthtml",'<span class="mathquill-embedded-latex">'+r+"</span>"),browser.ie&&browser.ie9below&&setTimeout(function(){var t=e.selection.getRange(),n=t.startContainer;n.nodeType==1&&!n.childNodes[t.startOffset]&&(t.insertNode(e.document.createTextNode(" ")),t.setCursor())},100))},queryCommandState:function(e){return 0},queryCommandValue:function(e){var n=t();return n&&n.contentWindow.formula.getLatex()}}},function(e){function i(t,r,i){t.prototype=e.extend2(e.extend({},r),(UM.ui[i]||n).prototype,!0),t.prototype.supper=(UM.ui[i]||n).prototype;if(UM.ui[i]&&UM.ui[i].prototype.defaultOpt){var s=UM.ui[i].prototype.defaultOpt,o=t.prototype.defaultOpt;t.prototype.defaultOpt=e.extend({},s,o||{})}return t}function o(t,n){e[r+n]=t,e.fn[r+n]=function(n){var r,i=Array.prototype.slice.call(arguments,1);return this.each(function(s,o){var u=e(o),a=u.edui();a||(t(!n||!e.isPlainObject(n)?{}:n,u),u.edui(a));if(e.type(n)=="string")if(n=="this")r=a;else{r=a[n].apply(a,i);if(r!==a&&r!==undefined)return!1;r=null}}),r!==null?r:this}}e.parseTmpl=function(t,n){var r="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(e,t){return"',"+t.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(e,t){return"');"+t.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",i=new Function("obj",r);return n?i(n):i},e.extend2=function(t,n){var r=arguments,i=e.type(r[r.length-1])=="boolean"?r[r.length-1]:!1,s=e.type(r[r.length-1])=="boolean"?r.length-1:r.length;for(var o=1;o<s;o++){var u=r[o];for(var a in u)if(!i||!t.hasOwnProperty(a))t[a]=u[a]}return t},e.IE6=!!window.ActiveXObject&&parseFloat(navigator.userAgent.match(/msie (\d+)/i)[1])==6;var t=[],n=function(){},r="edui";n.prototype={on:function(t,n){return this.root().on(t,e.proxy(n,this)),this},off:function(t,n){return this.root().off(t,e.proxy(n,this)),this},trigger:function(e,t){return this.root().trigger(e,t)===!1?!1:this},root:function(e){return this._$el||(this._$el=e)},destroy:function(){},data:function(e,t){return t!==undefined?(this.root().data(r+e,t),this):this.root().data(r+e)},register:function(n,r,i){t.push({evtname:n,$els:e.isArray(r)?r:[r],handler:e.proxy(i,r)})}},e.fn.edui=function(e){return e?this.data("eduiwidget",e):this.data("eduiwidget")};var s=1;UM.ui={define:function(t,n,u){var a=UM.ui[t]=i(function(n,i){var o=function(){};e.extend(o.prototype,a.prototype,{guid:t+s++,widgetName:t});var u=new o;if(e.type(n)=="string")return u.init&&u.init({}),u.root().edui(u),u.root().find("a").click(function(e){e.preventDefault()}),u.root()[r+t].apply(u.root(),arguments);i&&u.root(i),u.init&&u.init(!n||e.isPlainObject(n)?e.extend2(n||{},u.defaultOpt||{},!0):n);try{u.root().find("a").click(function(e){e.preventDefault()})}catch(f){}return u.root().edui(u)},n,u);o(a,t)}},e(function(){e(document).on("click mouseup mousedown dblclick mouseover",function(n){e.each(t,function(t,r){r.evtname==n.type&&e.each(r.$els,function(t,i){i[0]!==n.target&&!e.contains(i[0],n.target)&&r.handler(n)})})})})}(jQuery),UM.ui.define("button",{tpl:'<<%if(!texttype){%>div class="edui-btn edui-btn-<%=icon%> <%if(name){%>edui-btn-name-<%=name%><%}%>" unselectable="on" onmousedown="return false" <%}else{%>a class="edui-text-btn"<%}%><% if(title) {%> data-original-title="<%=title%>" <%};%>> <% if(icon) {%><div unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><% }; %><%if(text) {%><span unselectable="on" onmousedown="return false" class="edui-button-label"><%=text%></span><%}%><%if(caret && text){%><span class="edui-button-spacing"></span><%}%><% if(caret) {%><span unselectable="on" onmousedown="return false" class="edui-caret"></span><% };%></<%if(!texttype){%>div<%}else{%>a<%}%>>',defaultOpt:{text:"",title:"",icon:"",width:"",caret:!1,texttype:!1,click:function(){}},init:function(e){var t=this;return t.root($($.parseTmpl(t.tpl,e))).click(function(n){t.wrapclick(e.click,n)}),t.root().hover(function(){t.root().hasClass("edui-disabled")||t.root().toggleClass("edui-hover")}),t},wrapclick:function(e,t){return this.disabled()||(this.root().trigger("wrapclick"),$.proxy(e,this,t)()),this},label:function(e){return e===undefined?this.root().find(".edui-button-label").text():(this.root().find(".edui-button-label").text(e),this)},disabled:function(e){return e===undefined?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",e),this.root().hasClass("edui-disabled")&&this.root().removeClass("edui-hover"),this)},active:function(e){return e===undefined?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",e),this)},mergeWith:function(e){var t=this;t.data("$mergeObj",e),e.edui().data("$mergeObj",t.root()),$.contains(document.body,e[0])||e.appendTo(t.root()),t.on("click",function(){t.wrapclick(function(){e.edui().show()})}).register("click",t.root(),function(t){e.hide()})}}),function(){UM.ui.define("toolbar",{tpl:'<div class="edui-toolbar"  ><div class="edui-btn-toolbar" unselectable="on" onmousedown="return false"  ></div></div>',init:function(){var e=this.root($(this.tpl));this.data("$btnToolbar",e.find(".edui-btn-toolbar"))},appendToBtnmenu:function(e){var t=this.data("$btnToolbar");e=$.isArray(e)?e:[e],$.each(e,function(e,n){t.append(n)})}})}(),UM.ui.define("menu",{show:function(e,t,n,r,i){n=n||"position";if(this.trigger("beforeshow")===!1)return;this.root().css($.extend({display:"block"},e?{top:e[n]().top+(t=="right"?0:e.outerHeight())-(r||0),left:e[n]().left+(t=="right"?e.outerWidth():0)-(i||0)}:{})),this.trigger("aftershow")},hide:function(e){var t;if(this.trigger("beforehide")===!1)return;(t=this.root().data("parentmenu"))&&(t.data("parentmenu")||e)&&t.edui().hide(),this.root().css("display","none"),this.trigger("afterhide")},attachTo:function(e){var t=this;e.data("$mergeObj")||(e.data("$mergeObj",t.root()),e.on("wrapclick",function(e){t.show()}),t.register("click",e,function(e){t.hide()}),t.data("$mergeObj",e))}}),UM.ui.define("dropmenu",{tmpl:'<ul class="edui-dropdown-menu" aria-labelledby="dropdownMenu" ><%for(var i=0,ci;ci=data[i++];){%><%if(ci.divider){%><li class="edui-divider"></li><%}else{%><li <%if(ci.active||ci.disabled){%>class="<%= ci.active|| \'\' %> <%=ci.disabled||\'\' %>" <%}%> data-value="<%= ci.value%>"><a href="#" tabindex="-1"><em class="edui-dropmenu-checkbox"><i class="edui-icon-ok"></i></em><%= ci.label%></a></li><%}%><%}%></ul>',defaultOpt:{data:[],click:function(){}},init:function(e){var t=this,n={click:1,mouseover:1,mouseout:1};this.root($($.parseTmpl(this.tmpl,e))).on("click",'li[class!="edui-disabled edui-divider edui-dropdown-submenu"]',function(n){$.proxy(e.click,t,n,$(this).data("value"),$(this))()}).find("li").each(function(r,i){var s=$(this);if(!s.hasClass("edui-disabled edui-divider edui-dropdown-submenu")){var o=e.data[r];$.each(n,function(e){o[e]&&s[e](function(n){$.proxy(o[e],i)(n,o,t.root)})})}})},disabled:function(e){$("li[class!=edui-divider]",this.root()).each(function(){var t=$(this);e===!0?t.addClass("edui-disabled"):$.isFunction(e)?t.toggleClass("edui-disabled",e(li)):t.removeClass("edui-disabled")})},val:function(e){var t;$('li[class!="edui-divider edui-disabled edui-dropdown-submenu"]',this.root()).each(function(){var n=$(this);if(e===undefined){if(n.find("em.edui-dropmenu-checked").length)return t=n.data("value"),!1}else n.find("em").toggleClass("edui-dropmenu-checked",n.data("value")==e)});if(e===undefined)return t},addSubmenu:function(e,t,n){n=n||0;var r=$("li[class!=edui-divider]",this.root()),i=$('<li class="edui-dropdown-submenu"><a tabindex="-1" href="#">'+e+"</a></li>").append(t);n>=0&&n<r.length?i.insertBefore(r[n]):n<0?i.insertBefore(r[0]):n>=r.length&&i.appendTo(r)}},"menu"),UM.ui.define("splitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{text:"",title:"",click:function(){}},init:function(e){var t=this;return t.root($($.parseTmpl(t.tpl,e))),t.root().find(".edui-btn:first").click(function(n){t.disabled()||$.proxy(e.click,t)()}),t.root().find(".edui-dropdown-toggle").click(function(){t.disabled()||t.trigger("arrowclick")}),t.root().hover(function(){t.root().hasClass("edui-disabled")||t.root().toggleClass("edui-hover")}),t},wrapclick:function(e,t){return this.disabled()||$.proxy(e,this,t)(),this},disabled:function(e){return e===undefined?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",e).find(".edui-btn").toggleClass("edui-disabled",e),this)},active:function(e){return e===undefined?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",e).find(".edui-btn:first").toggleClass("edui-active",e),this)},mergeWith:function(e){var t=this;t.data("$mergeObj",e),e.edui().data("$mergeObj",t.root()),$.contains(document.body,e[0])||e.appendTo(t.root()),t.root().delegate(".edui-dropdown-toggle","click",function(){t.wrapclick(function(){e.edui().show()})}),t.register("click",t.root().find(".edui-dropdown-toggle"),function(t){e.hide()})}}),UM.ui.define("colorsplitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><div class="edui-splitbutton-color-label" <%if (color) {%>style="background: <%=color%>"<%}%>></div><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{color:""},init:function(e){var t=this;t.supper.init.call(t,e)},colorLabel:function(){return this.root().find(".edui-splitbutton-color-label")}},"splitbutton"),UM.ui.define("popup",{tpl:'<div class="edui-dropdown-menu edui-popup"<%if(!<%=stopprop%>){%>onmousedown="return false"<%}%>><div class="edui-popup-body" unselectable="on" onmousedown="return false"><%=subtpl%></div><div class="edui-popup-caret"></div></div>',defaultOpt:{stopprop:!1,subtpl:"",width:"",height:""},init:function(e){return this.root($($.parseTmpl(this.tpl,e))),this},mergeTpl:function(e){return $.parseTmpl(this.tpl,{subtpl:e})},show:function(e,t){t||(t={});var n=t.fnname||"position";if(this.trigger("beforeshow")===!1)return;this.root().css($.extend({display:"block"},e?{top:e[n]().top+(t.dir=="right"?0:e.outerHeight())-(t.offsetTop||0),left:e[n]().left+(t.dir=="right"?e.outerWidth():0)-(t.offsetLeft||0),position:"absolute"}:{})),this.root().find(".edui-popup-caret").css({top:t.caretTop||0,left:t.caretLeft||0,position:"absolute"}).addClass(t.caretDir||"up"),this.trigger("aftershow")},hide:function(){this.root().css("display","none"),this.trigger("afterhide")},attachTo:function(e,t){var n=this;e.data("$mergeObj")||(e.data("$mergeObj",n.root()),e.on("wrapclick",function(r){n.show(e,t)}),n.register("click",e,function(e){n.hide()}),n.data("$mergeObj",e))},getBodyContainer:function(){return this.root().find(".edui-popup-body")}}),UM.ui.define("scale",{tpl:'<div class="edui-scale" unselectable="on"><span class="edui-scale-hand0"></span><span class="edui-scale-hand1"></span><span class="edui-scale-hand2"></span><span class="edui-scale-hand3"></span><span class="edui-scale-hand4"></span><span class="edui-scale-hand5"></span><span class="edui-scale-hand6"></span><span class="edui-scale-hand7"></span></div>',defaultOpt:{$doc:$(document),$wrap:$(document)},init:function(e){return e.$doc&&(this.defaultOpt.$doc=e.$doc),e.$wrap&&(this.defaultOpt.$wrap=e.$wrap),this.root($($.parseTmpl(this.tpl,e))),this.initStyle(),this.startPos=this.prePos={x:0,y:0},this.dragId=-1,this},initStyle:function(){utils.cssRule("edui-style-scale",".edui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}.edui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-scale .edui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},_eventHandler:function(e){var t=this,n=t.defaultOpt.$doc;switch(e.type){case"mousedown":var r=e.target||e.srcElement,r;r.className.indexOf("edui-scale-hand")!=-1&&(t.dragId=r.className.slice(-1),t.startPos.x=t.prePos.x=e.clientX,t.startPos.y=t.prePos.y=e.clientY,n.bind("mousemove",$.proxy(t._eventHandler,t)));break;case"mousemove":t.dragId!=-1&&(t.updateContainerStyle(t.dragId,{x:e.clientX-t.prePos.x,y:e.clientY-t.prePos.y}),t.prePos.x=e.clientX,t.prePos.y=e.clientY,t.updateTargetElement());break;case"mouseup":if(t.dragId!=-1){t.dragId=-1,t.updateTargetElement();var i=t.data("$scaleTarget");i.parent()&&t.attachTo(t.data("$scaleTarget"))}n.unbind("mousemove",$.proxy(t._eventHandler,t));break;default:}},updateTargetElement:function(){var e=this,t=e.root(),n=e.data("$scaleTarget");n.css({width:t.width(),height:t.height()}),e.attachTo(n)},updateContainerStyle:function(e,t){var n=this,r=n.root(),i,s=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];s[e][0]!=0&&(i=parseInt(r.offset().left)+t.x,r.css("left",n._validScaledProp("left",i))),s[e][1]!=0&&(i=parseInt(r.offset().top)+t.y,r.css("top",n._validScaledProp("top",i))),s[e][2]!=0&&(i=r.width()+s[e][2]*t.x,r.css("width",n._validScaledProp("width",i))),s[e][3]!=0&&(i=r.height()+s[e][3]*t.y,r.css("height",n._validScaledProp("height",i)))},_validScaledProp:function(e,t){var n=this.root(),r=this.defaultOpt.$doc,i=function(e,n,r){return e+n>r?r-n:t};t=isNaN(t)?0:t;switch(e){case"left":return t<0?0:i(t,n.width(),r.width());case"top":return t<0?0:i(t,n.height(),r.height());case"width":return t<=0?1:i(t,n.offset().left,r.width());case"height":return t<=0?1:i(t,n.offset().top,r.height())}},show:function(e){var t=this;e&&t.attachTo(e),t.root().bind("mousedown",$.proxy(t._eventHandler,t)),t.defaultOpt.$doc.bind("mouseup",$.proxy(t._eventHandler,t)),t.root().show(),t.trigger("aftershow")},hide:function(){var e=this;e.root().unbind("mousedown",$.proxy(e._eventHandler,e)),e.defaultOpt.$doc.unbind("mouseup",$.proxy(e._eventHandler,e)),e.root().hide(),e.trigger("afterhide")},attachTo:function(e){var t=this,n=e.offset(),r=t.root(),i=t.defaultOpt.$wrap,s=i.offset();t.data("$scaleTarget",e),t.root().css({position:"absolute",width:e.width(),height:e.height(),left:n.left-s.left-parseInt(i.css("border-left-width"))-parseInt(r.css("border-left-width")),top:n.top-s.top-parseInt(i.css("border-top-width"))-parseInt(r.css("border-top-width"))})},getScaleTarget:function(){return this.data("$scaleTarget")[0]}}),UM.ui.define("colorpicker",{tpl:function(e){var t="ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,".split(","),n='<div unselectable="on" onmousedown="return false" class="edui-colorpicker<%if (name){%> edui-colorpicker-<%=name%><%}%>" ><table unselectable="on" onmousedown="return false"><tr><td colspan="10">'+e.lang_themeColor+"</td> </tr>"+'<tr class="edui-colorpicker-firstrow" >';for(var r=0;r<t.length;r++)r&&r%10===0&&(n+="</tr>"+(r==60?'<tr><td colspan="10">'+e.lang_standardColor+"</td></tr>":"")+"<tr"+(r==60?' class="edui-colorpicker-firstrow"':"")+">"),n+=r<70?'<td><a unselectable="on" onmousedown="return false" title="'+t[r]+'" class="edui-colorpicker-colorcell"'+' data-color="#'+t[r]+'"'+' style="background-color:#'+t[r]+";border:solid #ccc;"+(r<10||r>=60?"border-width:1px;":r>=10&&r<20?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"'+"></a></td>":"";return n+="</tr></table></div>",n},init:function(e){var t=this;t.root($($.parseTmpl(t.supper.mergeTpl(t.tpl(e)),e))),t.root().on("click",function(e){t.trigger("pickcolor",$(e.target).data("color"))})}},"popup"),function(){var e="combobox",t="edui-combobox-item",n="edui-combobox-item-hover",r="edui-combobox-checked-icon",i="edui-combobox-item-label";UM.ui.define(e,function(){return{tpl:'<ul class="dropdown-menu edui-combobox-menu<%if (comboboxName!==\'\') {%> edui-combobox-<%=comboboxName%><%}%>" unselectable="on" onmousedown="return false" role="menu" aria-labelledby="dropdownMenu"><%if(autoRecord) {%><%for( var i=0, len = recordStack.length; i<len; i++ ) {%><%var index = recordStack[i];%><li class="<%=itemClassName%><%if( selected == index ) {%> edui-combobox-checked<%}%>" data-item-index="<%=index%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ index ]%>" unselectable="on" onmousedown="return false"><%=items[index]%></label></li><%}%><%if( i ) {%><li class="edui-combobox-item-separator"></li><%}%><%}%><%for( var i=0, label; label = items[i]; i++ ) {%><li class="<%=itemClassName%><%if( selected == i ) {%> edui-combobox-checked<%}%> edui-combobox-item-<%=i%>" data-item-index="<%=i%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ i ]%>" unselectable="on" onmousedown="return false"><%=label%></label></li><%}%></ul>',defaultOpt:{recordStack:[],items:[],value:[],comboboxName:"",selected:"",autoRecord:!0,recordCount:5},init:function(e){var n=this;$.extend(n._optionAdaptation(e),n._createItemMapping(e.recordStack,e.items),{itemClassName:t,iconClass:r,labelClassName:i}),this._transStack(e),n.root($($.parseTmpl(n.tpl,e))),this.data("options",e).initEvent()},initEvent:function(){var e=this;e.initSelectItem(),this.initItemActive()},initSelectItem:function(){var e=this,n="."+i;e.root().delegate("."+t,"click",function(){var t=$(this),r=t.attr("data-item-index");return e.trigger("comboboxselect",{index:r,label:t.find(n).text(),value:e.data("options").value[r]}).select(r),e.hide(),!1})},initItemActive:function(){var e={mouseenter:"addClass",mouseleave:"removeClass"};$.IE6&&this.root().delegate("."+t,"mouseenter mouseleave",function(t){$(this)[e[t.type]](n)}).one("afterhide",function(){})},select:function(e){var t=this.data("options").itemCount,n=this.data("options").autowidthitem;return n&&!n.length&&(n=this.data("options").items),t==0?null:(e<0?e=t+e%t:e>=t&&(e=t-1),this.trigger("changebefore",n[e]),this._update(e),this.trigger("changeafter",n[e]),null)},selectItemByLabel:function(e){var t=this.data("options").itemMapping,n=this,r=null;!$.isArray(e)&&(e=[e]),$.each(e,function(e,i){r=t[i];if(r!==undefined)return n.select(r),!1})},_transStack:function(e){var t=[],n=-1,r=-1;$.each(e.recordStack,function(i,s){n=e.itemMapping[s],$.isNumeric(n)&&(t.push(n),s==e.selected&&(r=n))}),e.recordStack=t,e.selected=r,t=null},_optionAdaptation:function(e){if(!("itemStyles"in e)){e.itemStyles=[];for(var t=0,n=e.items.length;t<n;t++)e.itemStyles.push("")}return e.autowidthitem=e.autowidthitem||e.items,e.itemCount=e.items.length,e},_createItemMapping:function(e,t){var n={},r={recordStack:[],mapping:{}};return $.each(t,function(e,t){n[t]=e}),r.itemMapping=n,$.each(e,function(e,t){n[t]!==undefined&&(r.recordStack.push(n[t]),r.mapping[t]=n[t])}),r},_update:function(e){var t=this.data("options"),n=[],r=null;$.each(t.recordStack,function(t,r){r!=e&&n.push(r)}),n.unshift(e),n.length>t.recordCount&&(n.length=t.recordCount),t.recordStack=n,t.selected=e,r=$($.parseTmpl(this.tpl,t)),this.root().html(r.html()),r=null,n=null}}}(),"menu")}(),function(){var e="buttoncombobox";UM.ui.define(e,function(){return{defaultOpt:{label:"",title:""},init:function(e){var t=this,n=$.eduibutton({caret:!0,name:e.comboboxName,title:e.title,text:e.label,click:function(){t.show(this.root())}});t.supper.init.call(t,e),t.on("changebefore",function(e,t){n.eduibutton("label",t)}),t.data("button",n),t.attachTo(n)},button:function(){return this.data("button")}}}(),"combobox")}(),UM.ui.define("modal",{tpl:'<div class="edui-modal" tabindex="-1" ><div class="edui-modal-header"><div class="edui-close" data-hide="modal"></div><h3 class="edui-title"><%=title%></h3></div><div class="edui-modal-body"  style="<%if(width){%>width:<%=width%>px;<%}%><%if(height){%>height:<%=height%>px;<%}%>"> </div><% if(cancellabel || oklabel) {%><div class="edui-modal-footer"><div class="edui-modal-tip"></div><%if(oklabel){%><div class="edui-btn edui-btn-primary" data-ok="modal"><%=oklabel%></div><%}%><%if(cancellabel){%><div class="edui-btn" data-hide="modal"><%=cancellabel%></div><%}%></div><%}%></div>',defaultOpt:{title:"",cancellabel:"",oklabel:"",width:"",height:"",backdrop:!0,keyboard:!0},init:function(e){var t=this;t.root($($.parseTmpl(t.tpl,e||{}))),t.data("options",e),e.okFn&&t.on("ok",$.proxy(e.okFn,t)),e.cancelFn&&t.on("beforehide",$.proxy(e.cancelFn,t)),t.root().delegate('[data-hide="modal"]',"click",$.proxy(t.hide,t)).delegate('[data-ok="modal"]',"click",$.proxy(t.ok,t)),$('[data-hide="modal"],[data-ok="modal"]',t.root()).hover(function(){$(this).toggleClass("edui-hover")})},toggle:function(){var e=this;return e[e.data("isShown")?"hide":"show"]()},show:function(){var e=this;e.trigger("beforeshow");if(e.data("isShown"))return;e.data("isShown",!0),e.escape(),e.backdrop(function(){e.autoCenter(),e.root().show().focus().trigger("aftershow")})},showTip:function(e){$(".edui-modal-tip",this.root()).html(e).fadeIn()},hideTip:function(e){$(".edui-modal-tip",this.root()).fadeOut(function(){$(this).html("")})},autoCenter:function(){!$.IE6&&this.root().css("margin-left",-(this.root().width()/2))},hide:function(){var e=this;e.trigger("beforehide");if(!e.data("isShown"))return;e.data("isShown",!1),e.escape(),e.hideModal()},escape:function(){var e=this;e.data("isShown")&&e.data("options").keyboard?e.root().on("keyup",function(t){t.which==27&&e.hide()}):e.data("isShown")||e.root().off("keyup")},hideModal:function(){var e=this;e.root().hide(),e.backdrop(function(){e.removeBackdrop(),e.trigger("afterhide")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(e){var t=this;t.data("isShown")&&t.data("options").backdrop&&(t.$backdrop=$('<div class="edui-modal-backdrop" />').click(t.data("options").backdrop=="static"?$.proxy(t.root()[0].focus,t.root()[0]):$.proxy(t.hide,t))),t.trigger("afterbackdrop"),e&&e()},attachTo:function(e){var t=this;e.data("$mergeObj")||(e.data("$mergeObj",t.root()),e.on("click",function(){t.toggle(e)}),t.data("$mergeObj",e))},ok:function(){var e=this;e.trigger("beforeok");if(e.trigger("ok",e)===!1)return;e.hide()},getBodyContainer:function(){return this.root().find(".edui-modal-body")}}),UM.ui.define("tooltip",{tpl:'<div class="edui-tooltip" unselectable="on" onmousedown="return false"><div class="edui-tooltip-arrow" unselectable="on" onmousedown="return false"></div><div class="edui-tooltip-inner" unselectable="on" onmousedown="return false"></div></div>',init:function(e){var t=this;t.root($($.parseTmpl(t.tpl,e||{})))},content:function(e){var t=this,n=$(e.currentTarget).attr("data-original-title");t.root().find(".edui-tooltip-inner").text(n)},position:function(e){var t=this,n=$(e.currentTarget);t.root().css($.extend({display:"block"},n?{top:n.outerHeight(),left:(n.outerWidth()-t.root().outerWidth())/2}:{}))},show:function(e){if($(e.currentTarget).hasClass("edui-disabled"))return;var t=this;t.content(e),t.root().appendTo($(e.currentTarget)),t.position(e),t.root().css("display","block")},hide:function(){var e=this;e.root().css("display","none")},attachTo:function(e){function n(e){var t=this;$.contains(document.body,t.root()[0])||t.root().appendTo(e),t.data("tooltip",t.root()),e.each(function(){$(this).attr("data-original-title")&&$(this).on("mouseenter",$.proxy(t.show,t)).on("mouseleave click",$.proxy(t.hide,t))})}var t=this;$.type(e)==="undefined"?$("[data-original-title]").each(function(e,r){n.call(t,$(r))}):e.data("tooltip")||n.call(t,e)}}),UM.ui.define("tab",{init:function(e){var t=this,n=e.selector;$.type(n)&&(t.root($(n,e.context)),t.data("context",e.context),$(n,t.data("context")).on("click",function(e){t.show(e)}))},show:function(e){var t=this,n=$(e.target),r=n.closest("ul"),i,s,o,e;i=n.attr("data-context"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"");var u=n.parent("li");if(!u.length||u.hasClass("edui-active"))return;s=r.find(".edui-active:last a")[0],e=$.Event("beforeshow",{target:n[0],relatedTarget:s}),t.trigger(e);if(e.isDefaultPrevented())return;o=$(i,t.data("context")),t.activate(n.parent("li"),r),t.activate(o,o.parent(),function(){t.trigger({type:"aftershow",relatedTarget:s})})},activate:function(e,t,n){if(e===undefined)return $(".edui-tab-item.edui-active",this.root()).index();var r=t.find("> .edui-active");r.removeClass("edui-active"),e.addClass("edui-active"),n&&n()}}),UM.ui.define("separator",{tpl:'<div class="edui-separator" unselectable="on" onmousedown="return false" ></div>',init:function(e){var t=this;return t.root($($.parseTmpl(t.tpl,e))),t}}),function(){var e={},t={},n=[],r=null,i={},s={},o={},u=null;utils.extend(UM,{defaultWidth:500,defaultHeight:500,registerUI:function(t,n){utils.each(t.split(/\s+/),function(t){e[t]=n})},setEditor:function(e){!t[e.id]&&(t[e.id]=e)},registerWidget:function(e,t,n){i[e]=$.extend2(t,{$root:"",_preventDefault:!1,root:function(e){return this.$root||(this.$root=e)},preventDefault:function(){this._preventDefault=!0},clear:!1}),n&&(s[e]=n)},getWidgetData:function(e){return i[e]},setWidgetBody:function(e,t,n){n._widgetData||utils.extend(n,{_widgetData:{},getWidgetData:function(e){return this._widgetData[e]},getWidgetCallback:function(e){var n=this;return function(){return s[e].apply(n,[n,t].concat(Array.prototype.slice.call(arguments,0)))}}});var r=i[e];if(!r)return null;r=n._widgetData[e],r||(r=i[e],r=n._widgetData[e]=$.type(r)=="function"?r:utils.clone(r)),r.root(t.edui().getBodyContainer()),r.initContent(n,t),r._preventDefault||r.initEvent(n,t),r.width&&t.width(r.width)},setActiveWidget:function(e){r=e},getEditor:function(e,n){var r=t[e]||(t[e]=this.createEditor(e,n));return u=u?Math.max(r.getOpt("zIndex"),u):r.getOpt("zIndex"),r},setTopEditor:function(e){$.each(t,function(t,n){e==n?e.$container&&e.$container.css("zIndex",u+1):n.$container&&n.$container.css("zIndex",n.getOpt("zIndex"))})},clearCache:function(e){t[e]&&delete t[e]},delEditor:function(e){var n;(n=t[e])&&n.destroy()},ready:function(e){n.push(e)},createEditor:function(e,t){function s(){var t=this.createUI("#"+e,r);r.key=e,r.ready(function(){$.each(n,function(e,t){$.proxy(t,r)()})});var i=r.options;i.initialFrameWidth?i.minFrameWidth=i.initialFrameWidth:i.minFrameWidth=i.initialFrameWidth=r.$body.width()||UM.defaultWidth,t.css({width:i.initialFrameWidth,zIndex:r.getOpt("zIndex")}),UM.browser.ie&&UM.browser.version===6&&document.execCommand("BackgroundImageCache",!1,!0),r.render(e),$.eduitooltip&&$.eduitooltip("attachTo",$("[data-original-title]",t)).css("z-index",r.getOpt("zIndex")+1),t.find("a").click(function(e){e.preventDefault()}),r.fireEvent("afteruiready")}var r=new UM.Editor(t),i=this;return r.langIsReady?$.proxy(s,i)():r.addListener("langReady",$.proxy(s,i)),r},createUI:function(t,n){var r=$(t),i=$('<div class="edui-container"><div class="edui-editor-body"></div></div>').insertBefore(r);n.$container=i,n.container=i[0],n.$body=r;if(browser.ie&&browser.ie9above){var s=$('<span style="padding:0;margin:0;height:0;width:0"></span>');s.insertAfter(i)}return $.each(e,function(e,t){var r=t.call(n,e);r&&(o[e]=r)}),i.find(".edui-editor-body").append(r).before(this.createToolbar(n.options,n)),i.find(".edui-toolbar").append($('<div class="edui-dialog-container"></div>')),i},createToolbar:function(e,t){var n=$.eduitoolbar(),r=n.edui();if(e.toolbar&&e.toolbar.length){var i=[];$.each(e.toolbar,function(e,t){$.each(t.split(/\s+/),function(e,t){if(t=="|")$.eduiseparator&&i.push($.eduiseparator());else{var n=o[t];t=="fullscreen"?n&&i.unshift(n):n&&i.push(n)}}),i.length&&r.appendToBtnmenu(i)})}else n.find(".edui-btn-toolbar").remove();return n}})}(),UM.registerUI("bold italic redo undo underline strikethrough superscript subscript insertorderedlist insertunorderedlist cleardoc selectall link unlink print preview justifyleft justifycenter justifyright justifyfull removeformat horizontal drafts",function(e){var t=this,n=$.eduibutton({icon:e,click:function(){t.execCommand(e)},title:this.getLang("labelMap")[e]||""});return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(t==-1).active(t==1)}),n}),function(){function o(e){var t=this;if(!e)throw new Error("invalid params, notfound editor");t.editor=e,s[e.uid]=this,e.addListener("destroy",function(){delete s[e.uid],t.editor=null})}var e={},t=["width","height","position","top","left","margin","padding","overflowX","overflowY"],n={},r={},i={},s={};UM.registerUI("fullscreen",function(e){var t=this,n=$.eduibutton({icon:"fullscreen",title:t.options.labelMap&&t.options.labelMap[e]||t.getLang("labelMap."+e),click:function(){t.execCommand(e),UM.setTopEditor(t)}});return t.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(t==-1).active(t==1)}),t.addListener("ready",function(){t.options.fullscreen&&o.getInstance(t).toggle()}),n}),UM.commands.fullscreen={execCommand:function(e){o.getInstance(this).toggle()},queryCommandState:function(e){return this._edui_fullscreen_status},notNeedUndo:1},o.prototype={toggle:function(){var e=this.editor,t=this.isFullState();e.fireEvent("beforefullscreenchange",!t),this.update(!t),t?this.revert():this.enlarge(),e.fireEvent("afterfullscreenchange",!t),e.body.contentEditable==="true"&&e.fireEvent("fullscreenchanged",!t),e.fireEvent("selectionchange")},enlarge:function(){this.saveSataus(),this.setDocumentStatus(),this.resize()},revert:function(){var e=this.editor.options,t=/%$/.test(e.initialFrameHeight)?"100%":e.initialFrameHeight-this.getStyleValue("padding-top")-this.getStyleValue("padding-bottom")-this.getStyleValue("border-width");$.IE6&&this.getEditorHolder().style.setExpression("height","this.scrollHeight <= "+t+' ? "'+t+'px" : "auto"'),this.revertContainerStatus(),this.revertContentAreaStatus(),this.revertDocumentStatus()},update:function(e){this.editor._edui_fullscreen_status=e},resize:function(){var e=null,t=0,n=0,r=0,i=0,s=this.editor,o=this,u=null,a=null;if(!this.isFullState())return;e=$(window),n=e.width(),t=e.height(),a=this.getEditorHolder(),r=parseInt(domUtils.getComputedStyle(a,"border-width"),10)||0,r+=parseInt(domUtils.getComputedStyle(s.container,"border-width"),10)||0,i+=parseInt(domUtils.getComputedStyle(a,"padding-left"),10)+parseInt(domUtils.getComputedStyle(a,"padding-right"),10)||0,$.IE6&&a.style.setExpression("height",null),u=this.getBound(),$(s.container).css({width:n+"px",height:t+"px",position:$.IE6?"absolute":"fixed",top:u.top,left:u.left,margin:0,padding:0,overflowX:"hidden",overflowY:"hidden"}),$(a).css({width:n-2*r-i+"px",height:t-2*r-(s.options.withoutToolbar?0:$(".edui-toolbar",s.container).outerHeight())-$(".edui-bottombar",s.container).outerHeight()+"px",overflowX:"hidden",overflowY:"auto"})},saveSataus:function(){var n=this.editor.container.style,r=null,i={};for(var s=0,o=t.length;s<o;s++)r=t[s],i[r]=n[r];e[this.editor.uid]=i,this.saveContentAreaStatus(),this.saveDocumentStatus()},saveContentAreaStatus:function(){var e=$(this.getEditorHolder());n[this.editor.uid]={width:e.css("width"),overflowX:e.css("overflowX"),overflowY:e.css("overflowY"),height:e.css("height")}},saveDocumentStatus:function(){var e=$(this.getEditorDocumentBody());r[this.editor.uid]={overflowX:e.css("overflowX"),overflowY:e.css("overflowY")},i[this.editor.uid]={overflowX:$(this.getEditorDocumentElement()).css("overflowX"),overflowY:$(this.getEditorDocumentElement()).css("overflowY")}},revertContainerStatus:function(){$(this.editor.container).css(this.getEditorStatus())},revertContentAreaStatus:function(){var e=this.getEditorHolder(),t=this.getContentAreaStatus();this.supportMin()&&(delete t.height,e.style.height=null),$(e).css(t)},revertDocumentStatus:function(){var e=this.getDocumentStatus();$(this.getEditorDocumentBody()).css("overflowX",e.body.overflowX),$(this.getEditorDocumentElement()).css("overflowY",e.html.overflowY)},setDocumentStatus:function(){$(this.getEditorDocumentBody()).css({overflowX:"hidden",overflowY:"hidden"}),$(this.getEditorDocumentElement()).css({overflowX:"hidden",overflowY:"hidden"})},isFullState:function(){return!!this.editor._edui_fullscreen_status},getEditorStatus:function(){return e[this.editor.uid]},getContentAreaStatus:function(){return n[this.editor.uid]},getEditorDocumentElement:function(){return this.editor.container.ownerDocument.documentElement},getEditorDocumentBody:function(){return this.editor.container.ownerDocument.body},getEditorHolder:function(){return this.editor.body},getDocumentStatus:function(){return{body:r[this.editor.uid],html:i[this.editor.uid]}},supportMin:function(){var e=null;return this._support||(e=document.createElement("div"),this._support="minWidth"in e.style,e=null),this._support},getBound:function(){var e={html:!0,body:!0},t={top:0,left:0},n=null;return $.IE6?(n=this.editor.container.offsetParent,n&&!e[n.nodeName.toLowerCase()]&&(e=n.getBoundingClientRect(),t.top=-e.top,t.left=-e.left),t):t},getStyleValue:function(e){return parseInt(domUtils.getComputedStyle(this.getEditorHolder(),e))}},$.extend(o,{listen:function(){var e=null;if(o._hasFullscreenListener)return;o._hasFullscreenListener=!0,$(window).on("resize",function(){e!==null&&(window.clearTimeout(e),e=null),e=window.setTimeout(function(){for(var t in s)s[t].resize();e=null},50)})},getInstance:function(e){return s[e.uid]||new o(e),s[e.uid]}}),o.listen()}(),UM.registerUI("link image video map formula",function(e){var t=this,n,r,i={title:t.options.labelMap&&t.options.labelMap[e]||t.getLang("labelMap."+e),url:t.options.UMEDITOR_HOME_URL+"dialogs/"+e+"/"+e+".js"},s=$.eduibutton({icon:e,title:this.getLang("labelMap")[e]||""});return utils.loadFile(document,{src:i.url,tag:"script",type:"text/javascript",defer:"defer"},function(){var o=UM.getWidgetData(e);if(!o)return;if(o.buttons){var u=o.buttons.ok;u&&(i.oklabel=u.label||t.getLang("ok"),u.exec&&(i.okFn=function(){return $.proxy(u.exec,null,t,r)()}));var a=o.buttons.cancel;a&&(i.cancellabel=a.label||t.getLang("cancel"),a.exec&&(i.cancelFn=function(){return $.proxy(a.exec,null,t,r)()}))}o.width&&(i.width=o.width),o.height&&(i.height=o.height),r=$.eduimodal(i),r.attr("id","edui-dialog-"+e).addClass("edui-dialog-"+e).find(".edui-modal-body").addClass("edui-dialog-"+e+"-body"),r.edui().on("beforehide",function(){var e=t.selection.getRange();e.equals(n)&&e.select()}).on("beforeshow",function(){var i=this.root(),s=null,o=null;n=t.selection.getRange(),i.parent()[0]||t.$container.find(".edui-dialog-container").append(i),$.IE6&&(s={width:$(window).width(),height:$(window).height()},o=i.parents(".edui-toolbar")[0].getBoundingClientRect(),i.css({position:"absolute",margin:0,left:(s.width-i.width())/2-o.left,top:100-o.top})),UM.setWidgetBody(e,r,t),UM.setTopEditor(t)}).on("afterbackdrop",function(){this.$backdrop.css("zIndex",t.getOpt("zIndex")+1).appendTo(t.$container.find(".edui-dialog-container")),r.css("zIndex",t.getOpt("zIndex")+2)}).on("beforeok",function(){try{n.select()}catch(e){}}).attachTo(s)}),t.addListener("selectionchange",function(){var t=this.queryCommandState(e);s.edui().disabled(t==-1).active(t==1)}),s}),UM.registerUI("emotion formula",function(e){var t=this,n=t.options.UMEDITOR_HOME_URL+"dialogs/"+e+"/"+e+".js",r=$.eduibutton({icon:e,title:this.getLang("labelMap")[e]||""});return utils.loadFile(document,{src:n,tag:"script",type:"text/javascript",defer:"defer"},function(){var i={url:n},s=UM.getWidgetData(e);s.width&&(i.width=s.width),s.height&&(i.height=s.height),$.eduipopup(i).css("zIndex",t.options.zIndex+1).addClass("edui-popup-"+e).edui().on("beforeshow",function(){var n=this.root();n.parent().length||t.$container.find(".edui-dialog-container").append(n),UM.setWidgetBody(e,n,t),UM.setTopEditor(t)}).attachTo(r,{offsetTop:-5,offsetLeft:10,caretLeft:11,caretTop:-8}),t.addListener("selectionchange",function(){var t=this.queryCommandState(e);r.edui().disabled(t==-1).active(t==1)})}),r}),UM.registerUI("imagescale",function(){var e=this,t;e.setOpt("imageScaleEnabled",!0),browser.webkit&&e.getOpt("imageScaleEnabled")&&(e.addListener("click",function(n,r){var i=e.selection.getRange(),s=i.getClosedNode(),o=r.target;if(s&&s.tagName=="IMG"&&o==s){if(!t){t=$.eduiscale({$wrap:e.$container}).css("zIndex",e.options.zIndex),e.$container.append(t);var u=function(){t.edui().hide()},a=function(e){var t=e.target||e.srcElement;t&&t.className.indexOf("edui-scale")==-1&&u(e)},f;t.edui().on("aftershow",function(){$(document).bind("keydown",u),$(document).bind("mousedown",a),e.selection.getNative().removeAllRanges()}).on("afterhide",function(){$(document).unbind("keydown",u),$(document).unbind("mousedown",a);var n=t.edui().getScaleTarget();n.parentNode&&e.selection.getRange().selectNode(n).select()}).on("mousedown",function(n){e.selection.getNative().removeAllRanges();var r=n.target||n.srcElement;r&&r.className.indexOf("edui-scale-hand")==-1&&(f=setTimeout(function(){t.edui().hide()},200))}).on("mouseup",function(e){var t=e.target||e.srcElement;t&&t.className.indexOf("edui-scale-hand")==-1&&clearTimeout(f)})}t.edui().show($(s))}else t&&t.css("display")!="none"&&t.edui().hide()}),e.addListener("click",function(t,n){if(n.target.tagName=="IMG"){var r=new dom.Range(e.document,e.body);r.selectNode(n.target).select()}}))}),UM.registerUI("autofloat",function(){var e=this,t=e.getLang();e.setOpt({autoFloatEnabled:!0,topOffset:0});var n=e.options.autoFloatEnabled!==!1,r=e.options.topOffset;if(!n)return;e.ready(function(){function s(){return UM.ui?1:(alert(t.autofloatMsg),0)}function o(){var e=document.body.style;e.backgroundImage='url("about:blank")',e.backgroundAttachment="fixed"}function p(){if(h)return;var t=domUtils.getXY(f),s=domUtils.getComputedStyle(f,"position"),o=domUtils.getComputedStyle(f,"left");f.style.width=f.offsetWidth+"px",f.style.zIndex=e.options.zIndex*1+1,f.parentNode.insertBefore(a,f),n||i&&browser.ie?(f.style.position!="absolute"&&(f.style.position="absolute"),f.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-l+r+"px"):f.style.position!="fixed"&&(f.style.position="fixed",f.style.top=r+"px",(s=="absolute"||s=="relative")&&parseFloat(o)&&(f.style.left=t.x+"px"))}function d(){a.parentNode&&a.parentNode.removeChild(a),f.style.cssText=u}function v(){var t=c(e.container),n=e.options.toolbarTopOffset||0;t.top<0&&t.bottom-f.offsetHeight>n?p():d()}var n=browser.ie&&browser.version<=6,i=browser.quirks,u,a=document.createElement("div"),f,l,c=function(e){var t;try{t=e.getBoundingClientRect()}catch(n){t={left:0,top:0,height:0,width:0}}var r={left:Math.round(t.left),top:Math.round(t.top),height:Math.round(t.bottom-t.top),width:Math.round(t.right-t.left)},i;while((i=e.ownerDocument)!==document&&(e=domUtils.getWindow(i).frameElement))t=e.getBoundingClientRect(),r.left+=t.left,r.top+=t.top;return r.bottom=r.top+r.height,r.right=r.left+r.width,r},h=!1,m=utils.defer(function(){v()},browser.ie?200:100,!0);e.addListener("destroy",function(){$(window).off("scroll resize",v),e.removeListener("keydown",m)}),s(e)&&(f=$(".edui-toolbar",e.container)[0],e.addListener("afteruiready",function(){setTimeout(function(){l=$(f).offset().top},100)}),u=f.style.cssText,a.style.height=f.offsetHeight+"px",n&&o(),$(window).on("scroll resize",v),e.addListener("keydown",m),e.addListener("resize",function(){d(),a.style.height=f.offsetHeight+"px",v()}),e.addListener("beforefullscreenchange",function(e,t){t&&(d(),h=t)}),e.addListener("fullscreenchanged",function(e,t){t||v(),h=t}),e.addListener("sourcemodechanged",function(e,t){setTimeout(function(){v()},0)}),e.addListener("clearDoc",function(){setTimeout(function(){v()},0)}))})}),UM.registerUI("source",function(e){var t=this;t.addListener("fullscreenchanged",function(){t.$container.find("textarea").width(t.$body.width()-10).height(t.$body.height())});var n=$.eduibutton({icon:e,click:function(){t.execCommand(e),UM.setTopEditor(t)},title:this.getLang("labelMap")[e]||""});return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(t==-1).active(t==1)}),n}),UM.registerUI("paragraph fontfamily fontsize",function(e){function o(e,t){var n=$("<span>").html(e).css({display:"inline",position:"absolute",top:-1e7,left:-1e5}).appendTo(document.body),r=n.width();return n.remove(),n=null,r<50?e:(e=e.slice(0,t?-4:-1),e.length?o(e+"...",!0):"...")}function u(e){var t=[];for(var n in e.items)e.value.push(n),t.push(n),e.autowidthitem.push(o(n));return e.items=t,e.autoRecord=!1,e}function a(e){var t=null,n=[];for(var r=0,i=e.items.length;r<i;r++)t=e.items[r].val,n.push(t.split(/\s*,\s*/)[0]),e.itemStyles.push("font-family: "+t),e.value.push(t),e.autowidthitem.push(o(n[r]));return e.items=n,e}function f(e){var t=null,n=[];e.itemStyles=[],e.value=[];for(var r=0,i=e.items.length;r<i;r++)t=e.items[r],n.push(t),e.itemStyles.push("font-size: "+t+"px");return e.value=e.items,e.items=n,e.autoRecord=!1,e}var t=this,n=t.options.labelMap&&t.options.labelMap[e]||t.getLang("labelMap."+e),r={label:n,title:n,comboboxName:e,items:t.options[e]||[],itemStyles:[],value:[],autowidthitem:[]},i=null,s=null;if(r.items.length==0)return null;switch(e){case"paragraph":r=u(r);break;case"fontfamily":r=a(r);break;case"fontsize":r=f(r)}return i=$.eduibuttoncombobox(r).css("zIndex",t.getOpt("zIndex")+1),s=i.edui(),s.on("comboboxselect",function(n,r){t.execCommand(e,r.value)}).on("beforeshow",function(){i.parent().length===0&&i.appendTo(t.$container.find(".edui-dialog-container")),UM.setTopEditor(t)}),this.addListener("selectionchange",function(t){var n=this.queryCommandState(e),r=this.queryCommandValue(e);s.button().edui().disabled(n==-1).active(n==1),r&&(r=r.replace(/['"]/g,"").toLowerCase().split(/['|"]?\s*,\s*[\1]?/),s.selectItemByLabel(r))}),s.button().addClass("edui-combobox")}),UM.registerUI("forecolor backcolor",function(e){function t(){return domUtils.getComputedStyle(i[0],"background-color")}var n=this,r=null,i=null,s=null;return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);s.edui().disabled(t==-1).active(t==1)}),s=$.eduicolorsplitbutton({icon:e,caret:!0,name:e,title:n.getLang("labelMap")[e],click:function(){n.execCommand(e,t())}}),i=s.edui().colorLabel(),r=$.eduicolorpicker({name:e,lang_clearColor:n.getLang("clearColor")||"",lang_themeColor:n.getLang("themeColor")||"",lang_standardColor:n.getLang("standardColor")||""}).on("pickcolor",function(t,r){window.setTimeout(function(){i.css("backgroundColor",r),n.execCommand(e,r)},0)}).on("show",function(){UM.setActiveWidget(colorPickerWidget.root())}).css("zIndex",n.getOpt("zIndex")+1),s.edui().on("arrowclick",function(){r.parent().length||n.$container.find(".edui-dialog-container").append(r),r.edui().show(s,{caretDir:"down",offsetTop:-5,offsetLeft:8,caretLeft:11,caretTop:-8}),UM.setTopEditor(n)}).register("click",s,function(){r.edui().hide()}),s})})(jQuery);