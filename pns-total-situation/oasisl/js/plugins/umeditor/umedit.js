define([],function(){return function(g){function G(e,t,n){var r;return t=t.toLowerCase(),(r=e.__allListeners||n&&(e.__allListeners={}))&&(r[t]||n&&(r[t]=[]))}function H(e,t,n,r,i,s){r=r&&e[t];var o;for(!r&&(r=e[n]);!r&&(o=(o||e).parentNode);){if("BODY"==o.tagName||s&&!s(o))return null;r=o[n]}return r&&i&&!i(r)?H(r,t,n,!1,i):r}UMEDITOR_CONFIG=window.UMEDITOR_CONFIG||{},window.UM={plugins:{},commands:{},I18N:{},version:"1.2.2"};var B=UM.dom={},m=UM.browser=function(){var e=navigator.userAgent.toLowerCase(),t=window.opera,n={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(e),opera:!!t&&t.version,webkit:-1<e.indexOf(" applewebkit/"),mac:-1<e.indexOf("macintosh"),quirks:"BackCompat"==document.compatMode};n.gecko="Gecko"==navigator.product&&!n.webkit&&!n.opera&&!n.ie;var r=0;if(n.ie){var r=e.match(/(?:msie\s([\w.]+))/),i=e.match(/(?:trident.*rv:([\w.]+))/),r=r&&i&&r[1]&&i[1]?Math.max(1*r[1],1*i[1]):r&&r[1]?1*r[1]:i&&i[1]?1*i[1]:0;n.ie11Compat=11==document.documentMode,n.ie9Compat=9==document.documentMode,n.ie8=!!document.documentMode,n.ie8Compat=8==document.documentMode,n.ie7Compat=7==r&&!document.documentMode||7==document.documentMode,n.ie6Compat=7>r||n.quirks,n.ie9above=8<r,n.ie9below=9>r}return n.gecko&&(i=e.match(/rv:([\d\.]+)/))&&(i=i[1].split("."),r=1e4*i[0]+100*(i[1]||0)+1*(i[2]||0)),/chrome\/(\d+\.\d)/i.test(e)&&(n.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome/i.test(e)&&(n.safari=+(RegExp.$1||RegExp.$2)),n.opera&&(r=parseFloat(t.version())),n.webkit&&(r=parseFloat(e.match(/ applewebkit\/(\d+)/)[1])),n.version=r,n.isCompatible=!n.mobile&&(n.ie&&6<=r||n.gecko&&10801<=r||n.opera&&9.5<=r||n.air&&1<=r||n.webkit&&522<=r||!1),n}(),E=m.ie,n=UM.utils={each:function(e,t,n){if(null!=e)if(e.length===+e.length){for(var r=0,i=e.length;r<i;r++)if(!1===t.call(n,e[r],r,e))return!1}else for(r in e)if(e.hasOwnProperty(r)&&!1===t.call(n,e[r],r,e))return!1},makeInstance:function(e){var t=new Function;return t.prototype=e,e=new t,t.prototype=null,e},extend:function(e,t,n){if(t)for(var r in t)n&&e.hasOwnProperty(r)||(e[r]=t[r]);return e},extend2:function(e){for(var t=arguments,n=1;n<t.length;n++){var r=t[n],i;for(i in r)e.hasOwnProperty(i)||(e[i]=r[i])}return e},inherits:function(e,t){var r=e.prototype,i=n.makeInstance(t.prototype);return n.extend(i,r,!0),e.prototype=i,i.constructor=e},bind:function(e,t){return function(){return e.apply(t,arguments)}},defer:function(e,t,n){var r;return function(){n&&clearTimeout(r),r=setTimeout(e,t)}},indexOf:function(e,t,n){var r=-1;return n=this.isNumber(n)?n:0,this.each(e,function(e,i){if(i>=n&&e===t)return r=i,!1}),r},removeItem:function(e,t){for(var n=0,r=e.length;n<r;n++)e[n]===t&&(e.splice(n,1),n--)},trim:function(e){return e.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(e){if(!e)return{};e=n.isArray(e)?e:e.split(",");for(var t=0,r,i={};r=e[t++];)i[r.toUpperCase()]=i[r]=1;return i},unhtml:function(e,t){return e?e.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(e,t){return t?e:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[e]}):""},html:function(e){return e?e.replace(/&((g|l|quo)t|amp|#39);/g,function(e){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[e]}):""},cssStyleToDomStyle:function(){var e=document.createElement("div").style,t={"float":void 0!=e.cssFloat?"cssFloat":void 0!=e.styleFloat?"styleFloat":"float"};return function(e){return t[e]||(t[e]=e.toLowerCase().replace(/-./g,function(e){return e.charAt(1).toUpperCase()}))}}(),loadFile:function(){function e(e,n){try{for(var r=0,i;i=t[r++];)if(i.doc===e&&i.url==(n.src||n.href))return i}catch(s){return null}}var t=[];return function(n,r,i){var s=e(n,r);if(s)s.ready?i&&i():s.funs.push(i);else if(t.push({doc:n,url:r.src||r.href,funs:[i]}),!n.body){i=[];for(var o in r)"tag"!=o&&i.push(o+'="'+r[o]+'"');n.write("<"+r.tag+" "+i.join(" ")+" ></"+r.tag+">")}else if(!r.id||!n.getElementById(r.id)){var u=n.createElement(r.tag);delete r.tag;for(o in r)u.setAttribute(o,r[o]);u.onload=u.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){s=e(n,r);if(0<s.funs.length){s.ready=1;for(var t;t=s.funs.pop();)t()}u.onload=u.onreadystatechange=null}},u.onerror=function(){throw Error("The load "+(r.href||r.src)+" fails,check the url settings of file umeditor.config.js ")},n.getElementsByTagName("head")[0].appendChild(u)}}}(),isEmptyObject:function(e){if(null==e)return!0;if(this.isArray(e)||this.isString(e))return 0===e.length;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},fixColor:function(e,t){if(/color/i.test(e)&&/rgba?/.test(t)){var n=t.split(",");if(3<n.length)return"";t="#";for(var r=0,i;i=n[r++];)i=parseInt(i.replace(/[^\d]/gi,""),10).toString(16),t+=1==i.length?"0"+i:i;t=t.toUpperCase()}return t},clone:function(e,t){var r;t=t||{};for(var i in e)e.hasOwnProperty(i)&&(r=e[i],"object"==typeof r?(t[i]=n.isArray(r)?[]:{},n.clone(e[i],t[i])):t[i]=r);return t},transUnitToPx:function(e){if(!/(pt|cm)/.test(e))return e;var t;e.replace(/([\d.]+)(\w+)/,function(n,r,i){e=r,t=i});switch(t){case"cm":e=25*parseFloat(e);break;case"pt":e=Math.round(96*parseFloat(e)/72)}return e+(e?"px":"")},cssRule:m.ie&&11!=m.version?function(e,t,n){var r;n=n||document,r=n.indexList?n.indexList:n.indexList={};var i;if(r[e])i=n.styleSheets[r[e]];else{if(void 0===t)return"";i=n.createStyleSheet("",n=n.styleSheets.length),r[e]=n}if(void 0===t)return i.cssText;i.cssText=t||""}:function(e,t,n){n=n||document;var r=n.getElementsByTagName("head")[0],i;if(!(i=n.getElementById(e))){if(void 0===t)return"";i=n.createElement("style"),i.id=e,r.appendChild(i)}if(void 0===t)return i.innerHTML;""!==t?i.innerHTML=t:r.removeChild(i)}};n.each("String Function Array Number RegExp Object".split(" "),function(e){UM.utils["is"+e]=function(t){return Object.prototype.toString.apply(t)=="[object "+e+"]"}});var I=UM.EventBase=function(){};I.prototype={addListener:function(e,t){e=n.trim(e).split(" ");for(var r=0,i;i=e[r++];)G(this,i,!0).push(t)},removeListener:function(e,t){e=n.trim(e).split(" ");for(var r=0,i;i=e[r++];)n.removeItem(G(this,i)||[],t)},fireEvent:function(){for(var e=arguments[0],e=n.trim(e).split(" "),t=0,r;r=e[t++];){var i=G(this,r),s,o,u;if(i)for(u=i.length;u--;)if(i[u]){o=i[u].apply(this,arguments);if(!0===o)return o;void 0!==o&&(s=o)}if(o=this["on"+r.toLowerCase()])s=o.apply(this,arguments)}return s}};var q=B.dtd=function(){function e(e){for(var t in e)e[t.toUpperCase()]=e[t];return e}var t=n.extend2,r=e({isindex:1,fieldset:1}),i=e({input:1,button:1,select:1,textarea:1,label:1}),s=t(e({a:1}),i),o=t({iframe:1},s),u=e({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),a=e({ins:1,del:1,script:1,style:1}),f=t(e({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),a),l=t(e({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),f),c=t(e({p:1}),l),i=t(e({iframe:1}),l,i),l=e({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),h=t(e({a:0}),i),p=e({tr:1}),d=e({"#":1}),v=t(e({param:1}),l),m=t(e({form:1}),r,o,u,c),g=e({li:1,ol:1,ul:1}),y=e({style:1,script:1}),b=e({base:1,link:1,meta:1,title:1}),y=t(b,y),w=e({head:1,body:1}),E=e({html:1}),S=e({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),x=e({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return e({$nonBodyContent:t(E,w,b),$block:S,$inline:h,$inlineWithA:t(e({a:1}),h),$body:t(e({script:1,style:1}),S),$cdata:e({script:1,style:1}),$empty:x,$nonChild:e({iframe:1,textarea:1}),$listItem:e({dd:1,dt:1,li:1}),$list:e({ul:1,ol:1,dl:1}),$isNotEmpty:e({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:e({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:e({p:1,div:1}),$tableContent:e({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:e({pre:1,script:1,style:1,textarea:1}),html:w,head:y,style:d,script:d,body:m,base:{},link:{},meta:{},title:d,col:{},tr:e({td:1,th:1}),img:{},embed:{},colgroup:e({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:m,td:m,br:{},th:m,center:m,kbd:h,button:t(c,u),basefont:{},h5:h,h4:h,samp:h,h6:h,ol:g,h1:h,h3:h,option:d,h2:h,form:t(r,o,u,c),select:e({optgroup:1,option:1}),font:h,ins:h,menu:g,abbr:h,label:h,table:e({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:h,tfoot:p,cite:h,li:m,input:{},iframe:m,strong:h,textarea:d,noframes:m,big:h,small:h,span:e({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:h,dt:h,sub:h,optgroup:e({option:1}),param:{},bdo:h,"var":h,div:m,object:v,sup:h,dd:m,strike:h,area:{},dir:g,map:t(e({area:1,form:1,p:1}),r,a,u),applet:v,dl:e({dt:1,dd:1}),del:h,isindex:{},fieldset:t(e({legend:1}),l),thead:p,ul:g,acronym:h,b:h,a:t(e({a:1}),i),blockquote:t(e({td:1,tr:1,tbody:1,li:1}),m),caption:h,i:h,u:h,tbody:p,s:h,address:t(o,c),tt:h,legend:h,q:h,pre:t(f,s),p:t(e({a:1}),h),em:h,dfn:h})}(),J=E&&9>m.version?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},K=n.listToMap("-webkit-box -moz-box block list-item table table-row-group table-header-group table-footer-group table-row table-column-group table-column table-cell table-caption".split(" ")),k=B.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:E&&"6"==m.version?"﻿":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},breakParent:function(e,t){var n,r=e,i=e,s,o;do{r=r.parentNode,s?(n=r.cloneNode(!1),n.appendChild(s),s=n,n=r.cloneNode(!1),n.appendChild(o),o=n):(s=r.cloneNode(!1),o=s.cloneNode(!1));for(;n=i.previousSibling;)s.insertBefore(n,s.firstChild);for(;n=i.nextSibling;)o.appendChild(n);i=r}while(t!==r);return n=t.parentNode,n.insertBefore(s,t),n.insertBefore(o,t),n.insertBefore(e,o),k.remove(t),e},trimWhiteTextNode:function(e){function t(t){for(var n;(n=e[t])&&3==n.nodeType&&k.isWhitespace(n);)e.removeChild(n)}t("firstChild"),t("lastChild")},getPosition:function(e,t){if(e===t)return 0;var n,r=[e],i=[t];for(n=e;n=n.parentNode;){if(n===t)return 10;r.push(n)}for(n=t;n=n.parentNode;){if(n===e)return 20;i.push(n)}r.reverse(),i.reverse();if(r[0]!==i[0])return 1;for(n=-1;n++,r[n]===i[n];);e=r[n];for(t=i[n];e=e.nextSibling;)if(e===t)return 4;return 2},getNodeIndex:function(e,t){for(var n=e,r=0;n=n.previousSibling;)t&&3==n.nodeType?n.nodeType!=n.nextSibling.nodeType&&r++:r++;return r},inDoc:function(e,t){return 10==k.getPosition(e,t)},findParent:function(e,t,n){if(e&&!k.isBody(e))for(e=n?e:e.parentNode;e;){if(!t||t(e)||k.isBody(e))return t&&!t(e)&&k.isBody(e)?null:e;e=e.parentNode}return null},findParentByTagName:function(e,t,r,i){return t=n.listToMap(n.isArray(t)?t:[t]),k.findParent(e,function(e){return t[e.tagName]&&(!i||!i(e))},r)},findParents:function(e,t,n,r){for(t=t&&(n&&n(e)||!n)?[e]:[];e=k.findParent(e,n);)t.push(e);return r?t:t.reverse()},insertAfter:function(e,t){return e.parentNode.insertBefore(t,e.nextSibling)},remove:function(e,t){var n=e.parentNode,r;if(n){if(t&&e.hasChildNodes())for(;r=e.firstChild;)n.insertBefore(r,e);n.removeChild(e)}return e},getNextDomNode:function(e,t,n,r){return H(e,"firstChild","nextSibling",t,n,r)},getPreDomNode:function(e,t,n,r){return H(e,"lastChild","previousSibling",t,n,r)},isBookmarkNode:function(e){return 1==e.nodeType&&e.id&&/^_baidu_bookmark_/i.test(e.id)},getWindow:function(e){return e=e.ownerDocument||e,e.defaultView||e.parentWindow},getCommonAncestor:function(e,t){if(e===t)return e;for(var n=[e],r=[t],i=e,s=-1;i=i.parentNode;){if(i===t)return i;n.push(i)}for(i=t;i=i.parentNode;){if(i===e)return i;r.push(i)}n.reverse();for(r.reverse();s++,n[s]===r[s];);return 0==s?null:n[s-1]},clearEmptySibling:function(e,t,n){function r(e,t){for(var n;e&&!k.isBookmarkNode(e)&&(k.isEmptyInlineElement(e)||!RegExp("[^	\n\r"+k.fillChar+"]").test(e.nodeValue));)n=e[t],k.remove(e),e=n}!t&&r(e.nextSibling,"nextSibling"),!n&&r(e.previousSibling,"previousSibling")},split:function(e,t){var n=e.ownerDocument;if(m.ie&&t==e.nodeValue.length){var r=n.createTextNode("");return k.insertAfter(e,r)}return r=e.splitText(t),m.ie8&&(n=n.createTextNode(""),k.insertAfter(r,n),k.remove(n)),r},isWhitespace:function(e){return!RegExp("[^ 	\n\r"+k.fillChar+"]").test(e.nodeValue)},getXY:function(e){for(var t=0,n=0;e.offsetParent;)n+=e.offsetTop,t+=e.offsetLeft,e=e.offsetParent;return{x:t,y:n}},isEmptyInlineElement:function(e){if(1!=e.nodeType||!q.$removeEmpty[e.tagName])return 0;for(e=e.firstChild;e;){if(k.isBookmarkNode(e)||1==e.nodeType&&!k.isEmptyInlineElement(e)||3==e.nodeType&&!k.isWhitespace(e))return 0;e=e.nextSibling}return 1},isBlockElm:function(e){return 1==e.nodeType&&(q.$block[e.tagName]||K[k.getComputedStyle(e,"display")])&&!q.$nonChild[e.tagName]},getElementsByTagName:function(e,t,r){if(r&&n.isString(r)){var i=r;r=function(e){var t=!1;return g.each(n.trim(i).replace(/[ ]{2,}/g," ").split(" "),function(n,r){if(g(e).hasClass(r))return t=!0,!1}),t}}t=n.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var s=[],o=0,u;u=t[o++];){u=e.getElementsByTagName(u);for(var a=0,f;f=u[a++];)r&&!r(f)||s.push(f)}return s},unSelectable:E&&m.ie9below||m.opera?function(e){e.onselectstart=function(){return!1},e.onclick=e.onkeyup=e.onkeydown=function(){return!1},e.unselectable="on",e.setAttribute("unselectable","on");for(var t=0,n;n=e.all[t++];)switch(n.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:n.unselectable="on",e.setAttribute("unselectable","on")}}:function(e){e.style.MozUserSelect=e.style.webkitUserSelect=e.style.msUserSelect=e.style.KhtmlUserSelect="none"},removeAttributes:function(e,t){t=n.isArray(t)?t:n.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var r=0,i;i=t[r++];){i=J[i]||i;switch(i){case"className":e[i]="";break;case"style":e.style.cssText="",!m.ie&&e.removeAttributeNode(e.getAttributeNode("style"))}e.removeAttribute(i)}},createElement:function(e,t,n){return k.setAttributes(e.createElement(t),n)},setAttributes:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];switch(n){case"class":e.className=r;break;case"style":e.style.cssText=e.style.cssText+";"+r;break;case"innerHTML":e[n]=r;break;case"value":e.value=r;break;default:e.setAttribute(J[n]||n,r)}}return e},getComputedStyle:function(e,t){return n.transUnitToPx(n.fixColor(t,g(e).css(t)))},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},removeStyle:function(e,t){m.ie?("color"==t&&(t="(^|;)"+t),e.style.cssText=e.style.cssText.replace(RegExp(t+"[^:]*:[^;]+;?","ig"),"")):e.style.removeProperty?e.style.removeProperty(t):e.style.removeAttribute(n.cssStyleToDomStyle(t)),e.style.cssText||k.removeAttributes(e,["style"])},getStyle:function(e,t){var r=e.style[n.cssStyleToDomStyle(t)];return n.fixColor(t,r)},setStyle:function(e,t,r){e.style[n.cssStyleToDomStyle(t)]=r,n.trim(e.style.cssText)||this.removeAttributes(e,"style")},removeDirtyAttr:function(e){for(var t=0,n,r=e.getElementsByTagName("*");n=r[t++];)n.removeAttribute("_moz_dirty");e.removeAttribute("_moz_dirty")},getChildCount:function(e,t){var n=0,r=e.firstChild;for(t=t||function(){return 1};r;)t(r)&&n++,r=r.nextSibling;return n},isEmptyNode:function(e){return!e.firstChild||0==k.getChildCount(e,function(e){return!k.isBr(e)&&!k.isBookmarkNode(e)&&!k.isWhitespace(e)})},isBr:function(e){return 1==e.nodeType&&"BR"==e.tagName},isFillChar:function(e,t){return 3==e.nodeType&&!e.nodeValue.replace(RegExp((t?"^":"")+k.fillChar),"").length},isEmptyBlock:function(e,t){if(1!=e.nodeType)return 0;t=t||RegExp("[ 	\r\n"+k.fillChar+"]","g");if(0<e[m.ie?"innerText":"textContent"].replace(t,"").length)return 0;for(var n in q.$isNotEmpty)if(e.getElementsByTagName(n).length)return 0;return 1},isCustomeNode:function(e){return 1==e.nodeType&&e.getAttribute("_ue_custom_node_")},fillNode:function(e,t){var n=m.ie?e.createTextNode(k.fillChar):e.createElement("br");t.innerHTML="",t.appendChild(n)},isBoundaryNode:function(e,t){for(var n;!k.isBody(e);)if(n=e,e=e.parentNode,n!==e[t])return!1;return!0},isFillChar:function(e,t){return 3==e.nodeType&&!e.nodeValue.replace(RegExp((t?"^":"")+k.fillChar),"").length},isBody:function(e){return g(e).hasClass("edui-body-container")}},F=RegExp(k.fillChar,"g");(function(){function e(e,t,n,r){return 1==t.nodeType&&(q.$empty[t.tagName]||q.$nonChild[t.tagName])&&(n=k.getNodeIndex(t)+(e?0:1),t=t.parentNode),e?(r.startContainer=t,r.startOffset=n,r.endContainer||r.collapse(!0)):(r.endContainer=t,r.endOffset=n,r.startContainer||r.collapse(!1)),r.collapsed=r.startContainer&&r.endContainer&&r.startContainer===r.endContainer&&r.startOffset==r.endOffset,r}function t(e,t){try{if(s&&k.inDoc(s,e))if(s.nodeValue.replace(F,"").length)s.nodeValue=s.nodeValue.replace(F,"");else{var n=s.parentNode;for(k.remove(s);n&&k.isEmptyInlineElement(n)&&(m.safari?!(k.getPosition(n,t)&k.POSITION_CONTAINS):!n.contains(t));)s=n.parentNode,k.remove(n),n=s}}catch(r){}}function n(e,t){var n;for(e=e[t];e&&k.isFillChar(e);)n=e[t],k.remove(e),e=n}var r=0,i=k.fillChar,s,o=B.Range=function(e,t){this.startContainer=this.startOffset=this.endContainer=this.endOffset=null,this.document=e,this.collapsed=!0,this.body=t};o.prototype={deleteContents:function(){var e;if(!this.collapsed){e=this.startContainer;var t=this.endContainer,n=this.startOffset,r=this.endOffset,i=this.document,s=i.createDocumentFragment(),o,u;1==e.nodeType&&(e=e.childNodes[n]||(o=e.appendChild(i.createTextNode("")))),1==t.nodeType&&(t=t.childNodes[r]||(u=t.appendChild(i.createTextNode(""))));if(e===t&&3==e.nodeType)s.appendChild(i.createTextNode(e.substringData(n,r-n))),e.deleteData(n,r-n),this.collapse(!0);else{for(var a,f,l=s,c=k.findParents(e,!0),h=k.findParents(t,!0),p=0;c[p]==h[p];)p++;for(var d=p,v;v=c[d];d++){a=v.nextSibling,v==e?o||(3==this.startContainer.nodeType?(l.appendChild(i.createTextNode(e.nodeValue.slice(n))),e.deleteData(n,e.nodeValue.length-n)):l.appendChild(e)):(f=v.cloneNode(!1),l.appendChild(f));for(;a&&a!==t&&a!==h[d];)v=a.nextSibling,l.appendChild(a),a=v;l=f}l=s,c[p]||(l.appendChild(c[p-1].cloneNode(!1)),l=l.firstChild);for(d=p;n=h[d];d++){a=n.previousSibling,n==t?u||3!=this.endContainer.nodeType||(l.appendChild(i.createTextNode(t.substringData(0,r))),t.deleteData(0,r)):(f=n.cloneNode(!1),l.appendChild(f));if(d!=p||!c[p])for(;a&&a!==e;)n=a.previousSibling,l.insertBefore(a,l.firstChild),a=n;l=f}this.setStartBefore(h[p]?c[p]?h[p]:c[p-1]:h[p-1]).collapse(!0),o&&k.remove(o),u&&k.remove(u)}}return m.webkit&&(e=this.startContainer,3!=e.nodeType||e.nodeValue.length||(this.setStartBefore(e).collapse(!0),k.remove(e))),this},inFillChar:function(){var e=this.startContainer;return this.collapsed&&3==e.nodeType&&e.nodeValue.replace(RegExp("^"+k.fillChar),"").length+1==e.nodeValue.length?!0:!1},setStart:function(t,n){return e(!0,t,n,this)},setEnd:function(t,n){return e(!1,t,n,this)},setStartAfter:function(e){return this.setStart(e.parentNode,k.getNodeIndex(e)+1)},setStartBefore:function(e){return this.setStart(e.parentNode,k.getNodeIndex(e))},setEndAfter:function(e){return this.setEnd(e.parentNode,k.getNodeIndex(e)+1)},setEndBefore:function(e){return this.setEnd(e.parentNode,k.getNodeIndex(e))},setStartAtFirst:function(e){return this.setStart(e,0)},setStartAtLast:function(e){return this.setStart(e,3==e.nodeType?e.nodeValue.length:e.childNodes.length)},setEndAtFirst:function(e){return this.setEnd(e,0)},setEndAtLast:function(e){return this.setEnd(e,3==e.nodeType?e.nodeValue.length:e.childNodes.length)},selectNode:function(e){return this.setStartBefore(e).setEndAfter(e)},selectNodeContents:function(e){return this.setStart(e,0).setEndAtLast(e)},cloneRange:function(){return(new o(this.document)).setStart(this.startContainer,this.startOffset).setEnd(this.endContainer,this.endOffset)},collapse:function(e){return e?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset),this.collapsed=!0,this},shrinkBoundary:function(e){function t(e){return 1==e.nodeType&&!k.isBookmarkNode(e)&&!q.$empty[e.tagName]&&!q.$nonChild[e.tagName]}for(var n,r=this.collapsed;1==this.startContainer.nodeType&&(n=this.startContainer.childNodes[this.startOffset])&&t(n);)this.setStart(n,0);if(r)return this.collapse(!0);if(!e)for(;1==this.endContainer.nodeType&&0<this.endOffset&&(n=this.endContainer.childNodes[this.endOffset-1])&&t(n);)this.setEnd(n,n.childNodes.length);return this},trimBoundary:function(e){this.txtToElmBoundary();var t=this.startContainer,n=this.startOffset,r=this.collapsed,i=this.endContainer;if(3==t.nodeType){if(0==n)this.setStartBefore(t);else if(n>=t.nodeValue.length)this.setStartAfter(t);else{var s=k.split(t,n);t===i?this.setEnd(s,this.endOffset-n):t.parentNode===i&&(this.endOffset+=1),this.setStartBefore(s)}if(r)return this.collapse(!0)}return e||(n=this.endOffset,i=this.endContainer,3==i.nodeType&&(0==n?this.setEndBefore(i):(n<i.nodeValue.length&&k.split(i,n),this.setEndAfter(i)))),this},txtToElmBoundary:function(e){function t(e,t){var n=e[t+"Container"],r=e[t+"Offset"];3==n.nodeType&&(r?r>=n.nodeValue.length&&e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"After"](n):e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"Before"](n))}if(e||!this.collapsed)t(this,"start"),t(this,"end");return this},insertNode:function(e){var t=e,n=1;11==e.nodeType&&(t=e.firstChild,n=e.childNodes.length),this.trimBoundary(!0);var r=this.startContainer,i=r.childNodes[this.startOffset];return i?r.insertBefore(e,i):r.appendChild(e),t.parentNode===this.endContainer&&(this.endOffset+=n),this.setStartBefore(t)},setCursor:function(e,t){return this.collapse(!e).select(t)},createBookmark:function(e,t){var n,i=this.document.createElement("span");return i.style.cssText="display:none;line-height:0px;",i.appendChild(this.document.createTextNode("‍")),i.id="_baidu_bookmark_start_"+(t?"":r++),this.collapsed||(n=i.cloneNode(!0),n.id="_baidu_bookmark_end_"+(t?"":r++)),this.insertNode(i),n&&this.collapse().insertNode(n).setEndBefore(n),this.setStartAfter(i),{start:e?i.id:i,end:n?e?n.id:n:null,id:e}},moveToBookmark:function(e){var t=e.id?this.document.getElementById(e.start):e.start;return e=e.end&&e.id?this.document.getElementById(e.end):e.end,this.setStartBefore(t),k.remove(t),e?(this.setEndBefore(e),k.remove(e)):this.collapse(!0),this},adjustmentBoundary:function(){if(!this.collapsed){for(;!k.isBody(this.startContainer)&&this.startOffset==this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length&&this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length;)this.setStartAfter(this.startContainer);for(;!k.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[3==this.endContainer.nodeType?"nodeValue":"childNodes"].length;)this.setEndBefore(this.endContainer)}return this},getClosedNode:function(){var e;if(!this.collapsed){var t=this.cloneRange().adjustmentBoundary().shrinkBoundary();t.collapsed||1!=t.startContainer.nodeType||t.startContainer!==t.endContainer||1!=t.endOffset-t.startOffset||(t=t.startContainer.childNodes[t.startOffset])&&1==t.nodeType&&(q.$empty[t.tagName]||q.$nonChild[t.tagName])&&(e=t)}return e},select:m.ie?function(e,r){var o;this.collapsed||this.shrinkBoundary();var u=this.getClosedNode();if(u&&!r){try{o=this.document.body.createControlRange(),o.addElement(u),o.select()}catch(a){}return this}var u=this.createBookmark(),l=u.start;o=this.document.body.createTextRange(),o.moveToElementText(l),o.moveStart("character",1);if(!this.collapsed){var h=this.document.body.createTextRange(),l=u.end;h.moveToElementText(l),o.setEndPoint("EndToEnd",h)}else if(!e&&3!=this.startContainer.nodeType){var h=this.document.createTextNode(i),p=this.document.createElement("span");p.appendChild(this.document.createTextNode(i)),l.parentNode.insertBefore(p,l),l.parentNode.insertBefore(h,l),t(this.document,h),s=h,n(p,"previousSibling"),n(l,"nextSibling"),o.moveStart("character",-1),o.collapse(!0)}this.moveToBookmark(u),p&&k.remove(p);try{o.select()}catch(d){}return this}:function(e){function r(e){function t(t,n,r){3==t.nodeType&&t.nodeValue.length<n&&(e[r+"Offset"]=t.nodeValue.length)}t(e.startContainer,e.startOffset,"start"),t(e.endContainer,e.endOffset,"end")}var o=k.getWindow(this.document),u=o.getSelection();m.gecko?this.body.focus():o.focus();if(u){u.removeAllRanges(),this.collapsed&&!e&&(e=o=this.startContainer,1==o.nodeType&&(e=o.childNodes[this.startOffset]),3==o.nodeType&&this.startOffset||(e?e.previousSibling&&3==e.previousSibling.nodeType:o.lastChild&&3==o.lastChild.nodeType)||(e=this.document.createTextNode(i),this.insertNode(e),t(this.document,e),n(e,"previousSibling"),n(e,"nextSibling"),s=e,this.setStart(e,m.webkit?1:0).collapse(!0))),o=this.document.createRange();if(this.collapsed&&m.opera&&1==this.startContainer.nodeType)if(e=this.startContainer.childNodes[this.startOffset]){for(;e&&k.isBlockElm(e);){if(1!=e.nodeType||!e.childNodes[0])break;e=e.childNodes[0]}e&&this.setStartBefore(e).collapse(!0)}else(e=this.startContainer.lastChild)&&k.isBr(e)&&this.setStartBefore(e).collapse(!0);r(this),o.setStart(this.startContainer,this.startOffset),o.setEnd(this.endContainer,this.endOffset),u.addRange(o)}return this},createAddress:function(e,t){function n(e){for(var n=e?i.startContainer:i.endContainer,r=k.findParents(n,!0,function(e){return!k.isBody(e)}),s=[],o=0,u;u=r[o++];)s.push(k.getNodeIndex(u,t));r=0;if(t)if(3==n.nodeType){for(n=n.previousSibling;n&&3==n.nodeType;)r+=n.nodeValue.replace(F,"").length,n=n.previousSibling;r+=e?i.startOffset:i.endOffset}else if(n=n.childNodes[e?i.startOffset:i.endOffset])r=k.getNodeIndex(n,t);else for(n=e?i.startContainer:i.endContainer,e=n.firstChild;e;)if(k.isFillChar(e))e=e.nextSibling;else if(r++,3==e.nodeType)for(;e&&3==e.nodeType;)e=e.nextSibling;else e=e.nextSibling;else r=e?k.isFillChar(n)?0:i.startOffset:i.endOffset;return 0>r&&(r=0),s.push(r),s}var r={},i=this;return r.startAddress=n(!0),e||(r.endAddress=i.collapsed?[].concat(r.startAddress):n()),r},moveToAddress:function(e,t){function n(e,t){for(var n=r.body,i,s,o=0,u,a=e.length;o<a;o++)if(u=e[o],i=n,n=n.childNodes[u],!n){s=u;break}t?n?r.setStartBefore(n):r.setStart(i,s):n?r.setEndBefore(n):r.setEnd(i,s)}var r=this;return n(e.startAddress,!0),!t&&e.endAddress&&n(e.endAddress),r},equals:function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]!==e[t])return!1;return!0},scrollIntoView:function(){var e=g('<span style="padding:0;margin:0;display:block;border:0">&nbsp;</span>');this.cloneRange().insertNode(e.get(0));var t=g(window).scrollTop(),n=g(window).height(),r=e.offset().top;if(r<t-n||r>t+n)r>t+n?window.scrollTo(0,r-n+e.height()):window.scrollTo(0,t-r);e.remove()},getOffset:function(){var e=this.createBookmark(),t=g(e.start).css("display","inline-block").offset();return this.moveToBookmark(e),t}}})(),function(){function e(e,t){var n=k.getNodeIndex;e=e.duplicate(),e.collapse(t);var r=e.parentElement();if(!r.hasChildNodes())return{container:r,offset:0};for(var i=r.children,s,o=e.duplicate(),u=0,a=i.length-1,f=-1;u<=a;){f=Math.floor((u+a)/2),s=i[f],o.moveToElementText(s);var l=o.compareEndPoints("StartToStart",e);if(0<l)a=f-1;else{if(!(0>l))return{container:r,offset:n(s)};u=f+1}}if(-1==f){o.moveToElementText(r),o.setEndPoint("StartToStart",e),o=o.text.replace(/(\r\n|\r)/g,"\n").length,i=r.childNodes;if(!o)return s=i[i.length-1],{container:s,offset:s.nodeValue.length};for(n=i.length;0<o;)o-=i[--n].nodeValue.length;return{container:i[n],offset:-o}}o.collapse(0<l),o.setEndPoint(0<l?"StartToStart":"EndToStart",e),o=o.text.replace(/(\r\n|\r)/g,"\n").length;if(!o)return q.$empty[s.tagName]||q.$nonChild[s.tagName]?{container:r,offset:n(s)+(0<l?0:1)}:{container:s,offset:0<l?0:s.childNodes.length};for(;0<o;)try{i=s,s=s[0<l?"previousSibling":"nextSibling"],o-=s.nodeValue.length}catch(c){return{container:r,offset:n(i)}}return{container:s,offset:0<l?-o:s.nodeValue.length+o}}function t(t,n){if(t.item)n.selectNode(t.item(0));else{var r=e(t,!0);n.setStart(r.container,r.offset),0!=t.compareEndPoints("StartToEnd",t)&&(r=e(t,!1),n.setEnd(r.container,r.offset))}return n}function n(e,t){var n;try{n=e.getNative(t).createRange()}catch(r){return null}var i=n.item?n.item(0):n.parentElement();return(i.ownerDocument||i)===e.document?n:null}(B.Selection=function(e,t){var r=this;r.document=e,r.body=t,m.ie9below&&g(t).on("beforedeactivate",function(){r._bakIERange=r.getIERange()}).on("activate",function(){try{var e=n(r);e&&r.rangeInBody(e)||!r._bakIERange||r._bakIERange.select()}catch(t){}r._bakIERange=null})}).prototype={hasNativeRange:function(){var e;if(!m.ie||m.ie9above){e=this.getNative();if(!e.rangeCount)return!1;e=e.getRangeAt(0)}else e=n(this);return this.rangeInBody(e)},getNative:function(e){var t=this.document;try{return t?m.ie9below||e?t.selection:k.getWindow(t).getSelection():null}catch(n){return null}},getIERange:function(e){var t=n(this,e);return t&&this.rangeInBody(t,e)||!this._bakIERange?t:this._bakIERange},rangeInBody:function(e,t){var n=m.ie9below||t?e.item?e.item():e.parentElement():e.startContainer;return n===this.body||k.inDoc(n,this.body)},cache:function(){this.clear(),this._cachedRange=this.getRange(),this._cachedStartElement=this.getStart(),this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var e=this.getStart();return e?k.findParents(e,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){return this.hasNativeRange()},getRange:function(){function e(e){for(var t=n.body.firstChild,r=e.collapsed;t&&t.firstChild;)e.setStart(t,0),t=t.firstChild;e.startContainer||e.setStart(n.body,0),r&&e.collapse(!0)}var n=this;if(null!=n._cachedRange)return this._cachedRange;var r=new B.Range(n.document,n.body);if(m.ie9below){var i=n.getIERange();if(i&&this.rangeInBody(i))try{t(i,r)}catch(s){e(r)}else e(r)}else{var o=n.getNative();if(o&&o.rangeCount&&n.rangeInBody(o.getRangeAt(0)))i=o.getRangeAt(0),o=o.getRangeAt(o.rangeCount-1),r.setStart(i.startContainer,i.startOffset).setEnd(o.endContainer,o.endOffset),r.collapsed&&k.isBody(r.startContainer)&&!r.startOffset&&e(r);else{if(this._bakRange&&(this._bakRange.startContainer===this.body||k.inDoc(this._bakRange.startContainer,this.body)))return this._bakRange;e(r)}}return this._bakRange=r},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var e=m.ie9below?this.getIERange():this.getRange(),t,n;if(m.ie9below){if(!e)return this.document.body.firstChild;if(e.item)return e.item(0);t=e.duplicate(),0<t.text.length&&t.moveStart("character",1),t.collapse(1),t=t.parentElement();for(n=e=e.parentElement();e=e.parentNode;)if(e==t){t=n;break}}else if(t=e.startContainer,1==t.nodeType&&t.hasChildNodes()&&(t=t.childNodes[Math.min(t.childNodes.length-1,e.startOffset)]),3==t.nodeType)return t.parentNode;return t},getText:function(){var e;return this.isFocus()&&(e=this.getNative())?(e=m.ie9below?e.createRange():e.getRangeAt(0),m.ie9below?e.text:e.toString()):""}}}(),function(){function e(e,t){var r;if(t.textarea)if(n.isString(t.textarea)){for(var i=0,s,o=k.getElementsByTagName(e,"textarea");s=o[i++];)if(s.id=="umeditor_textarea_"+t.options.textarea){r=s;break}}else r=t.textarea;r||(e.appendChild(r=k.createElement(document,"textarea",{name:t.options.textarea,id:"umeditor_textarea_"+t.options.textarea,style:"display:none"})),t.textarea=r),r.value=t.hasContents()?t.options.allHtmlEnabled?t.getAllHtml():t.getContent(null,null,!0):""}function t(e){for(var t in UM.plugins)-1==e.options.excludePlugins.indexOf(t)&&(UM.plugins[t].call(e),e.plugins[t]=1);e.langIsReady=!0,e.fireEvent("langReady")}function r(e){for(var t in e)return t}var i=0,s,o=UM.Editor=function(e){var s=this;s.uid=i++,I.call(s),s.commands={},s.options=n.extend(n.clone(e||{}),UMEDITOR_CONFIG,!0),s.shortcutkeys={},s.inputRules=[],s.outputRules=[],s.setOpt({isShow:!0,initialContent:"",initialStyle:"",autoClearinitialContent:!1,textarea:"editorValue",focus:!1,focusInEnd:!0,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,enterTag:"p",lang:"zh-cn",langPath:s.options.UMEDITOR_HOME_URL+"lang/",theme:"default",themePath:s.options.UMEDITOR_HOME_URL+"themes/",allHtmlEnabled:!1,autoSyncData:!0,autoHeightEnabled:!0,excludePlugins:""}),s.plugins={},n.isEmptyObject(UM.I18N)?n.loadFile(document,{src:s.options.langPath+s.options.lang+"/"+s.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){t(s)}):(s.options.lang=r(UM.I18N),t(s))};o.prototype={ready:function(e){e&&(this.isReady?e.apply(this):this.addListener("ready",e))},setOpt:function(e,t){var r={};n.isString(e)?r[e]=t:r=e,n.extend(this.options,r,!0)},getOpt:function(e){return this.options[e]||""},destroy:function(){this.fireEvent("destroy");var e=this.container.parentNode;e===document.body&&(e=this.container);var t=this.textarea;t?t.style.display="":(t=document.createElement("textarea"),e.parentNode.insertBefore(t,e)),t.style.width=this.body.offsetWidth+"px",t.style.height=this.body.offsetHeight+"px",t.value=this.getContent(),t.id=this.key,e.contains(t)&&g(t).insertBefore(e),e.innerHTML="",k.remove(e),UM.clearCache(this.id);for(var n in this)this.hasOwnProperty(n)&&delete this[n]},initialCont:function(e){if(e){e.getAttribute("name")&&(this.options.textarea=e.getAttribute("name"));if(e&&/script|textarea/ig.test(e.tagName)){var t=document.createElement("div");e.parentNode.insertBefore(t,e),this.options.initialContent=UM.htmlparser(e.value||e.innerHTML||this.options.initialContent).toHtml(),e.className&&(t.className=e.className),e.style.cssText&&(t.style.cssText=e.style.cssText),/textarea/i.test(e.tagName)?(this.textarea=e,this.textarea.style.display="none"):(e.parentNode.removeChild(e),e.id&&(t.id=e.id)),e=t,e.innerHTML=""}return e}return null},render:function(e){var t=this.options,r=function(t){return parseInt(g(e).css(t))};n.isString(e)&&(e=document.getElementById(e)),e&&(this.id=e.getAttribute("id"),UM.setEditor(this),n.cssRule("edui-style-body",this.options.initialStyle,document),e=this.initialCont(e),e.className+=" edui-body-container",t.minFrameWidth=t.initialFrameWidth?t.initialFrameWidth:t.initialFrameWidth=g(e).width()||UM.defaultWidth,t.initialFrameHeight?t.minFrameHeight=t.initialFrameHeight:t.initialFrameHeight=t.minFrameHeight=g(e).height()||UM.defaultHeight,e.style.width=/%$/.test(t.initialFrameWidth)?"100%":t.initialFrameWidth-r("padding-left")-r("padding-right")+"px",r=/%$/.test(t.initialFrameHeight)?"100%":t.initialFrameHeight-r("padding-top")-r("padding-bottom"),this.options.autoHeightEnabled?(e.style.minHeight=r+"px",e.style.height="",m.ie&&6>=m.version&&(e.style.height=r,e.style.setExpression("height","this.scrollHeight <= "+r+' ? "'+r+'px" : "auto"'))):g(e).height(r),e.style.zIndex=t.zIndex,this._setup(e))},_setup:function(t){var n=this,r=n.options;t.contentEditable=!0,document.body.spellcheck=!1,n.document=document,n.window=document.defaultView||document.parentWindow,n.body=t,n.$body=g(t),n.selection=new B.Selection(document,n.body),n._isEnabled=!1;var i;m.gecko&&(i=this.selection.getNative())&&i.removeAllRanges(),this._initEvents();for(var s=t.parentNode;s&&!k.isBody(s);s=s.parentNode)if("FORM"==s.tagName){n.form=s,n.options.autoSyncData?g(t).on("blur",function(){e(s,n)}):g(s).on("submit",function(){e(this,n)});break}if(r.initialContent)if(r.autoClearinitialContent){var o=n.execCommand;n.execCommand=function(){return n.fireEvent("firstBeforeExecCommand"),o.apply(n,arguments)},this._setDefaultContent(r.initialContent)}else this.setContent(r.initialContent,!1,!0);k.isEmptyNode(n.body)&&(n.body.innerHTML="<p>"+(m.ie?"":"<br/>")+"</p>"),r.focus&&setTimeout(function(){n.focus(n.options.focusInEnd),!n.options.autoClearinitialContent&&n._selectionChange()},0),n.container||(n.container=t.parentNode),n._bindshortcutKeys(),n.isReady=1,n.fireEvent("ready"),r.onready&&r.onready.call(n),(!m.ie||m.ie9above)&&g(n.body).on("blur focus",function(e){var t=n.selection.getNative();if("blur"==e.type)0<t.rangeCount&&(n._bakRange=t.getRangeAt(0));else{try{n._bakRange&&t.addRange(n._bakRange)}catch(r){}n._bakRange=null}}),!r.isShow&&n.setHide(),r.readonly&&n.setDisabled()},sync:function(t){(t=t?document.getElementById(t):k.findParent(this.body.parentNode,function(e){return"FORM"==e.tagName},!0))&&e(t,this)},setHeight:function(e,t){!t&&(this.options.initialFrameHeight=e),this.options.autoHeightEnabled?(g(this.body).css({"min-height":e+"px"}),m.ie&&6>=m.version&&this.container&&(this.container.style.height=e,this.container.style.setExpression("height","this.scrollHeight <= "+e+' ? "'+e+'px" : "auto"'))):g(this.body).height(e),this.fireEvent("resize")},setWidth:function(e){this.$container&&this.$container.width(e),g(this.body).width(e-1*g(this.body).css("padding-left").replace("px","")-1*g(this.body).css("padding-right").replace("px","")),this.fireEvent("resize")},addshortcutkey:function(e,t){var r={};t?r[e]=t:r=e,n.extend(this.shortcutkeys,r)},_bindshortcutKeys:function(){var e=this,t=this.shortcutkeys;e.addListener("keydown",function(n,r){var i=r.keyCode||r.which,s;for(s in t)for(var o=t[s].split(","),u=0,f;f=o[u++];){f=f.split(":");var l=f[0];f=f[1];if(/^(ctrl)(\+shift)?\+(\d+)$/.test(l.toLowerCase())||/^(\d+)$/.test(l))if("ctrl"==RegExp.$1&&(r.ctrlKey||r.metaKey)&&(""!=RegExp.$2?r[RegExp.$2.slice(1)+"Key"]:1)&&i==RegExp.$3||i==RegExp.$1)-1!=e.queryCommandState(s,f)&&e.execCommand(s,f),k.preventDefault(r)}})},getContent:function(e,t,r,i,s){return e&&n.isFunction(e)&&(t=e),(t?!t():!this.hasContents())?"":(this.fireEvent("beforegetcontent"),e=UM.htmlparser(this.body.innerHTML,i),this.filterOutputRule(e),this.fireEvent("aftergetcontent",e),e.toHtml(s))},getAllHtml:function(){var e=[];this.fireEvent("getAllHtml",e);if(m.ie&&8<m.version){var t="";n.each(this.document.styleSheets,function(e){t+=e.href?'<link rel="stylesheet" type="text/css" href="'+e.href+'" />':"<style>"+e.cssText+"</style>"}),n.each(this.document.getElementsByTagName("script"),function(e){t+=e.outerHTML})}return"<html><head>"+(this.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+this.options.charset+'"/>':"")+(t||this.document.getElementsByTagName("head")[0].innerHTML)+e.join("\n")+"</head><body "+(E&&9>m.version?'class="view"':"")+">"+this.getContent(null,null,!0)+"</body></html>"},getPlainTxt:function(){var e=RegExp(k.fillChar,"g"),t=this.body.innerHTML.replace(/[\n\r]/g,""),t=t.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(e,t,n){return q.$block[n]?"\n":t?t:""});return t.replace(e,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){return this.body[m.ie?"innerText":"textContent"].replace(RegExp(k.fillChar,"g"),"").replace(/\u00a0/g," ")},setContent:function(t,n,r){this.fireEvent("beforesetcontent",t),t=UM.htmlparser(t),this.filterInputRule(t),t=t.toHtml(),this.body.innerHTML=(n?this.body.innerHTML:"")+t;if("p"==this.options.enterTag)if(n=this.body.firstChild,!n||1==n.nodeType&&(q.$cdata[n.tagName]||"DIV"==n.tagName&&n.getAttribute("cdata_tag")||k.isCustomeNode(n))&&n===this.body.lastChild)this.body.innerHTML="<p>"+(m.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;else for(var i=this.document.createElement("p");n;){for(;n&&(3==n.nodeType||1==n.nodeType&&q.p[n.tagName]&&!q.$cdata[n.tagName]);)t=n.nextSibling,i.appendChild(n),n=t;if(i.firstChild){if(!n){this.body.appendChild(i);break}n.parentNode.insertBefore(i,n),i=this.document.createElement("p")}n=n.nextSibling}this.fireEvent("aftersetcontent"),this.fireEvent("contentchange"),!r&&this._selectionChange(),this._bakRange=this._bakIERange=this._bakNativeRange=null;var s;m.gecko&&(s=this.selection.getNative())&&s.removeAllRanges(),this.options.autoSyncData&&this.form&&e(this.form,this)},focus:function(e){try{var t=this.selection.getRange();e?t.setStartAtLast(this.body.lastChild).setCursor(!1,!0):t.select(!0),this.fireEvent("focus")}catch(n){}},blur:function(){var e=this.selection.getNative();e.empty?e.empty():e.removeAllRanges(),this.fireEvent("blur")},isFocus:function(){return!0===this.fireEvent("isfocus")?!0:this.selection.isFocus()},_initEvents:function(){var e=this,t=function(){e._proxyDomEvent.apply(e,arguments)};g(e.body).on("click contextmenu mousedown keydown keyup keypress mouseup mouseover mouseout selectstart",t).on("focus blur",t).on("mouseup keydown",function(t){"keydown"==t.type&&(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)||2!=t.button&&e._selectionChange(250,t)})},_proxyDomEvent:function(e){return this.fireEvent(e.type.replace(/^on/,""),e)},_selectionChange:function(e,t){var n=this,r=!1,i,o;m.ie&&9>m.version&&t&&"mouseup"==t.type&&!this.selection.getRange().collapsed&&(r=!0,i=t.clientX,o=t.clientY),clearTimeout(s),s=setTimeout(function(){if(n.selection.getNative()){var e;if(r&&"None"==n.selection.getNative().type){e=n.document.body.createTextRange();try{e.moveToPoint(i,o)}catch(s){e=null}}var u;e&&(u=n.selection.getIERange,n.selection.getIERange=function(){return e}),n.selection.cache(),u&&(n.selection.getIERange=u),n.selection._cachedRange&&n.selection._cachedStartElement&&(n.fireEvent("beforeselectionchange"),n.fireEvent("selectionchange",!!t),n.fireEvent("afterselectionchange"),n.selection.clear())}},e||50)},_callCmdFn:function(e,t){t=Array.prototype.slice.call(t,0);var n=t.shift().toLowerCase(),r,i;i=(r=this.commands[n]||UM.commands[n])&&r[e];if(!(r&&i||"queryCommandState"!=e))return 0;if(i)return i.apply(this,[n].concat(t))},execCommand:function(e){if(!this.isFocus()){var t=this.selection._bakRange;t?t.select():this.focus(!0)}e=e.toLowerCase();var n,t=this.commands[e]||UM.commands[e];return!t||!t.execCommand?null:(t.notNeedUndo||this.__hasEnterExecCommand?(n=this._callCmdFn("execCommand",arguments),this.__hasEnterExecCommand||t.ignoreContentChange||this._ignoreContentChange||this.fireEvent("contentchange")):(this.__hasEnterExecCommand=!0,-1!=this.queryCommandState.apply(this,arguments)&&(this.fireEvent("saveScene"),this.fireEvent("beforeexeccommand",e),n=this._callCmdFn("execCommand",arguments),t.ignoreContentChange||this._ignoreContentChange||this.fireEvent("contentchange"),this.fireEvent("afterexeccommand",e),this.fireEvent("saveScene")),this.__hasEnterExecCommand=!1),this.__hasEnterExecCommand||t.ignoreContentChange||this._ignoreContentChange||this._selectionChange(),n)},queryCommandState:function(e){try{return this._callCmdFn("queryCommandState",arguments)}catch(t){return 0}},queryCommandValue:function(e){try{return this._callCmdFn("queryCommandValue",arguments)}catch(t){return null}},hasContents:function(e){if(e)for(var t=0,n;n=e[t++];)if(0<this.body.getElementsByTagName(n).length)return!0;if(!k.isEmptyBlock(this.body))return!0;e=["div"];for(t=0;n=e[t++];){n=k.getElementsByTagName(this.body,n);for(var r=0,i;i=n[r++];)if(k.isCustomeNode(i))return!0}return!1},reset:function(){this.fireEvent("reset")},isEnabled:function(){return 1!=this._isEnabled},setEnabled:function(){var e;this.body.contentEditable=!0;if(this.lastBk){e=this.selection.getRange();try{e.moveToBookmark(this.lastBk),delete this.lastBk}catch(t){e.setStartAtFirst(this.body).collapse(!0)}e.select(!0)}this.bkqueryCommandState&&(this.queryCommandState=this.bkqueryCommandState,delete this.bkqueryCommandState),this._bkproxyDomEvent&&(this._proxyDomEvent=this._bkproxyDomEvent,delete this._bkproxyDomEvent),this.fireEvent("setEnabled")},enable:function(){return this.setEnabled()},setDisabled:function(e,t){var r=this;r.body.contentEditable=!1,r._except=e?n.isArray(e)?e:[e]:[],r.lastBk||(r.lastBk=r.selection.getRange().createBookmark(!0)),r.bkqueryCommandState||(r.bkqueryCommandState=r.queryCommandState,r.queryCommandState=function(e){return-1!=n.indexOf(r._except,e)?r.bkqueryCommandState.apply(r,arguments):-1}),t||r._bkproxyDomEvent||(r._bkproxyDomEvent=r._proxyDomEvent,r._proxyDomEvent=function(){return!1}),r.fireEvent("selectionchange"),r.fireEvent("setDisabled",r._except)},disable:function(e){return this.setDisabled(e)},_setDefaultContent:function(){function e(){var t=this;t.document.getElementById("initContent")&&(t.body.innerHTML="<p>"+(E?"":"<br/>")+"</p>",t.removeListener("firstBeforeExecCommand focus",e),setTimeout(function(){t.focus(),t._selectionChange()},0))}return function(t){this.body.innerHTML='<p id="initContent">'+t+"</p>",this.addListener("firstBeforeExecCommand focus",e)}}(),setShow:function(){var e=this.selection.getRange();if("none"==this.container.style.display){try{e.moveToBookmark(this.lastBk),delete this.lastBk}catch(t){e.setStartAtFirst(this.body).collapse(!0)}setTimeout(function(){e.select(!0)},100),this.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){this.lastBk||(this.lastBk=this.selection.getRange().createBookmark(!0)),this.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(e){var t=UM.I18N[this.options.lang];if(!t)throw Error("not import language file");e=(e||"").split(".");for(var n=0,r;(r=e[n++])&&(t=t[r],t););return t},getContentLength:function(e,t){var n=this.getContent(!1,!1,!0).length;if(e){t=(t||[]).concat(["hr","img","iframe"]);for(var n=this.getContentTxt().replace(/[\t\r\n]+/g,"").length,r=0,i;i=t[r++];)n+=this.body.getElementsByTagName(i).length}return n},addInputRule:function(e,t){e.ignoreUndo=t,this.inputRules.push(e)},filterInputRule:function(e,t){for(var n=0,r;r=this.inputRules[n++];)t&&r.ignoreUndo||r.call(this,e)},addOutputRule:function(e,t){e.ignoreUndo=t,this.outputRules.push(e)},filterOutputRule:function(e,t){for(var n=0,r;r=this.outputRules[n++];)t&&r.ignoreUndo||r.call(this,e)}},n.inherits(o,I)}(),UM.filterWord=function(){function e(e){return e=e.replace(/[\d.]+\w+/g,function(e){return n.transUnitToPx(e)})}function t(t){return t.replace(/[\t\r\n]+/g," ").replace(/\x3c!--[\s\S]*?--\x3e/ig,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(t){if(m.opera)return"";try{if(/Bitmap/i.test(t))return"";var n=t.match(/width:([ \d.]*p[tx])/i)[1],r=t.match(/height:([ \d.]*p[tx])/i)[1],i=t.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+e(n)+'" height="'+e(r)+'" src="'+i+'" />'}catch(s){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/ig,function(e,t,n,r){return"class"==t&&"MsoListParagraph"==r?e:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(e,t,n){return n.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(t,n,r,i){t=[],i=i.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g),r=0;for(var s;s=i[r];r++){var o,u=s.split(":");if(2==u.length&&(s=u[0].toLowerCase(),o=u[1].toLowerCase(),!(/^(background)\w*/.test(s)&&0==o.replace(/(initial|\s)/g,"").length||/^(margin)\w*/.test(s)&&/^0\w+$/.test(o)))){switch(s){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(n)||(t[r]=s.replace(/^mso-|-alt$/g,"")+":"+e(o));continue;case"horiz-align":t[r]="text-align:"+o;continue;case"vert-align":t[r]="vertical-align:"+o;continue;case"font-color":case"mso-foreground":t[r]="color:"+o;continue;case"mso-background":case"mso-highlight":t[r]="background:"+o;continue;case"mso-default-height":t[r]="min-height:"+e(o);continue;case"mso-default-width":t[r]="min-width:"+e(o);continue;case"mso-padding-between-alt":t[r]="border-collapse:separate;border-spacing:"+e(o);continue;case"text-line-through":if("single"==o||"double"==o)t[r]="text-decoration:line-through";continue;case"mso-zero-height":"yes"==o&&(t[r]="display:none");continue;case"margin":if(!/[1-9]/.test(o))continue}/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(s)||/text\-indent|padding|margin/.test(s)&&/\-[\d.]+/.test(o)||(t[r]=s+":"+u[1])}}return n+(t.length?' style="'+t.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(e){return n.transUnitToPx(e)})}return function(e){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/ig.test(e)?t(e):e}}(),function(){function e(e,t,n){return e.push(h),t+(n?1:-1)}function t(e,t){for(var n=0;n<t;n++)e.push(c)}function r(s,o,u,a){switch(s.type){case"root":for(var f=0,c;c=s.children[f++];)u&&"element"==c.type&&!q.$inlineWithA[c.tagName]&&1<f&&(e(o,a,!0),t(o,a)),r(c,o,u,a);break;case"text":"pre"==s.parentNode.tagName?o.push(s.data):o.push(l[s.parentNode.tagName]?n.html(s.data):s.data.replace(/[ ]{2}/g," &nbsp;"));break;case"element":i(s,o,u,a);break;case"comment":o.push("<!--"+s.data+"-->")}return o}function i(i,s,o,u){var a="";if(i.attrs){var a=[],l=i.attrs,c;for(c in l)a.push(c+(void 0!==l[c]?'="'+(f[c]?n.html(l[c]).replace(/["]/g,function(e){return"&quot;"}):n.unhtml(l[c]))+'"':""));a=a.join(" ")}s.push("<"+i.tagName+(a?" "+a:"")+(q.$empty[i.tagName]?"/":"")+">"),o&&!q.$inlineWithA[i.tagName]&&"pre"!=i.tagName&&i.children&&i.children.length&&(u=e(s,u,!0),t(s,u));if(i.children&&i.children.length)for(a=0;l=i.children[a++];)o&&"element"==l.type&&!q.$inlineWithA[l.tagName]&&1<a&&(e(s,u),t(s,u)),r(l,s,o,u);q.$empty[i.tagName]||(o&&!q.$inlineWithA[i.tagName]&&"pre"!=i.tagName&&i.children&&i.children.length&&(u=e(s,u),t(s,u)),s.push("</"+i.tagName+">"))}function s(e,t){var n;if("element"==e.type&&e.getAttr("id")==t)return e;if(e.children&&e.children.length)for(var r=0;n=e.children[r++];)if(n=s(n,t))return n}function o(e,t,n){"element"==e.type&&e.tagName==t&&n.push(e);if(e.children&&e.children.length)for(var r=0,i;i=e.children[r++];)o(i,t,n)}function u(e,t){if(e.children&&e.children.length)for(var n=0,r;r=e.children[n];)u(r,t),r.parentNode&&(r.children&&r.children.length&&t(r),r.parentNode&&n++);else t(e)}var a=UM.uNode=function(e){this.type=e.type,this.data=e.data,this.tagName=e.tagName,this.parentNode=e.parentNode,this.attrs=e.attrs||{},this.children=e.children},f={href:1,src:1,_src:1,_href:1,cdata_data:1},l={style:1,script:1},c="    ",h="\n";a.createElement=function(e){return/[<>]/.test(e)?UM.htmlparser(e).children[0]:new a({type:"element",children:[],tagName:e})},a.createText=function(e,t){return new UM.uNode({type:"text",data:t?e:n.unhtml(e||"")})},a.prototype={toHtml:function(e){var t=[];return r(this,t,e,0),t.join("")},innerHTML:function(e){if("element"!=this.type||q.$empty[this.tagName])return this;if(n.isString(e)){if(this.children)for(var t=0,r;r=this.children[t++];)r.parentNode=null;this.children=[],e=UM.htmlparser(e);for(t=0;r=e.children[t++];)this.children.push(r),r.parentNode=this;return this}return e=new UM.uNode({type:"root",children:this.children}),e.toHtml()},innerText:function(e,t){if("element"!=this.type||q.$empty[this.tagName])return this;if(e){if(this.children)for(var n=0,r;r=this.children[n++];)r.parentNode=null;return this.children=[],this.appendChild(a.createText(e,t)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return"element"==this.type?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){for(var e=this.parentNode,t=0,n;n=e.children[t];t++)if(n===this)return 0==t?null:e.children[t-1]},nextSibling:function(){for(var e=this.parentNode,t=0,n;n=e.children[t++];)if(n===this)return e.children[t]},replaceChild:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n=0,r;r=this.children[n];n++)if(r===t)return this.children.splice(n,1,e),t.parentNode=null,e.parentNode=this,e}},appendChild:function(e){if("root"==this.type||"element"==this.type&&!q.$empty[this.tagName]){this.children||(this.children=[]),e.parentNode&&e.parentNode.removeChild(e);for(var t=0,n;n=this.children[t];t++)if(n===e){this.children.splice(t,1);break}return this.children.push(e),e.parentNode=this,e}},insertBefore:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n=0,r;r=this.children[n];n++)if(r===t)return this.children.splice(n,0,e),e.parentNode=this,e}},insertAfter:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n=0,r;r=this.children[n];n++)if(r===t)return this.children.splice(n+1,0,e),e.parentNode=this,e}},removeChild:function(e,t){if(this.children)for(var n=0,r;r=this.children[n];n++)if(r===e){this.children.splice(n,1),r.parentNode=null;if(t&&r.children&&r.children.length)for(var i=0,s;s=r.children[i];i++)this.children.splice(n+i,0,s),s.parentNode=this;return r}},getAttr:function(e){return this.attrs&&this.attrs[e.toLowerCase()]},setAttr:function(e,t){if(e)if(this.attrs||(this.attrs={}),n.isObject(e))for(var r in e)e[r]?this.attrs[r.toLowerCase()]=e[r]:delete this.attrs[r];else t?this.attrs[e.toLowerCase()]=t:delete this.attrs[e];else delete this.attrs},hasAttr:function(e){return e=this.getAttr(e),null!==e&&void 0!==e},getIndex:function(){for(var e=this.parentNode,t=0,n;n=e.children[t];t++)if(n===this)return t;return-1},getNodeById:function(e){var t;if(this.children&&this.children.length)for(var n=0;t=this.children[n++];)if(t=s(t,e))return t},getNodesByTagName:function(e){e=n.trim(e).replace(/[ ]{2,}/g," ").split(" ");var t=[],r=this;return n.each(e,function(e){if(r.children&&r.children.length)for(var n=0,i;i=r.children[n++];)o(i,e,t)}),t},getStyle:function(e){var t=this.getAttr("style");return t?(e=t.match(RegExp("(^|;)\\s*"+e+":([^;]+)","i")))&&e[0]?e[2]:"":""},setStyle:function(e,t){function r(e,t){i=i.replace(RegExp("(^|;)\\s*"+e+":([^;]+;?)","gi"),"$1"),t&&(i=e+":"+n.unhtml(t)+";"+i)}var i=this.getAttr("style");i||(i="");if(n.isObject(e))for(var s in e)r(s,e[s]);else r(e,t);this.setAttr("style",n.trim(i))},hasClass:function(e){if(this.hasAttr("class")){var t=this.getAttr("class").split(/\s+/),n=!1;return g.each(t,function(t,r){r===e&&(n=!0)}),n}return!1},addClass:function(e){var t=null,n=!1;this.hasAttr("class")?(t=this.getAttr("class"),t=t.split(/\s+/),t.forEach(function(t){t===e&&(n=!0)}),!n&&t.push(e),this.setAttr("class",t.join(" "))):this.setAttr("class",e)},removeClass:function(e){if(this.hasAttr("class")){var t=this.getAttr("class"),t=t.replace(RegExp("\\b"+e+"\\b","g"),"");this.setAttr("class",n.trim(t).replace(/[ ]{2,}/g," "))}},traversal:function(e){return this.children&&this.children.length&&u(this,e),this}}}(),UM.htmlparser=function(e,t){function r(e,t){if(c[e.tagName]){var n=f.createElement(c[e.tagName]);e.appendChild(n),n.appendChild(f.createText(t))}else e.appendChild(f.createText(t))}function i(e,t,r){var s;if(s=l[t]){for(var u=e,c;"root"!=u.type;){if(n.isArray(s)?-1!=n.indexOf(s,u.tagName):s==u.tagName){e=u,c=!0;break}u=u.parentNode}c||(e=i(e,n.isArray(s)?s[0]:s))}s=new f({parentNode:e,type:"element",tagName:t.toLowerCase(),children:q.$empty[t]?null:[]});if(r){for(u={};c=o.exec(r);)u[c[1].toLowerCase()]=a[c[1].toLowerCase()]?c[2]||c[3]||c[4]:n.unhtml(c[2]||c[3]||c[4]);s.attrs=u}return e.children.push(s),q.$empty[t]?e:s}var s=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)--\x3e)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,o=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,u={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};e=e.replace(RegExp(k.fillChar,"g"),""),t||(e=e.replace(RegExp("[\\r\\t\\n"+(t?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(t?"":" ")+"]*","g"),function(e,n){return n&&u[n.toLowerCase()]?e.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):e.replace(RegExp("^[\\r\\n"+(t?"":" ")+"]+"),"").replace(RegExp("[\\r\\n"+(t?"":" ")+"]+$"),"")}));for(var a={href:1,src:1},f=UM.uNode,l={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},c={ol:"li",ul:"li"},h,p=0,d=0,v=new f({type:"root",children:[]}),m=v;h=s.exec(e);){p=h.index;try{if(p>d&&r(m,e.slice(d,p)),h[3])q.$cdata[m.tagName]?r(m,h[0]):m=i(m,h[3].toLowerCase(),h[4]);else if(h[1]){if("root"!=m.type)if(q.$cdata[m.tagName]&&!q.$cdata[h[1]])r(m,h[0]);else{for(p=m;"element"==m.type&&m.tagName!=h[1].toLowerCase();)if(m=m.parentNode,"root"==m.type)throw m=p,"break";m=m.parentNode}}else h[2]&&m.children.push(new f({type:"comment",data:h[2],parentNode:m}))}catch(g){}d=s.lastIndex}return d<e.length&&r(m,e.slice(d)),v},UM.filterNode=function(){function e(t,r){switch(t.type){case"element":var i;if(i=r[t.tagName])if("-"===i)t.parentNode.removeChild(t);else if(n.isFunction(i)){var s=t.parentNode,o=t.getIndex();i(t);if(t.parentNode){if(t.children)for(i=0;o=t.children[i];)e(o,r),o.parentNode&&i++}else for(i=o;o=s.children[i];)e(o,r),o.parentNode&&i++}else{if((i=i.$)&&t.attrs){var o={},u;for(s in i){u=t.getAttr(s);if("style"==s&&n.isArray(i[s])){var f=[];n.each(i[s],function(e){var n;(n=t.getStyle(e))&&f.push(e+":"+n)}),u=f.join(";")}u&&(o[s]=u)}t.attrs=o}if(t.children)for(i=0;o=t.children[i];)e(o,r),o.parentNode&&i++}else if(q.$cdata[t.tagName])t.parentNode.removeChild(t);else for(s=t.parentNode,o=t.getIndex(),t.parentNode.removeChild(t,!0),i=o;o=s.children[i];)e(o,r),o.parentNode&&i++;break;case"comment":t.parentNode.removeChild(t)}}return function(t,r){if(n.isEmptyObject(r))return t;var i;(i=r["-"])&&n.each(i.split(" "),function(e){r[e]="-"}),i=0;for(var s;s=t.children[i];)e(s,r),s.parentNode&&i++;return t}}(),UM.commands.inserthtml={execCommand:function(e,t,r){var i=this,s;if(t&&!0!==i.fireEvent("beforeinserthtml",t)){s=i.selection.getRange(),e=s.document.createElement("div"),e.style.display="inline",r||(t=UM.htmlparser(t),i.options.filterRules&&UM.filterNode(t,i.options.filterRules),i.filterInputRule(t),t=t.toHtml()),e.innerHTML=n.trim(t);if(!s.collapsed&&(t=s.startContainer,k.isFillChar(t)&&s.setStartBefore(t),t=s.endContainer,k.isFillChar(t)&&s.setEndAfter(t),s.txtToElmBoundary(),s.endContainer&&1==s.endContainer.nodeType&&(t=s.endContainer.childNodes[s.endOffset])&&k.isBr(t)&&s.setEndAfter(t),0==s.startOffset&&(t=s.startContainer,k.isBoundaryNode(t,"firstChild")&&(t=s.endContainer,s.endOffset==(3==t.nodeType?t.nodeValue.length:t.childNodes.length)&&k.isBoundaryNode(t,"lastChild")&&(i.body.innerHTML="<p>"+(m.ie?"":"<br/>")+"</p>",s.setStart(i.body.firstChild,0).collapse(!0)))),!s.collapsed&&s.deleteContents(),1==s.startContainer.nodeType)){t=s.startContainer.childNodes[s.startOffset];var o;if(t&&k.isBlockElm(t)&&(o=t.previousSibling)&&k.isBlockElm(o)){for(s.setEnd(o,o.childNodes.length).collapse();t.firstChild;)o.appendChild(t.firstChild);k.remove(t)}}var u,a;r=0;var f;s.inFillChar()&&(t=s.startContainer,k.isFillChar(t)?(s.setStartBefore(t).collapse(!0),k.remove(t)):k.isFillChar(t,!0)&&(t.nodeValue=t.nodeValue.replace(F,""),s.startOffset--,s.collapsed&&s.collapse(!0)));for(;t=e.firstChild;){if(r){for(u=i.document.createElement("p");t&&(3==t.nodeType||!q.$block[t.tagName]);)f=t.nextSibling,u.appendChild(t),t=f;u.firstChild&&(t=u)}s.insertNode(t),f=t.nextSibling;if(!r&&t.nodeType==k.NODE_ELEMENT&&k.isBlockElm(t)&&(u=k.findParent(t,function(e){return k.isBlockElm(e)}))&&"body"!=u.tagName.toLowerCase()&&(!q[u.tagName][t.nodeName]||t.parentNode!==u)){if(q[u.tagName][t.nodeName])for(a=t.parentNode;a!==u;)o=a,a=a.parentNode;else o=u;k.breakParent(t,o||a),o=t.previousSibling,k.trimWhiteTextNode(o),o.childNodes.length||k.remove(o),!m.ie&&(l=t.nextSibling)&&k.isBlockElm(l)&&l.lastChild&&!k.isBr(l.lastChild)&&l.appendChild(i.document.createElement("br")),r=1}var l=t.nextSibling;if(!e.firstChild&&l&&k.isBlockElm(l)){s.setStart(l,0).collapse(!0);break}s.setEndAfter(t).collapse()}t=s.startContainer,f&&k.isBr(f)&&k.remove(f);if(k.isBlockElm(t)&&k.isEmptyNode(t))if(f=t.nextSibling)k.remove(t),1==f.nodeType&&q.$block[f.tagName]&&s.setStart(f,0).collapse(!0).shrinkBoundary();else try{t.innerHTML=m.ie?k.fillChar:"<br/>"}catch(c){s.setStartBefore(t),k.remove(t)}try{if(m.ie9below&&1==s.startContainer.nodeType&&!s.startContainer.childNodes[s.startOffset]&&(o=s.startContainer.childNodes[s.startOffset-1])&&1==o.nodeType&&q.$empty[o.tagName]){var h=this.document.createTextNode(k.fillChar);s.insertNode(h).setStart(h,0).collapse(!0)}setTimeout(function(){s.select(!0)})}catch(p){}setTimeout(function(){s=i.selection.getRange(),s.scrollIntoView(),i.fireEvent("afterinserthtml")},200)}}},UM.commands.insertimage={execCommand:function(e,t){t=n.isArray(t)?t:[t];if(t.length){var r=[],i="",s;s=t[0];if(1==t.length)i='<img src="'+s.src+'" '+(s._src?' _src="'+s._src+'" ':"")+(s.width?'width="'+s.width+'" ':"")+(s.height?' height="'+s.height+'" ':"")+("left"==s.floatStyle||"right"==s.floatStyle?' style="float:'+s.floatStyle+';"':"")+(s.title&&""!=s.title?' title="'+s.title+'"':"")+(s.border&&"0"!=s.border?' border="'+s.border+'"':"")+(s.alt&&""!=s.alt?' alt="'+s.alt+'"':"")+(s.hspace&&"0"!=s.hspace?' hspace = "'+s.hspace+'"':"")+(s.vspace&&"0"!=s.vspace?' vspace = "'+s.vspace+'"':"")+"/>","center"==s.floatStyle&&(i='<p style="text-align: center">'+i+"</p>"),r.push(i);else for(var o=0;s=t[o++];)i="<p "+("center"==s.floatStyle?'style="text-align: center" ':"")+'><img src="'+s.src+'" '+(s.width?'width="'+s.width+'" ':"")+(s._src?' _src="'+s._src+'" ':"")+(s.height?' height="'+s.height+'" ':"")+' style="'+(s.floatStyle&&"center"!=s.floatStyle?"float:"+s.floatStyle+";":"")+(s.border||"")+'" '+(s.title?' title="'+s.title+'"':"")+" /></p>",r.push(i);this.execCommand("insertHtml",r.join(""),!0)}}},UM.plugins.justify=function(){var e=this;g.each(["justifyleft","justifyright","justifycenter","justifyfull"],function(t,n){e.commands[n]={execCommand:function(e){return this.document.execCommand(e)},queryCommandValue:function(e){var t=this.document.queryCommandValue(e);return!0===t||"true"===t?e.replace(/justify/,""):""},queryCommandState:function(e){return this.document.queryCommandState(e)?1:0}}})},UM.plugins.font=function(){var e=this,t={forecolor:"forecolor",backcolor:"backcolor",fontsize:"fontsize",fontfamily:"fontname"},r={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"},i={forecolor:"color",fontsize:"size",fontfamily:"face"};e.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"},{name:"sans-serif",val:"sans-serif"}],fontsize:[10,12,16,18,24,32,48]}),e.addOutputRule(function(e){n.each(e.getNodesByTagName("font"),function(e){if("font"==e.tagName){var t=[],n;for(n in e.attrs)switch(n){case"size":var r=e.attrs[n];g.each({10:"1",12:"2",16:"3",18:"4",24:"5",32:"6",48:"7"},function(e,t){if(t==r)return r=e,!1}),t.push("font-size:"+r+"px");break;case"color":t.push("color:"+e.attrs[n]);break;case"face":t.push("font-family:"+e.attrs[n]);break;case"style":t.push(e.attrs[n])}e.attrs={style:t.join(";")}}e.tagName="span","span"==e.parentNode.tagName&&1==e.parentNode.children.length&&(g.each(e.attrs,function(t,n){e.parentNode.attrs[t]="style"==t?e.parentNode.attrs[t]+n:n}),e.parentNode.removeChild(e,!0))})});for(var s in t)(function(s){e.commands[s]={execCommand:function(e,n){if("transparent"!=n){var i=this.selection.getRange();if(!i.collapsed){"fontsize"==e&&(n={10:"1",12:"2",16:"3",18:"4",24:"5",32:"6",48:"7"}[(n+"").replace(/px/,"")]),this.document.execCommand(t[e],!1,n),m.gecko&&g.each(this.$body.find("a"),function(e,t){var n=t.parentNode;if(n.lastChild===n.firstChild&&/FONT|SPAN/.test(n.tagName)){var r=n.cloneNode(!1);r.innerHTML=t.innerHTML,g(t).html("").append(r).insertBefore(n),g(n).remove()}});if(!m.ie){var s=this.selection.getNative().getRangeAt(0).commonAncestorContainer,i=this.selection.getRange(),o=i.createBookmark(!0);g(s).find("a").each(function(e,t){var n=t.parentNode;"FONT"==n.nodeName&&(n=n.cloneNode(!1),n.innerHTML=t.innerHTML,g(t).html("").append(n))}),i.moveToBookmark(o).select()}return!0}var s=g("<span></span>").css(r[e],n)[0];i.insertNode(s).setStart(s,0).setCursor()}},queryCommandValue:function(t){var s=e.selection.getStart(),o=g(s).css(r[t]);return void 0===o&&(o=g(s).attr(i[t])),o?n.fixColor(t,o).replace(/px/,""):""},queryCommandState:function(e){return this.queryCommandValue(e)}}})(s)},UM.plugins.link=function(){this.setOpt("autourldetectinie",!1),m.ie&&!1===this.options.autourldetectinie&&this.addListener("keyup",function(e,t){var n=t.keyCode;if(13==n||32==n){var r=this.selection.getRange().startContainer;13==n?"P"==r.nodeName&&(n=r.previousSibling)&&1==n.nodeType&&(n=n.lastChild)&&"A"==n.nodeName&&!n.getAttribute("_href")&&k.remove(n,!0):32==n&&3==r.nodeType&&/^\s$/.test(r.nodeValue)&&(r=r.previousSibling)&&"A"==r.nodeName&&!r.getAttribute("_href")&&k.remove(r,!0)}}),this.addOutputRule(function(e){g.each(e.getNodesByTagName("a"),function(e,t){var r=n.html(t.getAttr("_href"));/^(ftp|https?|\/|file)/.test(r)||(r="http://"+r),t.setAttr("href",r),t.setAttr("_href"),""==t.getAttr("title")&&t.setAttr("title")})}),this.addInputRule(function(e){g.each(e.getNodesByTagName("a"),function(e,t){t.setAttr("_href",n.html(t.getAttr("href")))})}),this.commands.link={execCommand:function(e,t){var r=this.selection.getRange();if(r.collapsed){var i=r.startContainer;(i=k.findParentByTagName(i,"a",!0))?(g(i).attr(t),r.selectNode(i).select()):r.insertNode(g("<a>"+t.href+"</a>").attr(t)[0]).select()}else this.document.execCommand("createlink",!1,"_umeditor_link"),n.each(k.getElementsByTagName(this.body,"a",function(e){return"_umeditor_link"==e.getAttribute("href")}),function(e){"_umeditor_link"==g(e).text()&&g(e).text(t.href),k.setAttributes(e,t),r.selectNode(e).select()})},queryCommandState:function(){return this.queryCommandValue("link")?1:0},queryCommandValue:function(){var e=this.selection.getStartElementPath(),t;return g.each(e,function(e,n){if("A"==n.nodeName)return t=n,!1}),t}},this.commands.unlink={execCommand:function(){this.document.execCommand("unlink")}}},UM.commands.print={execCommand:function(){var e="editor_print_"+ +(new Date);g('<iframe src="" id="'+e+'" name="'+e+'" frameborder="0"></iframe>').attr("id",e).css({width:"0px",height:"0px",overflow:"hidden","float":"left",position:"absolute",top:"-10000px",left:"-10000px"}).appendTo(this.$container.find(".edui-dialog-container"));var t=window.open("",e,"").document;t.open(),t.write("<html><head></head><body><div>"+this.getContent(null,null,!0)+"</div><script>setTimeout(function(){window.print();setTimeout(function(){window.parent.$('#"+e+"').remove();},100);},200);</script></body></html>"),t.close()},notNeedUndo:1},UM.plugins.paragraph=function(){this.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""}),this.commands.paragraph={execCommand:function(e,t){return this.document.execCommand("formatBlock",!1,"<"+t+">")},queryCommandValue:function(){try{var e=this.document.queryCommandValue("formatBlock")}catch(t){}return e}}},UM.plugins.horizontal=function(){var e=this;e.commands.horizontal={execCommand:function(){this.document.execCommand("insertHorizontalRule");var t=e.selection.getRange().txtToElmBoundary(!0),n=t.startContainer;if(k.isBody(t.startContainer))(n=t.startContainer.childNodes[t.startOffset])||(n=g("<p></p>").appendTo(t.startContainer).html(m.ie?"&nbsp;":"<br/>")[0]),t.setStart(n,0).setCursor();else{for(;q.$inline[n.tagName]&&n.lastChild===n.firstChild;){var r=n.parentNode;r.appendChild(n.firstChild),r.removeChild(n),n=r}for(;q.$inline[n.tagName];)n=n.parentNode;1==n.childNodes.length&&"HR"==n.lastChild.nodeName?(r=n.lastChild,g(r).insertBefore(n),t.setStart(n,0).setCursor()):(r=g("hr",n)[0],k.breakParent(r,n),(n=r.previousSibling)&&k.isEmptyBlock(n)&&g(n).remove(),t.setStart(r.nextSibling,0).setCursor())}}}},UM.commands.cleardoc={execCommand:function(){var e=this,t=e.selection.getRange();e.body.innerHTML="<p>"+(E?"":"<br/>")+"</p>",t.setStart(e.body.firstChild,0).setCursor(!1,!0),setTimeout(function(){e.fireEvent("clearDoc")},0)}},UM.plugins.undo=function(){function e(e,t){if(e.length!=t.length)return 0;for(var n=0,r=e.length;n<r;n++)if(e[n]!=t[n])return 0;return 1}function t(){this.undoManger.save()}var r,i=this.options.maxUndoCount||20,s=this.options.maxInputCount||20,o=RegExp(k.fillChar+"|</hr>","gi"),u={ol:1,ul:1,table:1,tbody:1,tr:1,body:1},a=this.options.autoClearEmptyNode;this.undoManger=new function(){this.list=[],this.index=0,this.hasRedo=this.hasUndo=!1,this.undo=function(){if(this.hasUndo)if(this.list[this.index-1]||1!=this.list.length){for(;this.list[this.index].content==this.list[this.index-1].content;)if(this.index--,0==this.index)return this.restore(0);this.restore(--this.index)}else this.reset()},this.redo=function(){if(this.hasRedo){for(;this.list[this.index].content==this.list[this.index+1].content;)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}},this.restore=function(){var e=this.editor,t=this.list[this.index],r=UM.htmlparser(t.content.replace(o,""));e.options.autoClearEmptyNode=!1,e.filterInputRule(r,!0),e.options.autoClearEmptyNode=a,e.body.innerHTML=r.toHtml(),e.fireEvent("afterscencerestore"),m.ie&&n.each(k.getElementsByTagName(e.document,"td th caption p"),function(t){k.isEmptyNode(t)&&k.fillNode(e.document,t)});try{var i=(new B.Range(e.document,e.body)).moveToAddress(t.address);if(m.ie&&i.collapsed&&1==i.startContainer.nodeType){var s=i.startContainer.childNodes[i.startOffset];(!s||1==s.nodeType&&q.$empty[s])&&i.insertNode(e.document.createTextNode(" ")).collapse(!0)}i.select(u[i.startContainer.nodeName.toLowerCase()])}catch(f){}this.update(),this.clearKey(),e.fireEvent("reset",!0)},this.getScene=function(){var e=this.editor,t=e.selection.getRange().createAddress(!1,!0);e.fireEvent("beforegetscene");var n=UM.htmlparser(e.body.innerHTML,!0);return e.options.autoClearEmptyNode=!1,e.filterOutputRule(n,!0),e.options.autoClearEmptyNode=a,n=n.toHtml(),m.ie&&(n=n.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">")),e.fireEvent("aftergetscene"),{address:t,content:n}},this.save=function(t,n){clearTimeout(r);var s=this.getScene(n),o=this.list[this.index],u;if(u=o)if(u=o.content==s.content)t?o=1:(o=o.address,u=s.address,o=o.collapsed!=u.collapsed?0:e(o.startAddress,u.startAddress)&&e(o.endAddress,u.endAddress)?1:0),u=o;u||(this.list=this.list.slice(0,this.index+1),this.list.push(s),this.list.length>i&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update())},this.update=function(){this.hasRedo=!!this.list[this.index+1],this.hasUndo=!!this.list[this.index-1]},this.reset=function(){this.list=[],this.index=0,this.hasRedo=this.hasUndo=!1,this.clearKey()},this.clearKey=function(){l=0}},this.undoManger.editor=this,this.addListener("saveScene",function(){var e=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,e)}),this.addListener("beforeexeccommand",t),this.addListener("afterexeccommand",t),this.addListener("reset",function(e,t){t||this.undoManger.reset()}),this.commands.redo=this.commands.undo={execCommand:function(e){this.undoManger[e]()},queryCommandState:function(e){return this.undoManger["has"+("undo"==e.toLowerCase()?"Undo":"Redo")]?0:-1},notNeedUndo:1};var f={16:1,17:1,18:1,37:1,38:1,39:1,40:1},l=0,c=!1;this.addListener("ready",function(){g(this.body).on("compositionstart",function(){c=!0}).on("compositionend",function(){c=!1})}),this.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89,shift+ctrl+z"});var h=!0;this.addListener("keydown",function(e,t){var n=this;if(!(f[t.keyCode||t.which]||t.ctrlKey||t.metaKey||t.shiftKey||t.altKey||c))if(n.selection.getRange().collapsed){0==n.undoManger.list.length&&n.undoManger.save(!0),clearTimeout(r);var i=function(e){e.selection.getRange().collapsed&&e.fireEvent("contentchange"),e.undoManger.save(!1,!0),e.fireEvent("selectionchange")};r=setTimeout(function(){if(c)var e=setInterval(function(){c||(i(n),clearInterval(e))},300);else i(n)},200),l++,l>=s&&i(n)}else n.undoManger.save(!1,!0),h=!1}),this.addListener("keyup",function(e,t){f[t.keyCode||t.which]||t.ctrlKey||t.metaKey||t.shiftKey||t.altKey||c||h||(this.undoManger.save(!1,!0),h=!0)})},UM.plugins.paste=function(){function e(e){var t=this.document;if(!t.getElementById("baidu_pastebin")){var n=this.selection.getRange(),r=n.createBookmark(),i=t.createElement("div");i.id="baidu_pastebin",m.webkit&&i.appendChild(t.createTextNode(k.fillChar+k.fillChar)),this.body.appendChild(i),r.start.style.display="",i.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+g(r.start).position().top+"px",n.selectNodeContents(i).select(!0),setTimeout(function(){if(m.webkit)for(var s=0,o=t.querySelectorAll("#baidu_pastebin"),u;u=o[s++];){if(!k.isEmptyNode(u)){i=u;break}k.remove(u)}try{i.parentNode.removeChild(i)}catch(f){}n.moveToBookmark(r).select(!0),e(i)},0)}}function t(e){var t;if(e.firstChild){var i=k.getElementsByTagName(e,"span");t=0;for(var s;s=i[t++];)"_baidu_cut_start"!=s.id&&"_baidu_cut_end"!=s.id||k.remove(s);if(m.webkit){s=e.querySelectorAll("div br");for(t=0;i=s[t++];)i=i.parentNode,"DIV"==i.tagName&&1==i.childNodes.length&&(i.innerHTML="<p><br/></p>",k.remove(i));i=e.querySelectorAll("#baidu_pastebin");for(t=0;s=i[t++];){var o=r.document.createElement("p");for(s.parentNode.insertBefore(o,s);s.firstChild;)o.appendChild(s.firstChild);k.remove(s)}s=e.querySelectorAll("meta");for(t=0;i=s[t++];)k.remove(i);s=e.querySelectorAll("br");for(t=0;i=s[t++];)/^apple-/i.test(i.className)&&k.remove(i)}if(m.gecko)for(s=e.querySelectorAll("[_moz_dirty]"),t=0;i=s[t++];)i.removeAttribute("_moz_dirty");if(!m.ie)for(s=e.querySelectorAll("span.Apple-style-span"),t=0;i=s[t++];)k.remove(i,!0);t=e.innerHTML,t=UM.filterWord(t),e=UM.htmlparser(t),r.options.filterRules&&UM.filterNode(e,r.options.filterRules),r.filterInputRule(e),m.webkit&&((t=e.lastChild())&&"element"==t.type&&"br"==t.tagName&&e.removeChild(t),n.each(r.body.querySelectorAll("div"),function(e){k.isEmptyBlock(e)&&k.remove(e)})),t={html:e.toHtml()},r.fireEvent("beforepaste",t,e),t.html&&(r.execCommand("insertHtml",t.html,!0),r.fireEvent("afterpaste",t))}}var r=this;r.addListener("ready",function(){g(r.body).on("cut",function(){!r.selection.getRange().collapsed&&r.undoManger&&r.undoManger.save()}).on(m.ie||m.opera?"keydown":"paste",function(n){(!m.ie&&!m.opera||(n.ctrlKey||n.metaKey)&&"86"==n.keyCode)&&e.call(r,function(e){t(e)})})})},UM.plugins.list=function(){this.setOpt({insertorderedlist:{decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:""}}),this.addInputRule(function(e){n.each(e.getNodesByTagName("li"),function(e){0==e.children.length&&e.parentNode.removeChild(e)})}),this.commands.insertorderedlist=this.commands.insertunorderedlist={execCommand:function(e){this.document.execCommand(e),e=this.selection.getRange();var t=e.createBookmark(!0);return this.$body.find("ol,ul").each(function(e,t){var n=t.parentNode;"P"==n.tagName&&n.lastChild===n.firstChild&&(g(t).children().each(function(e,t){var r=n.cloneNode(!1);g(r).append(t.innerHTML),g(t).html("").append(r)}),g(t).insertBefore(n),g(n).remove()),q.$inline[n.tagName]&&("SPAN"==n.tagName&&g(t).children().each(function(e,t){var r=n.cloneNode(!1);if("P"!=t.firstChild.nodeName){for(;t.firstChild;)r.appendChild(t.firstChild);g("<p></p>").appendTo(t).append(r)}else{for(;t.firstChild;)r.appendChild(t.firstChild);g(t.firstChild).append(r)}}),k.remove(n,!0))}),e.moveToBookmark(t).select(),!0},queryCommandState:function(e){return this.document.queryCommandState(e)}}},function(){var e={textarea:function(e,t){var n=t.ownerDocument.createElement("textarea");return n.style.cssText="resize:none;border:0;padding:0;margin:0;overflow-y:auto;outline:0",m.ie&&8>m.version&&(n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px",t.onresize=function(){n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px"}),t.appendChild(n),{container:n,setContent:function(e){n.value=e},getContent:function(){return n.value},select:function(){var e;m.ie?(e=n.createTextRange(),e.collapse(!0),e.select()):(n.setSelectionRange(0,0),n.focus())},dispose:function(){t.removeChild(n),t=n=t.onresize=null}}}};UM.plugins.source=function(){var t=this,n=!1,r;this.options.sourceEditor="textarea",t.setOpt({sourceEditorFirst:!1});var i=t.getContent,s;t.commands.source={execCommand:function(){if(n=!n){s=t.selection.getRange().createAddress(!1,!0),t.undoManger&&t.undoManger.save(!0),m.gecko&&(t.body.contentEditable=!1),t.body.style.cssText+=";position:absolute;left:-32768px;top:-32768px;",t.fireEvent("beforegetcontent");var o=UM.htmlparser(t.body.innerHTML);t.filterOutputRule(o),o.traversal(function(e){if("element"==e.type)switch(e.tagName){case"td":case"th":case"caption":e.children&&1==e.children.length&&"br"==e.firstChild().tagName&&e.removeChild(e.firstChild());break;case"pre":e.innerText(e.innerText().replace(/&nbsp;/g," "))}}),t.fireEvent("aftergetcontent"),o=o.toHtml(!0),r=e.textarea(t,t.body.parentNode),r.setContent(o),g(r.container).width(g(t.body).width()+parseInt(g(t.body).css("padding-left"))+parseInt(g(t.body).css("padding-right"))).height(g(t.body).height()),setTimeout(function(){r.select()}),t.getContent=function(){return r.getContent()||"<p>"+(m.ie?"":"<br/>")+"</p>"}}else{t.$body.css({position:"",left:"",top:""}),o=r.getContent()||"<p>"+(m.ie?"":"<br/>")+"</p>",o=o.replace(RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(e,t){return t&&!q.$inlineWithA[t.toLowerCase()]?e.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,""):e.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")}),t.setContent(o),r.dispose(),r=null,t.getContent=i,t.body.firstChild||(t.body.innerHTML="<p>"+(m.ie?"":"<br/>")+"</p>"),t.undoManger&&t.undoManger.save(!0),m.gecko&&(t.body.contentEditable=!0);try{t.selection.getRange().moveToAddress(s).select()}catch(u){}}this.fireEvent("sourcemodechanged",n)},queryCommandState:function(){return n|0},notNeedUndo:1};var o=t.queryCommandState;t.queryCommandState=function(e){return e=e.toLowerCase(),n?e in{source:1,fullscreen:1}?o.apply(this,arguments):-1:o.apply(this,arguments)}}}(),UM.plugins.enterkey=function(){var e,t=this,n=t.options.enterTag;t.addListener("keyup",function(n,r){if(13==(r.keyCode||r.which)){var i=t.selection.getRange(),s=i.startContainer,o;if(m.ie)t.fireEvent("saveScene",!0,!0);else{if(/h\d/i.test(e)){if(m.gecko)k.findParentByTagName(s,"h1 h2 h3 h4 h5 h6 blockquote caption table".split(" "),!0)||(t.document.execCommand("formatBlock",!1,"<p>"),o=1);else if(1==s.nodeType){var s=t.document.createTextNode(""),u;i.insertNode(s);if(u=k.findParentByTagName(s,"div",!0)){for(o=t.document.createElement("p");u.firstChild;)o.appendChild(u.firstChild);u.parentNode.insertBefore(o,u),k.remove(u),i.setStartBefore(s).setCursor(),o=1}k.remove(s)}t.undoManger&&o&&t.undoManger.save()}m.opera&&i.select()}}}),t.addListener("keydown",function(r,i){if(13==(i.keyCode||i.which))if(t.fireEvent("beforeenterkeydown"))k.preventDefault(i);else{t.fireEvent("saveScene",!0,!0),e="";var s=t.selection.getRange();if(!s.collapsed){var o=s.startContainer,u=s.endContainer,o=k.findParentByTagName(o,"td",!0),u=k.findParentByTagName(u,"td",!0);if(o&&u&&o!==u||!o&&u||o&&!u){i.preventDefault?i.preventDefault():i.returnValue=!1;return}}"p"!=n||m.ie||((o=k.findParentByTagName(s.startContainer,"ol ul p h1 h2 h3 h4 h5 h6 blockquote caption".split(" "),!0))||m.opera?(e=o.tagName,"p"==o.tagName.toLowerCase()&&m.gecko&&k.removeDirtyAttr(o)):(t.document.execCommand("formatBlock",!1,"<p>"),m.gecko&&(s=t.selection.getRange(),(o=k.findParentByTagName(s.startContainer,"p",!0))&&k.removeDirtyAttr(o))))}}),m.ie&&t.addListener("setDisabled",function(){g(t.body).find("p").each(function(e,t){k.isEmptyBlock(t)&&(t.innerHTML="&nbsp;")})})},UM.commands.preview={execCommand:function(){var e=window.open("","_blank","").document,t=this.getContent(null,null,!0),n=this.getOpt("UMEDITOR_HOME_URL"),n=-1!=t.indexOf("mathquill-embedded-latex")?'<link rel="stylesheet" href="'+n+'third-party/mathquill/mathquill.css"/><script src="'+n+'third-party/jquery.min.js"></script><script src="'+n+'third-party/mathquill/mathquill.min.js"></script>':"";e.open(),e.write("<html><head>"+n+"</head><body><div>"+t+"</div></body></html>"),e.close()},notNeedUndo:1},UM.plugins.basestyle=function(){var e=this;e.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+shift+85",strikeThrough:"ctrl+shift+83"}),e.addOutputRule(function(e){g.each(e.getNodesByTagName("b i u strike s"),function(e,t){switch(t.tagName){case"b":t.tagName="strong";break;case"i":t.tagName="em";break;case"u":t.tagName="span",t.setStyle("text-decoration","underline");break;case"s":case"strike":t.tagName="span",t.setStyle("text-decoration","line-through")}})}),g.each("bold underline superscript subscript italic strikethrough".split(" "),function(t,n){e.commands[n]={execCommand:function(e){var t=this.selection.getRange();return t.collapsed&&1!=this.queryCommandState(e)?(e=this.document.createElement({bold:"strong",underline:"u",superscript:"sup",subscript:"sub",italic:"em",strikethrough:"strike"}[e]),t.insertNode(e).setStart(e,0).setCursor(!1),!0):this.document.execCommand(e)},queryCommandState:function(e){if(m.gecko)return this.document.queryCommandState(e);var t=this.selection.getStartElementPath(),n=!1;return g.each(t,function(t,r){switch(e){case"bold":if("STRONG"==r.nodeName||"B"==r.nodeName)return n=1,!1;break;case"underline":if("U"==r.nodeName||"SPAN"==r.nodeName&&"underline"==g(r).css("text-decoration"))return n=1,!1;break;case"superscript":if("SUP"==r.nodeName)return n=1,!1;break;case"subscript":if("SUB"==r.nodeName)return n=1,!1;break;case"italic":if("EM"==r.nodeName||"I"==r.nodeName)return n=1,!1;break;case"strikethrough":if("S"==r.nodeName||"STRIKE"==r.nodeName||"SPAN"==r.nodeName&&"line-through"==g(r).css("text-decoration"))return n=1,!1}}),n}}})},UM.plugins.video=function(){function e(e,t,n,i,s,o){return o?'<embed type="application/x-shockwave-flash" class="edui-faked-video" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+e+'" width="'+t+'" height="'+n+'"'+(s?' style="float:'+s+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >':"<img "+(i?'id="'+i+'"':"")+' width="'+t+'" height="'+n+'" _url="'+e+'" class="edui-faked-video" src="'+r.options.UMEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+r.options.UMEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(s?"float:"+s+";":"")+'" />'}function t(t,r){n.each(t.getNodesByTagName(r?"img":"embed"),function(t){if("edui-faked-video"==t.getAttr("class")){var n=e(r?t.getAttr("_url"):t.getAttr("src"),t.getAttr("width"),t.getAttr("height"),null,t.getStyle("float")||"",r);t.parentNode.replaceChild(UM.uNode.createElement(n),t)}})}var r=this;r.addOutputRule(function(e){t(e,!0)}),r.addInputRule(function(e){t(e)}),r.commands.insertvideo={execCommand:function(t,i){i=n.isArray(i)?i:[i];for(var s=[],o=0,u,f=i.length;o<f;o++)u=i[o],s.push(e(u.url,u.width||420,u.height||280,"tmpVedio"+o,u.align,!1));r.execCommand("inserthtml",s.join(""),!0)},queryCommandState:function(){var e=r.selection.getRange().getClosedNode();return e&&"edui-faked-video"==e.className?1:0}}},UM.plugins.selectall=function(){this.commands.selectall={execCommand:function(){var e=this.body,t=this.selection.getRange();t.selectNodeContents(e),k.isEmptyBlock(e)&&(m.opera&&e.firstChild&&1==e.firstChild.nodeType&&t.setStartAtFirst(e.firstChild),t.collapse(!0)),t.select(!0)},notNeedUndo:1},this.addshortcutkey({selectAll:"ctrl+65"})},UM.plugins.removeformat=function(){this.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"}),this.commands.removeformat={execCommand:function(e,t,n,r,i){function s(e){if(3==e.nodeType||"span"!=e.tagName.toLowerCase())return 0;if(m.ie){var t=e.attributes;if(t.length){e=0;for(var n=t.length;e<n;e++)if(t[e].specified)return 0;return 1}}return!e.attributes.length}function o(e){var t=e.createBookmark();e.collapsed&&e.enlarge(!0);if(!i){var r=k.findParentByTagName(e.startContainer,"a",!0);r&&e.setStartBefore(r),(r=k.findParentByTagName(e.endContainer,"a",!0))&&e.setEndAfter(r)}f=e.createBookmark();for(r=f.start;(l=r.parentNode)&&!k.isBlockElm(l);)k.breakParent(r,l),k.clearEmptySibling(r);if(f.end){for(r=f.end;(l=r.parentNode)&&!k.isBlockElm(l);)k.breakParent(r,l),k.clearEmptySibling(r);for(var r=k.getNextDomNode(f.start,!1,c),o;r&&r!=f.end;)o=k.getNextDomNode(r,!0,c),q.$empty[r.tagName.toLowerCase()]||k.isBookmarkNode(r)||(u.test(r.tagName)?n?(k.removeStyle(r,n),s(r)&&"text-decoration"!=n&&k.remove(r,!0)):k.remove(r,!0):q.$tableContent[r.tagName]||q.$list[r.tagName]||(k.removeAttributes(r,a),s(r)&&k.remove(r,!0))),r=o}r=f.start.parentNode,!k.isBlockElm(r)||q.$tableContent[r.tagName]||q.$list[r.tagName]||k.removeAttributes(r,a),r=f.end.parentNode,f.end&&k.isBlockElm(r)&&!q.$tableContent[r.tagName]&&!q.$list[r.tagName]&&k.removeAttributes(r,a),e.moveToBookmark(f).moveToBookmark(t),r=e.startContainer;for(o=e.collapsed;1==r.nodeType&&k.isEmptyNode(r)&&q.$removeEmpty[r.tagName];)t=r.parentNode,e.setStartBefore(r),e.startContainer===e.endContainer&&e.endOffset--,k.remove(r),r=t;if(!o)for(r=e.endContainer;1==r.nodeType&&k.isEmptyNode(r)&&q.$removeEmpty[r.tagName];)t=r.parentNode,e.setEndBefore(r),k.remove(r),r=t}var u=RegExp("^(?:"+(t||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),a=n?[]:(r||this.options.removeFormatAttributes).split(",");e=new B.Range(this.document);var f,l,c=function(e){return 1==e.nodeType};e=this.selection.getRange(),e.collapsed||(o(e),e.select())}}},UM.plugins.keystrokes=function(){var e=this,t=!0;e.addListener("keydown",function(n,r){var i=r.keyCode||r.which,s=e.selection.getRange();if(!(s.collapsed||r.ctrlKey||r.shiftKey||r.altKey||r.metaKey)&&(65<=i&&90>=i||48<=i&&57>=i||96<=i&&111>=i||{13:1,8:1,46:1}[i])){var o=s.startContainer;k.isFillChar(o)&&s.setStartBefore(o),o=s.endContainer,k.isFillChar(o)&&s.setEndAfter(o),s.txtToElmBoundary(),s.endContainer&&1==s.endContainer.nodeType&&(o=s.endContainer.childNodes[s.endOffset])&&k.isBr(o)&&s.setEndAfter(o);if(0==s.startOffset&&(o=s.startContainer,k.isBoundaryNode(o,"firstChild")&&(o=s.endContainer,s.endOffset==(3==o.nodeType?o.nodeValue.length:o.childNodes.length)&&k.isBoundaryNode(o,"lastChild")))){e.fireEvent("saveScene"),e.body.innerHTML="<p>"+(m.ie?"":"<br/>")+"</p>",s.setStart(e.body.firstChild,0).setCursor(!1,!0),e._selectionChange();return}}if(8==i){s=e.selection.getRange(),t=s.collapsed;if(e.fireEvent("delkeydown",r))return;var u;s.collapsed&&s.inFillChar()&&(o=s.startContainer,k.isFillChar(o)?(s.setStartBefore(o).shrinkBoundary(!0).collapse(!0),k.remove(o)):(o.nodeValue=o.nodeValue.replace(RegExp("^"+k.fillChar),""),s.startOffset--,s.collapse(!0).select(!0)));if(o=s.getClosedNode()){e.fireEvent("saveScene"),s.setStartBefore(o),k.remove(o),s.setCursor(),e.fireEvent("saveScene"),k.preventDefault(r);return}if(!m.ie&&(o=k.findParentByTagName(s.startContainer,"table",!0),u=k.findParentByTagName(s.endContainer,"table",!0),o&&!u||!o&&u||o!==u)){r.preventDefault();return}o=s.startContainer,s.collapsed&&1==o.nodeType&&(o=o.childNodes[s.startOffset-1])&&1==o.nodeType&&"BR"==o.tagName&&(e.fireEvent("saveScene"),s.setStartBefore(o).collapse(!0),k.remove(o),s.select(),e.fireEvent("saveScene"));if(m.chrome&&s.collapsed){for(;0==s.startOffset&&!k.isEmptyBlock(s.startContainer);)s.setStartBefore(s.startContainer);(o=s.startContainer.childNodes[s.startOffset-1])&&"BR"==o.nodeName&&(s.setStartBefore(o),e.fireEvent("saveScene"),g(o).remove(),s.setCursor(),e.fireEvent("saveScene"))}}if(m.gecko&&46==i&&(i=e.selection.getRange(),i.collapsed&&(o=i.startContainer,k.isEmptyBlock(o)))){for(i=o.parentNode;1==k.getChildCount(i)&&!k.isBody(i);)o=i,i=i.parentNode;o===i.lastChild&&r.preventDefault()}}),e.addListener("keyup",function(e,n){var r;if(8==(n.keyCode||n.which)&&!this.fireEvent("delkeyup")){r=this.selection.getRange();if(r.collapsed){var i;if((i=k.findParentByTagName(r.startContainer,"h1 h2 h3 h4 h5 h6".split(" "),!0))&&k.isEmptyBlock(i)){var s=i.previousSibling;if(s&&"TABLE"!=s.nodeName){k.remove(i),r.setStartAtLast(s).setCursor(!1,!0);return}if((s=i.nextSibling)&&"TABLE"!=s.nodeName){k.remove(i),r.setStartAtFirst(s).setCursor(!1,!0);return}}k.isBody(r.startContainer)&&(i=k.createElement(this.document,"p",{innerHTML:m.ie?k.fillChar:"<br/>"}),r.insertNode(i).setStart(i,0).setCursor(!1,!0))}!t&&(3==r.startContainer.nodeType||1==r.startContainer.nodeType&&k.isEmptyBlock(r.startContainer))&&(m.ie?(i=r.document.createElement("span"),r.insertNode(i).setStartBefore(i).collapse(!0),r.select(),k.remove(i)):r.select())}})},UM.plugins.autosave=function(){function e(e){var o=null;new Date-n<r||(e.hasContents()?(n=new Date,e._saveFlag=null,o=t.body.innerHTML,!1!==e.fireEvent("beforeautosave",{content:o})&&(s.saveLocalData(i,o),e.fireEvent("afterautosave",{content:o}))):i&&s.removeItem(i))}var t=this,n=new Date,r=20,i=null;t.setOpt("saveInterval",500);var s=UM.LocalStorage=function(){function e(){var e=document.createElement("div");return e.style.display="none",e.addBehavior?(e.addBehavior("#default#userdata"),{getItem:function(t){var r=null;try{document.body.appendChild(e),e.load(n),r=e.getAttribute(t),document.body.removeChild(e)}catch(i){}return r},setItem:function(t,r){document.body.appendChild(e),e.setAttribute(t,r),e.save(n),document.body.removeChild(e)},removeItem:function(t){document.body.appendChild(e),e.removeAttribute(t),e.save(n),document.body.removeChild(e)}}):null}var t=window.localStorage||e()||null,n="localStorage";return{saveLocalData:function(e,n){return t&&n?(t.setItem(e,n),!0):!1},getLocalData:function(e){return t?t.getItem(e):null},removeItem:function(e){t&&t.removeItem(e)}}}();t.addListener("ready",function(){var e=null,e=t.key?t.key+"-drafts-data":(t.container.parentNode.id||"ue-common")+"-drafts-data";i=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+e}),t.addListener("contentchange",function(){i&&(t._saveFlag&&window.clearTimeout(t._saveFlag),0<t.options.saveInterval?t._saveFlag=window.setTimeout(function(){e(t)},t.options.saveInterval):e(t))}),t.commands.clearlocaldata={execCommand:function(e,t){i&&s.getLocalData(i)&&s.removeItem(i)},notNeedUndo:!0,ignoreContentChange:!0},t.commands.getlocaldata={execCommand:function(e,t){return i?s.getLocalData(i)||"":""},notNeedUndo:!0,ignoreContentChange:!0},t.commands.drafts={execCommand:function(e,n){i&&(t.body.innerHTML=s.getLocalData(i)||"<p>"+(m.ie?"&nbsp;":"<br/>")+"</p>",t.focus(!0))},queryCommandState:function(){return i?null===s.getLocalData(i)?-1:0:-1},notNeedUndo:!0,ignoreContentChange:!0}},UM.plugins.autoupload=function(){var a=this;a.setOpt("pasteImageEnabled",!0),a.setOpt("dropFileEnabled",!0);var b=function(b,d){var e=new FormData;e.append(d.options.imageFieldName||"upfile",b,b.name||"blob."+b.type.substr(6)),e.append("type","ajax");var f=new XMLHttpRequest;f.open("post",a.options.imageUrl,!0),f.setRequestHeader("X-Requested-With","XMLHttpRequest"),f.addEventListener("load",function(b){try{var c=eval("("+b.target.response+")").url,e=a.options.imagePath+c;d.execCommand("insertimage",{src:e,_src:e})}catch(f){}}),f.send(e)};a.addListener("ready",function(){if(window.FormData&&window.FileReader){var e=function(e){var t=!1;"paste"==e.type?(e=e.originalEvent,e=e.clipboardData&&e.clipboardData.items&&1==e.clipboardData.items.length&&/^image\//.test(e.clipboardData.items[0].type)?e.clipboardData.items:null):(e=e.originalEvent,e=e.dataTransfer&&e.dataTransfer.files?e.dataTransfer.files:null);if(e){for(var n=e.length,r;n--;)r=e[n],r.getAsFile&&(r=r.getAsFile()),r&&0<r.size&&/image\/\w+/i.test(r.type)&&(b(r,a),t=!0);if(t)return!1}};a.getOpt("pasteImageEnabled")&&a.$body.on("paste",e),a.getOpt("dropFileEnabled")&&a.$body.on("drop",e),a.$body.on("dragover",function(e){if("Files"==e.originalEvent.dataTransfer.types[0])return!1})}})},UM.plugins.formula=function(){function e(){return r.$body.find("iframe.edui-formula-active")[0]||null}function t(){var t=e();t&&t.contentWindow.formula.blur()}var r=this;r.addInputRule(function(e){g.each(e.getNodesByTagName("span"),function(e,t){if(t.hasClass("mathquill-embedded-latex")){for(var i,s="";i=t.firstChild();)s+=i.data,t.removeChild(i);t.tagName="iframe",t.setAttr({frameborder:"0",src:r.getOpt("UMEDITOR_HOME_URL")+"dialogs/formula/formula.html","data-latex":n.unhtml(s)})}})}),r.addOutputRule(function(e){g.each(e.getNodesByTagName("iframe"),function(e,t){t.hasClass("mathquill-embedded-latex")&&(t.tagName="span",t.appendChild(UM.uNode.createText(t.getAttr("data-latex"))),t.setAttr({frameborder:"",src:"","data-latex":""}))})}),r.addListener("click",function(){t()}),r.addListener("afterexeccommand",function(e,n){"formula"!=n&&t()}),r.commands.formula={execCommand:function(t,n){var i=e();i?i.contentWindow.formula.insertLatex(n):(r.execCommand("inserthtml",'<span class="mathquill-embedded-latex">'+n+"</span>"),m.ie&&m.ie9below&&setTimeout(function(){var e=r.selection.getRange(),t=e.startContainer;1!=t.nodeType||t.childNodes[e.startOffset]||(e.insertNode(r.document.createTextNode(" ")),e.setCursor())},100))},queryCommandState:function(e){return 0},queryCommandValue:function(t){return(t=e())&&t.contentWindow.formula.getLatex()}}},function(e){function t(t,n,r){return t.prototype=e.extend2(e.extend({},n),(UM.ui[r]||i).prototype,!0),t.prototype.supper=(UM.ui[r]||i).prototype,UM.ui[r]&&UM.ui[r].prototype.defaultOpt&&(t.prototype.defaultOpt=e.extend({},UM.ui[r].prototype.defaultOpt,t.prototype.defaultOpt||{})),t}function n(t,n){e[s+n]=t,e.fn[s+n]=function(n){var r,i=Array.prototype.slice.call(arguments,1);return this.each(function(s,o){var u=e(o),f=u.edui();f||(t(n&&e.isPlainObject(n)?n:{},u),u.edui(f));if("string"==e.type(n))if("this"==n)r=f;else{r=f[n].apply(f,i);if(r!==f&&void 0!==r)return!1;r=null}}),null!==r?r:this}}e.parseTmpl=function(e,t){var n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(e,t){return"',"+t.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(e,t){return"');"+t.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",n=new Function("obj",n);return t?n(t):n},e.extend2=function(t,n){for(var r=arguments,i="boolean"==e.type(r[r.length-1])?r[r.length-1]:!1,s="boolean"==e.type(r[r.length-1])?r.length-1:r.length,o=1;o<s;o++){var u=r[o],f;for(f in u)i&&t.hasOwnProperty(f)||(t[f]=u[f])}return t},e.IE6=!!window.ActiveXObject&&6==parseFloat(navigator.userAgent.match(/msie (\d+)/i)[1]);var r=[],i=function(){},s="edui";i.prototype={on:function(t,n){return this.root().on(t,e.proxy(n,this)),this},off:function(t,n){return this.root().off(t,e.proxy(n,this)),this},trigger:function(e,t){return!1===this.root().trigger(e,t)?!1:this},root:function(e){return this._$el||(this._$el=e)},destroy:function(){},data:function(e,t){return void 0!==t?(this.root().data(s+e,t),this):this.root().data(s+e)},register:function(t,n,i){r.push({evtname:t,$els:e.isArray(n)?n:[n],handler:e.proxy(i,n)})}},e.fn.edui=function(e){return e?this.data("eduiwidget",e):this.data("eduiwidget")};var o=1;UM.ui={define:function(r,i,u){var l=UM.ui[r]=t(function(t,n){var i=function(){};e.extend(i.prototype,l.prototype,{guid:r+o++,widgetName:r}),i=new i;if("string"==e.type(t))return i.init&&i.init({}),i.root().edui(i),i.root().find("a").click(function(e){e.preventDefault()}),i.root()[s+r].apply(i.root(),arguments);n&&i.root(n),i.init&&i.init(!t||e.isPlainObject(t)?e.extend2(t||{},i.defaultOpt||{},!0):t);try{i.root().find("a").click(function(e){e.preventDefault()})}catch(u){}return i.root().edui(i)},i,u);n(l,r)}},e(function(){e(document).on("click mouseup mousedown dblclick mouseover",function(t){e.each(r,function(n,r){r.evtname==t.type&&e.each(r.$els,function(n,i){i[0]===t.target||e.contains(i[0],t.target)||r.handler(t)})})})})}(jQuery),UM.ui.define("button",{tpl:'<<%if(!texttype){%>div class="edui-btn edui-btn-<%=icon%> <%if(name){%>edui-btn-name-<%=name%><%}%>" unselectable="on" onmousedown="return false" <%}else{%>a class="edui-text-btn"<%}%><% if(title) {%> data-original-title="<%=title%>" <%};%>> <% if(icon) {%><div unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><% }; %><%if(text) {%><span unselectable="on" onmousedown="return false" class="edui-button-label"><%=text%></span><%}%><%if(caret && text){%><span class="edui-button-spacing"></span><%}%><% if(caret) {%><span unselectable="on" onmousedown="return false" class="edui-caret"></span><% };%></<%if(!texttype){%>div<%}else{%>a<%}%>>',defaultOpt:{text:"",title:"",icon:"",width:"",caret:!1,texttype:!1,click:function(){}},init:function(e){var t=this;return t.root(g(g.parseTmpl(t.tpl,e))).click(function(n){t.wrapclick(e.click,n)}),t.root().hover(function(){t.root().hasClass("edui-disabled")||t.root().toggleClass("edui-hover")}),t},wrapclick:function(e,t){return this.disabled()||(this.root().trigger("wrapclick"),g.proxy(e,this,t)()),this},label:function(e){return void 0===e?this.root().find(".edui-button-label").text():(this.root().find(".edui-button-label").text(e),this)},disabled:function(e){return void 0===e?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",e),this.root().hasClass("edui-disabled")&&this.root().removeClass("edui-hover"),this)},active:function(e){return void 0===e?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",e),this)},mergeWith:function(e){var t=this;t.data("$mergeObj",e),e.edui().data("$mergeObj",t.root()),g.contains(document.body,e[0])||e.appendTo(t.root()),t.on("click",function(){t.wrapclick(function(){e.edui().show()})}).register("click",t.root(),function(t){e.hide()})}}),function(){UM.ui.define("toolbar",{tpl:'<div class="edui-toolbar"  ><div class="edui-btn-toolbar" unselectable="on" onmousedown="return false"  ></div></div>',init:function(){var e=this.root(g(this.tpl));this.data("$btnToolbar",e.find(".edui-btn-toolbar"))},appendToBtnmenu:function(e){var t=this.data("$btnToolbar");e=g.isArray(e)?e:[e],g.each(e,function(e,n){t.append(n)})}})}(),UM.ui.define("menu",{show:function(e,t,n,r,i){n=n||"position",!1!==this.trigger("beforeshow")&&(this.root().css(g.extend({display:"block"},e?{top:e[n]().top+("right"==t?0:e.outerHeight())-(r||0),left:e[n]().left+("right"==t?e.outerWidth():0)-(i||0)}:{})),this.trigger("aftershow"))},hide:function(e){var t;!1!==this.trigger("beforehide")&&((t=this.root().data("parentmenu"))&&(t.data("parentmenu")||e)&&t.edui().hide(),this.root().css("display","none"),this.trigger("afterhide"))},attachTo:function(e){var t=this;e.data("$mergeObj")||(e.data("$mergeObj",t.root()),e.on("wrapclick",function(e){t.show()}),t.register("click",e,function(e){t.hide()}),t.data("$mergeObj",e))}}),UM.ui.define("dropmenu",{tmpl:'<ul class="edui-dropdown-menu" aria-labelledby="dropdownMenu" ><%for(var i=0,ci;ci=data[i++];){%><%if(ci.divider){%><li class="edui-divider"></li><%}else{%><li <%if(ci.active||ci.disabled){%>class="<%= ci.active|| \'\' %> <%=ci.disabled||\'\' %>" <%}%> data-value="<%= ci.value%>"><a href="#" tabindex="-1"><em class="edui-dropmenu-checkbox"><i class="edui-icon-ok"></i></em><%= ci.label%></a></li><%}%><%}%></ul>',defaultOpt:{data:[],click:function(){}},init:function(e){var t=this,n={click:1,mouseover:1,mouseout:1};this.root(g(g.parseTmpl(this.tmpl,e))).on("click",'li[class!="edui-disabled edui-divider edui-dropdown-submenu"]',function(n){g.proxy(e.click,t,n,g(this).data("value"),g(this))()}).find("li").each(function(r,i){var s=g(this);if(!s.hasClass("edui-disabled edui-divider edui-dropdown-submenu")){var o=e.data[r];g.each(n,function(e){o[e]&&s[e](function(n){g.proxy(o[e],i)(n,o,t.root)})})}})},disabled:function(e){g("li[class!=edui-divider]",this.root()).each(function(){var t=g(this);!0===e?t.addClass("edui-disabled"):g.isFunction(e)?t.toggleClass("edui-disabled",e(li)):t.removeClass("edui-disabled")})},val:function(e){var t;g('li[class!="edui-divider edui-disabled edui-dropdown-submenu"]',this.root()).each(function(){var n=g(this);if(void 0===e){if(n.find("em.edui-dropmenu-checked").length)return t=n.data("value"),!1}else n.find("em").toggleClass("edui-dropmenu-checked",n.data("value")==e)});if(void 0===e)return t},addSubmenu:function(e,t,n){n=n||0;var r=g("li[class!=edui-divider]",this.root());e=g('<li class="edui-dropdown-submenu"><a tabindex="-1" href="#">'+e+"</a></li>").append(t),0<=n&&n<r.length?e.insertBefore(r[n]):0>n?e.insertBefore(r[0]):n>=r.length&&e.appendTo(r)}},"menu"),UM.ui.define("splitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{text:"",title:"",click:function(){}},init:function(e){var t=this;return t.root(g(g.parseTmpl(t.tpl,e))),t.root().find(".edui-btn:first").click(function(n){t.disabled()||g.proxy(e.click,t)()}),t.root().find(".edui-dropdown-toggle").click(function(){t.disabled()||t.trigger("arrowclick")}),t.root().hover(function(){t.root().hasClass("edui-disabled")||t.root().toggleClass("edui-hover")}),t},wrapclick:function(e,t){return this.disabled()||g.proxy(e,this,t)(),this},disabled:function(e){return void 0===e?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",e).find(".edui-btn").toggleClass("edui-disabled",e),this)},active:function(e){return void 0===e?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",e).find(".edui-btn:first").toggleClass("edui-active",e),this)},mergeWith:function(e){var t=this;t.data("$mergeObj",e),e.edui().data("$mergeObj",t.root()),g.contains(document.body,e[0])||e.appendTo(t.root()),t.root().delegate(".edui-dropdown-toggle","click",function(){t.wrapclick(function(){e.edui().show()})}),t.register("click",t.root().find(".edui-dropdown-toggle"),function(t){e.hide()})}}),UM.ui.define("colorsplitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><div class="edui-splitbutton-color-label" <%if (color) {%>style="background: <%=color%>"<%}%>></div><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{color:""},init:function(e){this.supper.init.call(this,e)},colorLabel:function(){return this.root().find(".edui-splitbutton-color-label")}},"splitbutton"),UM.ui.define("popup",{tpl:'<div class="edui-dropdown-menu edui-popup"<%if(!<%=stopprop%>){%>onmousedown="return false"<%}%>><div class="edui-popup-body" unselectable="on" onmousedown="return false"><%=subtpl%></div><div class="edui-popup-caret"></div></div>',defaultOpt:{stopprop:!1,subtpl:"",width:"",height:""},init:function(e){return this.root(g(g.parseTmpl(this.tpl,e))),this},mergeTpl:function(e){return g.parseTmpl(this.tpl,{subtpl:e})},show:function(e,t){t||(t={});var n=t.fnname||"position";!1!==this.trigger("beforeshow")&&(this.root().css(g.extend({display:"block"},e?{top:e[n]().top+("right"==t.dir?0:e.outerHeight())-(t.offsetTop||0),left:e[n]().left+("right"==t.dir?e.outerWidth():0)-(t.offsetLeft||0),position:"absolute"}:{})),this.root().find(".edui-popup-caret").css({top:t.caretTop||0,left:t.caretLeft||0,position:"absolute"}).addClass(t.caretDir||"up"),this.trigger("aftershow"))},hide:function(){this.root().css("display","none"),this.trigger("afterhide")},attachTo:function(e,t){var n=this;e.data("$mergeObj")||(e.data("$mergeObj",n.root()),e.on("wrapclick",function(r){n.show(e,t)}),n.register("click",e,function(e){n.hide()}),n.data("$mergeObj",e))},getBodyContainer:function(){return this.root().find(".edui-popup-body")}}),UM.ui.define("scale",{tpl:'<div class="edui-scale" unselectable="on"><span class="edui-scale-hand0"></span><span class="edui-scale-hand1"></span><span class="edui-scale-hand2"></span><span class="edui-scale-hand3"></span><span class="edui-scale-hand4"></span><span class="edui-scale-hand5"></span><span class="edui-scale-hand6"></span><span class="edui-scale-hand7"></span></div>',defaultOpt:{$doc:g(document),$wrap:g(document)},init:function(e){return e.$doc&&(this.defaultOpt.$doc=e.$doc),e.$wrap&&(this.defaultOpt.$wrap=e.$wrap),this.root(g(g.parseTmpl(this.tpl,e))),this.initStyle(),this.startPos=this.prePos={x:0,y:0},this.dragId=-1,this},initStyle:function(){n.cssRule("edui-style-scale",".edui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}.edui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-scale .edui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},_eventHandler:function(e){var t=this.defaultOpt.$doc;switch(e.type){case"mousedown":var n=e.target||e.srcElement;-1!=n.className.indexOf("edui-scale-hand")&&(this.dragId=n.className.slice(-1),this.startPos.x=this.prePos.x=e.clientX,this.startPos.y=this.prePos.y=e.clientY,t.bind("mousemove",g.proxy(this._eventHandler,this)));break;case"mousemove":-1!=this.dragId&&(this.updateContainerStyle(this.dragId,{x:e.clientX-this.prePos.x,y:e.clientY-this.prePos.y}),this.prePos.x=e.clientX,this.prePos.y=e.clientY,this.updateTargetElement());break;case"mouseup":-1!=this.dragId&&(this.dragId=-1,this.updateTargetElement(),this.data("$scaleTarget").parent()&&this.attachTo(this.data("$scaleTarget"))),t.unbind("mousemove",g.proxy(this._eventHandler,this))}},updateTargetElement:function(){var e=this.root(),t=this.data("$scaleTarget");t.css({width:e.width(),height:e.height()}),this.attachTo(t)},updateContainerStyle:function(e,t){var n=this.root(),r,i=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];0!=i[e][0]&&(r=parseInt(n.offset().left)+t.x,n.css("left",this._validScaledProp("left",r))),0!=i[e][1]&&(r=parseInt(n.offset().top)+t.y,n.css("top",this._validScaledProp("top",r))),0!=i[e][2]&&(r=n.width()+i[e][2]*t.x,n.css("width",this._validScaledProp("width",r))),0!=i[e][3]&&(r=n.height()+i[e][3]*t.y,n.css("height",this._validScaledProp("height",r)))},_validScaledProp:function(e,t){var n=this.root(),r=this.defaultOpt.$doc,i=function(e,n,r){return e+n>r?r-n:t};t=isNaN(t)?0:t;switch(e){case"left":return 0>t?0:i(t,n.width(),r.width());case"top":return 0>t?0:i(t,n.height(),r.height());case"width":return 0>=t?1:i(t,n.offset().left,r.width());case"height":return 0>=t?1:i(t,n.offset().top,r.height())}},show:function(e){e&&this.attachTo(e),this.root().bind("mousedown",g.proxy(this._eventHandler,this)),this.defaultOpt.$doc.bind("mouseup",g.proxy(this._eventHandler,this)),this.root().show(),this.trigger("aftershow")},hide:function(){this.root().unbind("mousedown",g.proxy(this._eventHandler,this)),this.defaultOpt.$doc.unbind("mouseup",g.proxy(this._eventHandler,this)),this.root().hide(),this.trigger("afterhide")},attachTo:function(e){var t=e.offset(),n=this.root(),r=this.defaultOpt.$wrap,i=r.offset();this.data("$scaleTarget",e),this.root().css({position:"absolute",width:e.width(),height:e.height(),left:t.left-i.left-parseInt(r.css("border-left-width"))-parseInt(n.css("border-left-width")),top:t.top-i.top-parseInt(r.css("border-top-width"))-parseInt(n.css("border-top-width"))})},getScaleTarget:function(){return this.data("$scaleTarget")[0]}}),UM.ui.define("colorpicker",{tpl:function(e){for(var t="ffffff 000000 eeece1 1f497d 4f81bd c0504d 9bbb59 8064a2 4bacc6 f79646 f2f2f2 7f7f7f ddd9c3 c6d9f0 dbe5f1 f2dcdb ebf1dd e5e0ec dbeef3 fdeada d8d8d8 595959 c4bd97 8db3e2 b8cce4 e5b9b7 d7e3bc ccc1d9 b7dde8 fbd5b5 bfbfbf 3f3f3f 938953 548dd4 95b3d7 d99694 c3d69b b2a2c7 92cddc fac08f a5a5a5 262626 494429 17365d 366092 953734 76923c 5f497a 31859b e36c09 7f7f7f 0c0c0c 1d1b10 0f243e 244061 632423 4f6128 3f3151 205867 974806 c00000 ff0000 ffc000 ffff00 92d050 00b050 00b0f0 0070c0 002060 7030a0 ".split(" "),n='<div unselectable="on" onmousedown="return false" class="edui-colorpicker<%if (name){%> edui-colorpicker-<%=name%><%}%>" ><table unselectable="on" onmousedown="return false"><tr><td colspan="10">'+e.lang_themeColor+'</td> </tr><tr class="edui-colorpicker-firstrow" >',r=0;r<t.length;r++)r&&0===r%10&&(n+="</tr>"+(60==r?'<tr><td colspan="10">'+e.lang_standardColor+"</td></tr>":"")+"<tr"+(60==r?' class="edui-colorpicker-firstrow"':"")+">"),n+=70>r?'<td><a unselectable="on" onmousedown="return false" title="'+t[r]+'" class="edui-colorpicker-colorcell" data-color="#'+t[r]+'" style="background-color:#'+t[r]+";border:solid #ccc;"+(10>r||60<=r?"border-width:1px;":10<=r&&20>r?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"></a></td>':"";return n+"</tr></table></div>"},init:function(e){var t=this;t.root(g(g.parseTmpl(t.supper.mergeTpl(t.tpl(e)),e))),t.root().on("click",function(e){t.trigger("pickcolor",g(e.target).data("color"))})}},"popup"),function(){UM.ui.define("combobox",function(){return{tpl:'<ul class="dropdown-menu edui-combobox-menu<%if (comboboxName!==\'\') {%> edui-combobox-<%=comboboxName%><%}%>" unselectable="on" onmousedown="return false" role="menu" aria-labelledby="dropdownMenu"><%if(autoRecord) {%><%for( var i=0, len = recordStack.length; i<len; i++ ) {%><%var index = recordStack[i];%><li class="<%=itemClassName%><%if( selected == index ) {%> edui-combobox-checked<%}%>" data-item-index="<%=index%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ index ]%>" unselectable="on" onmousedown="return false"><%=items[index]%></label></li><%}%><%if( i ) {%><li class="edui-combobox-item-separator"></li><%}%><%}%><%for( var i=0, label; label = items[i]; i++ ) {%><li class="<%=itemClassName%><%if( selected == i ) {%> edui-combobox-checked<%}%> edui-combobox-item-<%=i%>" data-item-index="<%=i%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ i ]%>" unselectable="on" onmousedown="return false"><%=label%></label></li><%}%></ul>',defaultOpt:{recordStack:[],items:[],value:[],comboboxName:"",selected:"",autoRecord:!0,recordCount:5},init:function(e){g.extend(this._optionAdaptation(e),this._createItemMapping(e.recordStack,e.items),{itemClassName:"edui-combobox-item",iconClass:"edui-combobox-checked-icon",labelClassName:"edui-combobox-item-label"}),this._transStack(e),this.root(g(g.parseTmpl(this.tpl,e))),this.data("options",e).initEvent()},initEvent:function(){this.initSelectItem(),this.initItemActive()},initSelectItem:function(){var e=this;e.root().delegate(".edui-combobox-item","click",function(){var t=g(this),n=t.attr("data-item-index");return e.trigger("comboboxselect",{index:n,label:t.find(".edui-combobox-item-label").text(),value:e.data("options").value[n]}).select(n),e.hide(),!1})},initItemActive:function(){var e={mouseenter:"addClass",mouseleave:"removeClass"};g.IE6&&this.root().delegate(".edui-combobox-item","mouseenter mouseleave",function(t){g(this)[e[t.type]]("edui-combobox-item-hover")}).one("afterhide",function(){})},select:function(e){var t=this.data("options").itemCount,n=this.data("options").autowidthitem;return n&&!n.length&&(n=this.data("options").items),0==t?null:(0>e?e=t+e%t:e>=t&&(e=t-1),this.trigger("changebefore",n[e]),this._update(e),this.trigger("changeafter",n[e]),null)},selectItemByLabel:function(e){var t=this.data("options").itemMapping,n=this,r=null;!g.isArray(e)&&(e=[e]),g.each(e,function(e,i){r=t[i];if(void 0!==r)return n.select(r),!1})},_transStack:function(e){var t=[],n=-1,r=-1;g.each(e.recordStack,function(i,s){n=e.itemMapping[s],g.isNumeric(n)&&(t.push(n),s==e.selected&&(r=n))}),e.recordStack=t,e.selected=r,t=null},_optionAdaptation:function(e){if(!("itemStyles"in e)){e.itemStyles=[];for(var t=0,n=e.items.length;t<n;t++)e.itemStyles.push("")}return e.autowidthitem=e.autowidthitem||e.items,e.itemCount=e.items.length,e},_createItemMapping:function(e,t){var n={},r={recordStack:[],mapping:{}};return g.each(t,function(e,t){n[t]=e}),r.itemMapping=n,g.each(e,function(e,t){void 0!==n[t]&&(r.recordStack.push(n[t]),r.mapping[t]=n[t])}),r},_update:function(e){var t=this.data("options"),n=[],r=null;g.each(t.recordStack,function(t,r){r!=e&&n.push(r)}),n.unshift(e),n.length>t.recordCount&&(n.length=t.recordCount),t.recordStack=n,t.selected=e,r=g(g.parseTmpl(this.tpl,t)),this.root().html(r.html()),n=r=null}}}(),"menu")}(),function(){UM.ui.define("buttoncombobox",function(){return{defaultOpt:{label:"",title:""},init:function(e){var t=this,n=g.eduibutton({caret:!0,name:e.comboboxName,title:e.title,text:e.label,click:function(){t.show(this.root())}});t.supper.init.call(t,e),t.on("changebefore",function(e,t){n.eduibutton("label",t)}),t.data("button",n),t.attachTo(n)},button:function(){return this.data("button")}}}(),"combobox")}(),UM.ui.define("modal",{tpl:'<div class="edui-modal" tabindex="-1" ><div class="edui-modal-header"><div class="edui-close" data-hide="modal"></div><h3 class="edui-title"><%=title%></h3></div><div class="edui-modal-body"  style="<%if(width){%>width:<%=width%>px;<%}%><%if(height){%>height:<%=height%>px;<%}%>"> </div><% if(cancellabel || oklabel) {%><div class="edui-modal-footer"><div class="edui-modal-tip"></div><%if(oklabel){%><div class="edui-btn edui-btn-primary" data-ok="modal"><%=oklabel%></div><%}%><%if(cancellabel){%><div class="edui-btn" data-hide="modal"><%=cancellabel%></div><%}%></div><%}%></div>',defaultOpt:{title:"",cancellabel:"",oklabel:"",width:"",height:"",backdrop:!0,keyboard:!0},init:function(e){this.root(g(g.parseTmpl(this.tpl,e||{}))),this.data("options",e),e.okFn&&this.on("ok",g.proxy(e.okFn,this)),e.cancelFn&&this.on("beforehide",g.proxy(e.cancelFn,this)),this.root().delegate('[data-hide="modal"]',"click",g.proxy(this.hide,this)).delegate('[data-ok="modal"]',"click",g.proxy(this.ok,this)),g('[data-hide="modal"],[data-ok="modal"]',this.root()).hover(function(){g(this).toggleClass("edui-hover")})},toggle:function(){return this[this.data("isShown")?"hide":"show"]()},show:function(){var e=this;e.trigger("beforeshow"),e.data("isShown")||(e.data("isShown",!0),e.escape(),e.backdrop(function(){e.autoCenter(),e.root().show().focus().trigger("aftershow")}))},showTip:function(e){g(".edui-modal-tip",this.root()).html(e).fadeIn()},hideTip:function(e){g(".edui-modal-tip",this.root()).fadeOut(function(){g(this).html("")})},autoCenter:function(){!g.IE6&&this.root().css("margin-left",-(this.root().width()/2))},hide:function(){this.trigger("beforehide"),this.data("isShown")&&(this.data("isShown",!1),this.escape(),this.hideModal())},escape:function(){var e=this;e.data("isShown")&&e.data("options").keyboard?e.root().on("keyup",function(t){27==t.which&&e.hide()}):e.data("isShown")||e.root().off("keyup")},hideModal:function(){var e=this;e.root().hide(),e.backdrop(function(){e.removeBackdrop(),e.trigger("afterhide")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(e){this.data("isShown")&&this.data("options").backdrop&&(this.$backdrop=g('<div class="edui-modal-backdrop" />').click("static"==this.data("options").backdrop?g.proxy(this.root()[0].focus,this.root()[0]):g.proxy(this.hide,this))),this.trigger("afterbackdrop"),e&&e()},attachTo:function(e){var t=this;e.data("$mergeObj")||(e.data("$mergeObj",t.root()),e.on("click",function(){t.toggle(e)}),t.data("$mergeObj",e))},ok:function(){this.trigger("beforeok"),!1!==this.trigger("ok",this)&&this.hide()},getBodyContainer:function(){return this.root().find(".edui-modal-body")}}),UM.ui.define("tooltip",{tpl:'<div class="edui-tooltip" unselectable="on" onmousedown="return false"><div class="edui-tooltip-arrow" unselectable="on" onmousedown="return false"></div><div class="edui-tooltip-inner" unselectable="on" onmousedown="return false"></div></div>',init:function(e){this.root(g(g.parseTmpl(this.tpl,e||{})))},content:function(e){e=g(e.currentTarget).attr("data-original-title"),this.root().find(".edui-tooltip-inner").text(e)},position:function(e){e=g(e.currentTarget),this.root().css(g.extend({display:"block"},e?{top:e.outerHeight(),left:(e.outerWidth()-this.root().outerWidth())/2}:{}))},show:function(e){g(e.currentTarget).hasClass("edui-disabled")||(this.content(e),this.root().appendTo(g(e.currentTarget)),this.position(e),this.root().css("display","block"))},hide:function(){this.root().css("display","none")},attachTo:function(e){function t(e){var t=this;g.contains(document.body,t.root()[0])||t.root().appendTo(e),t.data("tooltip",t.root()),e.each(function(){g(this).attr("data-original-title")&&g(this).on("mouseenter",g.proxy(t.show,t)).on("mouseleave click",g.proxy(t.hide,t))})}var n=this;"undefined"===g.type(e)?g("[data-original-title]").each(function(e,r){t.call(n,g(r))}):e.data("tooltip")||t.call(n,e)}}),UM.ui.define("tab",{init:function(e){var t=this,n=e.selector;g.type(n)&&(t.root(g(n,e.context)),t.data("context",e.context),g(n,t.data("context")).on("click",function(e){t.show(e)}))},show:function(e){var t=this,n=g(e.target),r=n.closest("ul"),i,s;i=(i=n.attr("data-context"))&&i.replace(/.*(?=#[^\s]*$)/,""),e=n.parent("li"),e.length&&!e.hasClass("edui-active")&&(s=r.find(".edui-active:last a")[0],e=g.Event("beforeshow",{target:n[0],relatedTarget:s}),t.trigger(e),e.isDefaultPrevented()||(i=g(i,t.data("context")),t.activate(n.parent("li"),r),t.activate(i,i.parent(),function(){t.trigger({type:"aftershow",relatedTarget:s})})))},activate:function(e,t,n){if(void 0===e)return g(".edui-tab-item.edui-active",this.root()).index();t.find("> .edui-active").removeClass("edui-active"),e.addClass("edui-active"),n&&n()}}),UM.ui.define("separator",{tpl:'<div class="edui-separator" unselectable="on" onmousedown="return false" ></div>',init:function(e){return this.root(g(g.parseTmpl(this.tpl,e))),this}}),function(){var e={},t={},r=[],i={},s={},o={},u=null;n.extend(UM,{defaultWidth:500,defaultHeight:500,registerUI:function(t,r){n.each(t.split(/\s+/),function(t){e[t]=r})},setEditor:function(e){!t[e.id]&&(t[e.id]=e)},registerWidget:function(e,t,n){i[e]=g.extend2(t,{$root:"",_preventDefault:!1,root:function(e){return this.$root||(this.$root=e)},preventDefault:function(){this._preventDefault=!0},clear:!1}),n&&(s[e]=n)},getWidgetData:function(e){return i[e]},setWidgetBody:function(e,t,r){r._widgetData||n.extend(r,{_widgetData:{},getWidgetData:function(e){return this._widgetData[e]},getWidgetCallback:function(e){var n=this;return function(){return s[e].apply(n,[n,t].concat(Array.prototype.slice.call(arguments,0)))}}});var o=i[e];if(!o)return null;o=r._widgetData[e],o||(o=i[e],o=r._widgetData[e]="function"==g.type(o)?o:n.clone(o)),o.root(t.edui().getBodyContainer()),o.initContent(r,t),o._preventDefault||o.initEvent(r,t),o.width&&t.width(o.width)},setActiveWidget:function(e){},getEditor:function(e,n){var r=t[e]||(t[e]=this.createEditor(e,n));return u=u?Math.max(r.getOpt("zIndex"),u):r.getOpt("zIndex"),r},setTopEditor:function(e){g.each(t,function(t,n){e==n?e.$container&&e.$container.css("zIndex",u+1):n.$container&&n.$container.css("zIndex",n.getOpt("zIndex"))})},clearCache:function(e){t[e]&&delete t[e]},delEditor:function(e){var n;(n=t[e])&&n.destroy()},ready:function(e){r.push(e)},createEditor:function(e,t){function n(){var t=this.createUI("#"+e,i);i.key=e,i.ready(function(){g.each(r,function(e,t){g.proxy(t,i)()})});var n=i.options;n.minFrameWidth=n.initialFrameWidth?n.initialFrameWidth:n.initialFrameWidth=i.$body.width()||UM.defaultWidth,t.css({width:n.initialFrameWidth,zIndex:i.getOpt("zIndex")}),UM.browser.ie&&6===UM.browser.version&&document.execCommand("BackgroundImageCache",!1,!0),i.render(e),g.eduitooltip&&g.eduitooltip("attachTo",g("[data-original-title]",t)).css("z-index",i.getOpt("zIndex")+1),t.find("a").click(function(e){e.preventDefault()}),i.fireEvent("afteruiready")}var i=new UM.Editor(t);return i.langIsReady?g.proxy(n,this)():i.addListener("langReady",g.proxy(n,this)),i},createUI:function(t,n){var r=g(t),i=g('<div class="edui-container"><div class="edui-editor-body"></div></div>').insertBefore(r);return n.$container=i,n.container=i[0],n.$body=r,m.ie&&m.ie9above&&g('<span style="padding:0;margin:0;height:0;width:0"></span>').insertAfter(i),g.each(e,function(e,t){var r=t.call(n,e);r&&(o[e]=r)}),i.find(".edui-editor-body").append(r).before(this.createToolbar(n.options,n)),i.find(".edui-toolbar").append(g('<div class="edui-dialog-container"></div>')),i},createToolbar:function(e,t){var n=g.eduitoolbar(),r=n.edui();if(e.toolbar&&e.toolbar.length){var i=[];g.each(e.toolbar,function(e,t){g.each(t.split(/\s+/),function(e,t){if("|"==t)g.eduiseparator&&i.push(g.eduiseparator());else{var n=o[t];"fullscreen"==t?n&&i.unshift(n):n&&i.push(n)}}),i.length&&r.appendToBtnmenu(i)})}else n.find(".edui-btn-toolbar").remove();return n}})}(),UM.registerUI("bold italic redo undo underline strikethrough superscript subscript insertorderedlist insertunorderedlist cleardoc selectall link unlink print preview justifyleft justifycenter justifyright justifyfull removeformat horizontal drafts",function(e){var t=this,n=g.eduibutton({icon:e,click:function(){t.execCommand(e)},title:this.getLang("labelMap")[e]||""});return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(-1==t).active(1==t)}),n}),function(){function e(e){var t=this;if(!e)throw Error("invalid params, notfound editor");t.editor=e,o[e.uid]=this,e.addListener("destroy",function(){delete o[e.uid],t.editor=null})}var t={},n="width height position top left margin padding overflowX overflowY".split(" "),r={},i={},s={},o={};UM.registerUI("fullscreen",function(t){var n=this,r=g.eduibutton({icon:"fullscreen",title:n.options.labelMap&&n.options.labelMap[t]||n.getLang("labelMap."+t),click:function(){n.execCommand(t),UM.setTopEditor(n)}});return n.addListener("selectionchange",function(){var e=this.queryCommandState(t);r.edui().disabled(-1==e).active(1==e)}),n.addListener("ready",function(){n.options.fullscreen&&e.getInstance(n).toggle()}),r}),UM.commands.fullscreen={execCommand:function(t){e.getInstance(this).toggle()},queryCommandState:function(e){return this._edui_fullscreen_status},notNeedUndo:1},e.prototype={toggle:function(){var e=this.editor,t=this.isFullState();e.fireEvent("beforefullscreenchange",!t),this.update(!t),t?this.revert():this.enlarge(),e.fireEvent("afterfullscreenchange",!t),"true"===e.body.contentEditable&&e.fireEvent("fullscreenchanged",!t),e.fireEvent("selectionchange")},enlarge:function(){this.saveSataus(),this.setDocumentStatus(),this.resize()},revert:function(){var e=this.editor.options,e=/%$/.test(e.initialFrameHeight)?"100%":e.initialFrameHeight-this.getStyleValue("padding-top")-this.getStyleValue("padding-bottom")-this.getStyleValue("border-width");g.IE6&&this.getEditorHolder().style.setExpression("height","this.scrollHeight <= "+e+' ? "'+e+'px" : "auto"'),this.revertContainerStatus(),this.revertContentAreaStatus(),this.revertDocumentStatus()},update:function(e){this.editor._edui_fullscreen_status=e},resize:function(){var e=null,t=e=0,n=0,r=0,i=this.editor,s=null,o=null;this.isFullState()&&(e=g(window),t=e.width(),e=e.height(),o=this.getEditorHolder(),n=parseInt(k.getComputedStyle(o,"border-width"),10)||0,n+=parseInt(k.getComputedStyle(i.container,"border-width"),10)||0,r+=parseInt(k.getComputedStyle(o,"padding-left"),10)+parseInt(k.getComputedStyle(o,"padding-right"),10)||0,g.IE6&&o.style.setExpression("height",null),s=this.getBound(),g(i.container).css({width:t+"px",height:e+"px",position:g.IE6?"absolute":"fixed",top:s.top,left:s.left,margin:0,padding:0,overflowX:"hidden",overflowY:"hidden"}),g(o).css({width:t-2*n-r+"px",height:e-2*n-(i.options.withoutToolbar?0:g(".edui-toolbar",i.container).outerHeight())-g(".edui-bottombar",i.container).outerHeight()+"px",overflowX:"hidden",overflowY:"auto"}))},saveSataus:function(){for(var e=this.editor.container.style,r=null,i={},s=0,o=n.length;s<o;s++)r=n[s],i[r]=e[r];t[this.editor.uid]=i,this.saveContentAreaStatus(),this.saveDocumentStatus()},saveContentAreaStatus:function(){var e=g(this.getEditorHolder());r[this.editor.uid]={width:e.css("width"),overflowX:e.css("overflowX"),overflowY:e.css("overflowY"),height:e.css("height")}},saveDocumentStatus:function(){var e=g(this.getEditorDocumentBody());i[this.editor.uid]={overflowX:e.css("overflowX"),overflowY:e.css("overflowY")},s[this.editor.uid]={overflowX:g(this.getEditorDocumentElement()).css("overflowX"),overflowY:g(this.getEditorDocumentElement()).css("overflowY")}},revertContainerStatus:function(){g(this.editor.container).css(this.getEditorStatus())},revertContentAreaStatus:function(){var e=this.getEditorHolder(),t=this.getContentAreaStatus();this.supportMin()&&(delete t.height,e.style.height=null),g(e).css(t)},revertDocumentStatus:function(){var e=this.getDocumentStatus();g(this.getEditorDocumentBody()).css("overflowX",e.body.overflowX),g(this.getEditorDocumentElement()).css("overflowY",e.html.overflowY)},setDocumentStatus:function(){g(this.getEditorDocumentBody()).css({overflowX:"hidden",overflowY:"hidden"}),g(this.getEditorDocumentElement()).css({overflowX:"hidden",overflowY:"hidden"})},isFullState:function(){return!!this.editor._edui_fullscreen_status},getEditorStatus:function(){return t[this.editor.uid]},getContentAreaStatus:function(){return r[this.editor.uid]},getEditorDocumentElement:function(){return this.editor.container.ownerDocument.documentElement},getEditorDocumentBody:function(){return this.editor.container.ownerDocument.body},getEditorHolder:function(){return this.editor.body},getDocumentStatus:function(){return{body:i[this.editor.uid],html:s[this.editor.uid]}},supportMin:function(){var e=null;return this._support||(e=document.createElement("div"),this._support="minWidth"in e.style),this._support},getBound:function(){var e={html:!0,body:!0},t={top:0,left:0},n=null;return g.IE6?((n=this.editor.container.offsetParent)&&!e[n.nodeName.toLowerCase()]&&(e=n.getBoundingClientRect(),t.top=-e.top,t.left=-e.left),t):t},getStyleValue:function(e){return parseInt(k.getComputedStyle(this.getEditorHolder(),e))}},g.extend(e,{listen:function(){var t=null;e._hasFullscreenListener||(e._hasFullscreenListener=!0,g(window).on("resize",function(){null!==t&&(window.clearTimeout(t),t=null),t=window.setTimeout(function(){for(var e in o)o[e].resize();t=null},50)}))},getInstance:function(t){return o[t.uid]||new e(t),o[t.uid]}}),e.listen()}(),UM.registerUI("link image video map formula",function(e){var t=this,r,i,s={title:t.options.labelMap&&t.options.labelMap[e]||t.getLang("labelMap."+e),url:t.options.UMEDITOR_HOME_URL+"dialogs/"+e+"/"+e+".js"},o=g.eduibutton({icon:e,title:this.getLang("labelMap")[e]||""});return n.loadFile(document,{src:s.url,tag:"script",type:"text/javascript",defer:"defer"},function(){var n=UM.getWidgetData(e);if(n){if(n.buttons){var u=n.buttons.ok;u&&(s.oklabel=u.label||t.getLang("ok"),u.exec&&(s.okFn=function(){return g.proxy(u.exec,null,t,i)()}));var l=n.buttons.cancel;l&&(s.cancellabel=l.label||t.getLang("cancel"),l.exec&&(s.cancelFn=function(){return g.proxy(l.exec,null,t,i)()}))}n.width&&(s.width=n.width),n.height&&(s.height=n.height),i=g.eduimodal(s),i.attr("id","edui-dialog-"+e).addClass("edui-dialog-"+e).find(".edui-modal-body").addClass("edui-dialog-"+e+"-body"),i.edui().on("beforehide",function(){var e=t.selection.getRange();e.equals(r)&&e.select()}).on("beforeshow",function(){var n=this.root(),s=null,o=null;r=t.selection.getRange(),n.parent()[0]||t.$container.find(".edui-dialog-container").append(n),g.IE6&&(s={width:g(window).width(),height:g(window).height()},o=n.parents(".edui-toolbar")[0].getBoundingClientRect(),n.css({position:"absolute",margin:0,left:(s.width-n.width())/2-o.left,top:100-o.top})),UM.setWidgetBody(e,i,t),UM.setTopEditor(t)}).on("afterbackdrop",function(){this.$backdrop.css("zIndex",t.getOpt("zIndex")+1).appendTo(t.$container.find(".edui-dialog-container")),i.css("zIndex",t.getOpt("zIndex")+2)}).on("beforeok",function(){try{r.select()}catch(e){}}).attachTo(o)}}),t.addListener("selectionchange",function(){var t=this.queryCommandState(e);o.edui().disabled(-1==t).active(1==t)}),o}),UM.registerUI("emotion formula",function(e){var t=this,r=t.options.UMEDITOR_HOME_URL+"dialogs/"+e+"/"+e+".js",i=g.eduibutton({icon:e,title:this.getLang("labelMap")[e]||""});return n.loadFile(document,{src:r,tag:"script",type:"text/javascript",defer:"defer"},function(){var n={url:r},s=UM.getWidgetData(e);s.width&&(n.width=s.width),s.height&&(n.height=s.height),g.eduipopup(n).css("zIndex",t.options.zIndex+1).addClass("edui-popup-"+e).edui().on("beforeshow",function(){var n=this.root();n.parent().length||t.$container.find(".edui-dialog-container").append(n),UM.setWidgetBody(e,n,t),UM.setTopEditor(t)}).attachTo(i,{offsetTop:-5,offsetLeft:10,caretLeft:11,caretTop:-8}),t.addListener("selectionchange",function(){var t=this.queryCommandState(e);i.edui().disabled(-1==t).active(1==t)})}),i}),UM.registerUI("imagescale",function(){var e=this,t;e.setOpt("imageScaleEnabled",!0),m.webkit&&e.getOpt("imageScaleEnabled")&&(e.addListener("click",function(n,r){var i=e.selection.getRange().getClosedNode(),s=r.target;if(i&&"IMG"==i.tagName&&s==i){if(!t){t=g.eduiscale({$wrap:e.$container}).css("zIndex",e.options.zIndex),e.$container.append(t);var o=function(){t.edui().hide()},u=function(e){var t=e.target||e.srcElement;t&&-1==t.className.indexOf("edui-scale")&&o(e)},f;t.edui().on("aftershow",function(){g(document).bind("keydown",o),g(document).bind("mousedown",u),e.selection.getNative().removeAllRanges()}).on("afterhide",function(){g(document).unbind("keydown",o),g(document).unbind("mousedown",u);var n=t.edui().getScaleTarget();n.parentNode&&e.selection.getRange().selectNode(n).select()}).on("mousedown",function(n){e.selection.getNative().removeAllRanges(),(n=n.target||n.srcElement)&&-1==n.className.indexOf("edui-scale-hand")&&(f=setTimeout(function(){t.edui().hide()},200))}).on("mouseup",function(e){(e=e.target||e.srcElement)&&-1==e.className.indexOf("edui-scale-hand")&&clearTimeout(f)})}t.edui().show(g(i))}else t&&"none"!=t.css("display")&&t.edui().hide()}),e.addListener("click",function(t,n){"IMG"==n.target.tagName&&(new B.Range(e.document,e.body)).selectNode(n.target).select()}))}),UM.registerUI("autofloat",function(){var e=this,t=e.getLang();e.setOpt({autoFloatEnabled:!0,topOffset:0});var r=e.options.topOffset;!1!==e.options.autoFloatEnabled&&e.ready(function(){function i(){var e=document.body.style;e.backgroundImage='url("about:blank")',e.backgroundAttachment="fixed"}function s(){h.parentNode&&h.parentNode.removeChild(h),p.style.cssText=l}function o(){var t=e.container,n;try{n=t.getBoundingClientRect()}catch(i){n={left:0,top:0,height:0,width:0}}Math.round(n.left);var o=Math.round(n.top),l=Math.round(n.bottom-n.top);Math.round(n.right-n.left);for(var g;(g=t.ownerDocument)!==document&&(t=k.getWindow(g).frameElement);)n=t.getBoundingClientRect(),o+=n.top;t=e.options.toolbarTopOffset||0,0>o&&o+l-p.offsetHeight>t?v||(o=k.getXY(p),l=k.getComputedStyle(p,"position"),t=k.getComputedStyle(p,"left"),p.style.width=p.offsetWidth+"px",p.style.zIndex=1*e.options.zIndex+1,p.parentNode.insertBefore(h,p),u||f&&m.ie?("absolute"!=p.style.position&&(p.style.position="absolute"),p.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-d+r+"px"):"fixed"!=p.style.position&&(p.style.position="fixed",p.style.top=r+"px",("absolute"==l||"relative"==l)&&parseFloat(t)&&(p.style.left=o.x+"px"))):s()}var u=m.ie&&6>=m.version,f=m.quirks,l,h=document.createElement("div"),p,d,v=!1,y=n.defer(function(){o()},m.ie?200:100,!0);e.addListener("destroy",function(){g(window).off("scroll resize",o),e.removeListener("keydown",y)});var w;UM.ui?w=1:(alert(t.autofloatMsg),w=0),w&&(p=g(".edui-toolbar",e.container)[0],e.addListener("afteruiready",function(){setTimeout(function(){d=g(p).offset().top},100)}),l=p.style.cssText,h.style.height=p.offsetHeight+"px",u&&i(),g(window).on("scroll resize",o),e.addListener("keydown",y),e.addListener("resize",function(){s(),h.style.height=p.offsetHeight+"px",o()}),e.addListener("beforefullscreenchange",function(e,t){t&&(s(),v=t)}),e.addListener("fullscreenchanged",function(e,t){t||o(),v=t}),e.addListener("sourcemodechanged",function(e,t){setTimeout(function(){o()},0)}),e.addListener("clearDoc",function(){setTimeout(function(){o()},0)}))})}),UM.registerUI("source",function(e){var t=this;t.addListener("fullscreenchanged",function(){t.$container.find("textarea").width(t.$body.width()-10).height(t.$body.height())});var n=g.eduibutton({icon:e,click:function(){t.execCommand(e),UM.setTopEditor(t)},title:this.getLang("labelMap")[e]||""});return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(-1==t).active(1==t)}),n}),UM.registerUI("paragraph fontfamily fontsize",function(e){function t(e,n){var r=g("<span>").html(e).css({display:"inline",position:"absolute",top:-1e7,left:-1e5}).appendTo(document.body),i=r.width();return r.remove(),50>i?e:(e=e.slice(0,n?-4:-1),e.length?t(e+"...",!0):"...")}function n(e){var n=[],r;for(r in e.items)e.value.push(r),n.push(r),e.autowidthitem.push(t(r));return e.items=n,e.autoRecord=!1,e}function r(e){for(var n=null,r=[],i=0,s=e.items.length;i<s;i++)n=e.items[i].val,r.push(n.split(/\s*,\s*/)[0]),e.itemStyles.push("font-family: "+n),e.value.push(n),e.autowidthitem.push(t(r[i]));return e.items=r,e}function i(e){var t=null,n=[];e.itemStyles=[],e.value=[];for(var r=0,i=e.items.length;r<i;r++)t=e.items[r],n.push(t),e.itemStyles.push("font-size: "+t+"px");return e.value=e.items,e.items=n,e.autoRecord=!1,e}var s=this,o=s.options.labelMap&&s.options.labelMap[e]||s.getLang("labelMap."+e),o={label:o,title:o,comboboxName:e,items:s.options[e]||[],itemStyles:[],value:[],autowidthitem:[]},u=null,a=null;if(0==o.items.length)return null;switch(e){case"paragraph":o=n(o);break;case"fontfamily":o=r(o);break;case"fontsize":o=i(o)}return u=g.eduibuttoncombobox(o).css("zIndex",s.getOpt("zIndex")+1),a=u.edui(),a.on("comboboxselect",function(t,n){s.execCommand(e,n.value)}).on("beforeshow",function(){0===u.parent().length&&u.appendTo(s.$container.find(".edui-dialog-container")),UM.setTopEditor(s)}),this.addListener("selectionchange",function(t){t=this.queryCommandState(e);var n=this.queryCommandValue(e);a.button().edui().disabled(-1==t).active(1==t),n&&(n=n.replace(/['"]/g,"").toLowerCase().split(/['|"]?\s*,\s*[\1]?/),a.selectItemByLabel(n))}),a.button().addClass("edui-combobox")}),UM.registerUI("forecolor backcolor",function(e){var t=this,n=null,r=null,i=null;return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);i.edui().disabled(-1==t).active(1==t)}),i=g.eduicolorsplitbutton({icon:e,caret:!0,name:e,title:t.getLang("labelMap")[e],click:function(){t.execCommand(e,k.getComputedStyle(r[0],"background-color"))}}),r=i.edui().colorLabel(),n=g.eduicolorpicker({name:e,lang_clearColor:t.getLang("clearColor")||"",lang_themeColor:t.getLang("themeColor")||"",lang_standardColor:t.getLang("standardColor")||""}).on("pickcolor",function(n,i){window.setTimeout(function(){r.css("backgroundColor",i),t.execCommand(e,i)},0)}).on("show",function(){UM.setActiveWidget(colorPickerWidget.root())}).css("zIndex",t.getOpt("zIndex")+1),i.edui().on("arrowclick",function(){n.parent().length||t.$container.find(".edui-dialog-container").append(n),n.edui().show(i,{caretDir:"down",offsetTop:-5,offsetLeft:8,caretLeft:11,caretTop:-8}),UM.setTopEditor(t)}).register("click",i,function(){n.edui().hide()}),i})}($),UM});