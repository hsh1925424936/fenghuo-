
define(['./model.js','template','oasNumberRoll','oasEventAction','oasCalendar','oasDialog','/echarts/echarts.min.js'],function(model,template,oasNumberRoll,eventAction,oasCalendar,dialog){
    var home = {
        init:function(){
            // dialog.open({
            //     type:2,
            //     title:['详情页','font-size:18px;color:#fff;'],
            //     content:'../detail.html',
            //     shade:0.5,
            //     shadeClose:true,
            //     area:['1378px','608px'],
            //     btn:['确定','取消']
            // })
            this._event();
            this._renderToday();
            this._renderdbNumber();
            // this._renderHackerNumber();
            this._renderMap();
            this._renderLine();
            this._renderPie();
            this._renderTop5Data();
            // this._renderDbData({
            //     areaCode:'',
            //     startTime:'',
            //     endTime:''
            // });
            // this._renderHackerData();
            commonModel.date = '';
            commonModel.date = new Date();
            // setInterval(function(){
            //     commonModel.date = '';
            //     commonModel.date = new Date();
            //     console.log(commonModel.date)
            // },1000)
            $("#calendar-datetime1").oasCalendar({
                startFrom : 0,
                // isShowTime : true,
                // isStatic : true
                range:[new Date(1970,1,1),new Date()]
            }).on('select.oasCalendar',function(ev,$el,date){
            //    ev.stopPropagation()
                // console.log(date)
                // console.log(new Date(date).getTime())
                // console.log(ev);
                // console.log($el)
                // console.log(moment(date).format('YYYY-MM-DD'))
                // commonModel.startTime = new Date(date).getTime();
                // console.log(commonModel.startTime)
            });
            $("#calendar-datetime2").oasCalendar({
                startFrom : 0,
                // isShowTime : true,
                // isStatic : true
                range:[new Date(1970,1,1),new Date()]
            }).on('select.oasCalendar',function(ev,$el,date){
                // ev.stopPropagation()
                // console.log(new Date(date).getTime())
                // commonModel.endTime = new Date(date).getTime();
                // console.log(commonModel.endTime)
            });
            // $('.bd-left').
        },
        _event:function(){
            var self = this;
            eventAction.add({
                'sure':function(e){
                    // e.stopPropagation();
                    commonModel.startTime = (new Date($('#calendar-datetime1').val()).getTime())/1000;
                    // console.log(commonModel.startTime);
                    commonModel.endTime = (new Date($('#calendar-datetime2').val()).getTime())/1000;
                    commonModel.startTime = commonModel.startTime?commonModel.startTime:'';
                    commonModel.endTime = commonModel.endTime?commonModel.endTime:''
                    if(commonModel.show){
                        self._renderMap()
                    }else{
                        self._renderProviceMap(commonModel.name);
                    }
                    self._renderLine();
                    self._renderdbNumber();
                    self._renderPie();
                    self._renderTop5Data();
                },
                'toggleTime':function(e){
                    // e.stopPropagation();
                    if($('.select-time p').text() == '收起时间轴'){
                        $('.select-time').animate({
                            'bottom':'-80px'
                        },300,function(){
                            $('.select-time p').text('展开时间轴')
                        })
                    }else{
                        $('.select-time').animate({
                            'bottom':'-10px'
                        },300,function(){
                            $('.select-time p').text('收起时间轴')
                        })
                    }
                    
                },
                'selectDate':function(e){
                    // e.stopPropagation();
                    $(this).addClass('active').siblings().removeClass('active');
                    var str = $(this).text();
                    if(str == '今日'){
                        $('.today').removeClass('hide');
                        $('.define').addClass('hide');
                    }else{
                        $('.define').removeClass('hide');
                        $('.today').addClass('hide');
                    }
                },
                'detail':function(e){
                    // e.stopPropagation();
                    var type = '';
                    var code = '';
                    var obj = null;
                    type = $(this).data('type');
                    code = $(this).data('code')?$(this).data('code'):commonModel.code;
                    var name = ''
                    if(type=='db'){
                        name = '等保详情页'
                    }else{
                        name = '黑客详情页'
                    }
                    dialog.open({
                        type:2,
                        title:[name,'font-size:18px;color:#fff;'],
                        content:'../detail.html?type='+type+'&code='+code,
                        shade:0.5,
                        shadeClose:true,
                        area:['1378px','608px'],
                        // btn:['确定','取消']
                        btn:[]
                    })
                },
                "back":function(e){
                    // console.log(e)
                    // e.stopImmediatePropagation();
                    // console.log('aaaaaaaaaaa');
                    if(!commonModel.show){
                        commonModel.code = '';
                        commonModel.show = true;
                        $('.province').remove();
                        $('.back').addClass('hide')
                        self._renderMap();
                        self._renderLine();
                        self._renderdbNumber();
                        self._renderPie();
                        self._renderTop5Data();
                    }
                }
            })
        },
        _detail:function(type,startTime,endTime,code,scatter){
            var name = ''
            if(type=='db'){
                name = '等保详情页'
            }else{
                name = '黑客详情页'
            }
            dialog.open({
                type:2,
                title:[name,'font-size:18px;color:#fff;'],
                content:'../detail.html?type='+type+'&startTime='+startTime+'&endTime='+endTime+'&code='+code+'&scatter='+scatter,
                shade:0.5,
                shadeClose:true,
                area:['1378px','608px'],
                // btn:['确定','取消']
                btn:[]
            })
        },
        _renderToday:function(){
            var str = ''
            for(var i = 1;i<25;i++){
                if(i == 1){
                    str += '<span class="first"><small class="zero">0</small><small>'+i+'</small></span>'
                }else if(i == 24){
                    str += '<span class="last"><small>'+i+'</small></span>'
                }else{
                    str+='<span><small>'+i+'</small></span>'
                }
            }
            $('.today div').html(str)
        },
        _renderdbNumber:function(){
            var timer = null;
            clearInterval(timer);
            model.getTotal({
                areaCode:commonModel.code,
                startTime:commonModel.startTime,
                endTime:commonModel.endTime
            }).then(function(data){
                // console.log(data)
                $number.oasNumberRoll('setNumber',data.taotalPB?data.taotalPB:0);
                var num = $number.oasNumberRoll('getNumber');
                $number1.oasNumberRoll('setNumber',data.totalHC?data.totalHC:0);
                var num1 = $number1.oasNumberRoll('getNumber');
            })
            
            // timer = setInterval(function() {
            //     model.getTotal({
            //         areaCode:commonModel.code,
            //         startTime:commonModel.startTime,
            //         endTime:commonModel.endTime
            //     }).then(function(data){
            //         // $number.oasNumberRoll('setNumber',randomFloat());
            //         $number.oasNumberRoll('setNumber',data.taotalPB?data.taotalPB:0);
            //         var num = $number.oasNumberRoll('getNumber');
            //         $number1.oasNumberRoll('setNumber',data.totalHC?data.totalHC:0);
            //         var num1 = $number1.oasNumberRoll('getNumber');
            //     })
                
            //     // console.log(num);
            // },60000)

            var $number = $('.db-number .number');
            // $number.html('');
            $number.oasNumberRoll({
                initNum : 1000,
                comma : true,
                digit : {
                    unit : '',
                    unitNum : 1,
                    formatter : function(num) {
                        // console.log(num)
                        return num;
                    }
                }
            })
            var $numberToday = $('.db-number .number-today');
            $numberToday.oasNumberRoll({
                initNum : 1000,
                comma : true,
                digit : {
                    unit : '',
                    unitNum : 1,
                    formatter : function(num) {
                        // console.log(num)
                        return num;
                    }
                }
            })
            var $numberToday1 = $('.hacker-number .number-today');
            $numberToday1.oasNumberRoll({
                initNum : 1000,
                comma : true,
                digit : {
                    unit : '',
                    unitNum : 1,
                    formatter : function(num) {
                        // console.log(num)
                        return num;
                    }
                }
            })
            var $number1 = $('.hacker-number .number');
            // $number1.html('');
            $number1.oasNumberRoll({
                initNum : 1000,
                comma : true,
                digit : {
                    unit : '',
                    unitNum : 1,
                    formatter : function(num1) {
                        // console.log(num)
                        return num1;
                    }
                }
            })

            

            // var randomFloat = function() {
                // var random = Math.round(Math.random()*10)
                // var num = Math.round(Math.random()*1000000)
                // console.log(num);
                // return num;
            // }
        },
        _renderHackerNumber:function(){
            var $number = $('.hacker-number div');
            $number.oasNumberRoll({
                initNum : 1234,
                comma : true,
                digit : {
                    unit : '',
                    unitNum : 1,
                    formatter : function(num) {
                        // console.log(num)
                        return num*2;
                    }
                }
            })
            setInterval(function() {
                $number.oasNumberRoll('setNumber',randomFloat());
                var num = $number.oasNumberRoll('getNumber');
                // console.log(num);
            },3000)
            var randomFloat = function() {
                // var random = Math.round(Math.random()*10)
                var num = Math.round(Math.random()*1000000)
                // console.log(num);
                return num;
            }
        },
        convertData:function(data){
            var geoCoord = {
                '黑龙江省':[126.642464,45.756967],
                '广东省':[113.280637,23.125178],
                '台湾':[121.509062,25.044332],
                '广西壮族自治区':[108.320004,22.82402],
                '江苏省':[118.767413,32.041544],
                '浙江省':[120.153576,30.287459],
                '贵州省':[106.713478,26.578343],
                '江西省':[115.892151,28.676493],
                '西藏自治区':[91.132212,29.660361],
                '河南省':[113.665412,34.757975],
                '陕西省':[108.948024,34.263161],
                '山西省':[112.549248,37.857014],
                '云南省':[102.712251,25.040609],
                '内蒙古自治区':[111.670801,40.818311],
                '山东省':[117.000923,36.675807],
                '香港特别行政区':[114.173355,22.320048],
                '澳门特别行政区':[113.54909,22.198951],
                '北京':[116.405285,39.904989],
                '天津':[117.190182,39.125596],
                '河北省':[114.502461,38.045474],
                '福建省':[119.306239,26.075302],
                '海南省':[110.33119,20.031971],
                '重庆':[106.504962,29.533155],
                '四川省':[104.065735,30.659462],
                '甘肃省':[103.823557,36.058039],
                '安徽省':[117.283042,31.86119],
                '湖北省':[114.298572,30.584355],
                '青海省':[101.778916,36.623178],
                '辽宁省':[123.429096,41.796767],
                '湖南省':[112.982279,28.19409],
                '宁夏回族自治区':[106.278179,38.46637],
                '新疆维吾尔自治区':[87.617733,43.792818],
                '吉林省':[125.3245,43.886841],

                '鹤岗':[130.3,47.33],
                '绥化':[127,46.63],

                "海门":[121.15,31.89],
                "鄂尔多斯":[109.781327,39.608266],
                "招远":[120.38,37.35],
                "舟山":[122.207216,29.985295],
                "齐齐哈尔":[123.97,47.33],
                "盐城":[120.13,33.38],
                "赤峰":[118.87,42.28],
                "青岛":[120.33,36.07],
                "乳山":[121.52,36.89],
                "金昌":[102.188043,38.520089],
                "泉州":[118.58,24.93],
                "莱西":[120.53,36.86],
                "日照":[119.46,35.42],
                "胶南":[119.97,35.88],
                "南通":[121.05,32.08],
                "拉萨":[91.11,29.97],
                "云浮":[112.02,22.93],
                "梅州":[116.1,24.55],
                "文登":[122.05,37.2],
                "上海":[121.48,31.22],
                "攀枝花":[101.718637,26.582347],
                "威海":[122.1,37.5],
                "承德":[117.93,40.97],
                "厦门":[118.1,24.46],
                "汕尾":[115.375279,22.786211],
                "潮州":[116.63,23.68],
                "丹东":[124.37,40.13],
                "太仓":[121.1,31.45],
                "曲靖":[103.79,25.51],
                "烟台":[121.39,37.52],
                "福州":[119.3,26.08],
                "瓦房店":[121.979603,39.627114],
                "即墨":[120.45,36.38],
                "抚顺":[123.97,41.97],
                "玉溪":[102.52,24.35],
                "张家口":[114.87,40.82],
                "阳泉":[113.57,37.85],
                "莱州":[119.942327,37.177017],
                "湖州":[120.1,30.86],
                "汕头":[116.69,23.39],
                "昆山":[120.95,31.39],
                "宁波":[121.56,29.86],
                "湛江":[110.359377,21.270708],
                "揭阳":[116.35,23.55],
                "荣成":[122.41,37.16],
                "连云港":[119.16,34.59],
                "葫芦岛":[120.836932,40.711052],
                "常熟":[120.74,31.64],
                "东莞":[113.75,23.04],
                "河源":[114.68,23.73],
                "淮安":[119.15,33.5],
                "泰州":[119.9,32.49],
                "南宁":[108.33,22.84],
                "营口":[122.18,40.65],
                "惠州":[114.4,23.09],
                "江阴":[120.26,31.91],
                "蓬莱":[120.75,37.8],
                "韶关":[113.62,24.84],
                "嘉峪关":[98.289152,39.77313],
                "广州":[113.23,23.16],
                "延安":[109.47,36.6],
                "太原":[112.53,37.87],
                "清远":[113.01,23.7],
                "中山":[113.38,22.52],
                "昆明":[102.73,25.04],
                "寿光":[118.73,36.86],
                "盘锦":[122.070714,41.119997],
                "长治":[113.08,36.18],
                "深圳":[114.07,22.62],
                "珠海":[113.52,22.3],
                "宿迁":[118.3,33.96],
                "咸阳":[108.72,34.36],
                "铜川":[109.11,35.09],
                "平度":[119.97,36.77],
                "佛山":[113.11,23.05],
                "海口":[110.35,20.02],
                "江门":[113.06,22.61],
                "章丘":[117.53,36.72],
                "肇庆":[112.44,23.05],
                "大连":[121.62,38.92],
                "临汾":[111.5,36.08],
                "吴江":[120.63,31.16],
                "石嘴山":[106.39,39.04],
                "沈阳":[123.38,41.8],
                "苏州":[120.62,31.32],
                "茂名":[110.88,21.68],
                "嘉兴":[120.76,30.77],
                "长春":[125.35,43.88],
                "胶州":[120.03336,36.264622],
                "银川":[106.27,38.47],
                "张家港":[120.555821,31.875428],
                "三门峡":[111.19,34.76],
                "锦州":[121.15,41.13],
                "南昌":[115.89,28.68],
                "柳州":[109.4,24.33],
                "三亚":[109.511909,18.252847],
                "自贡":[104.778442,29.33903],
                "吉林":[126.57,43.87],
                "阳江":[111.95,21.85],
                "泸州":[105.39,28.91],
                "西宁":[101.74,36.56],
                "宜宾":[104.56,29.77],
                "呼和浩特":[111.65,40.82],
                "成都":[104.06,30.67],
                "大同":[113.3,40.12],
                "镇江":[119.44,32.2],
                "桂林":[110.28,25.29],
                "张家界":[110.479191,29.117096],
                "宜兴":[119.82,31.36],
                "北海":[109.12,21.49],
                "西安":[108.95,34.27],
                "金坛":[119.56,31.74],
                "东营":[118.49,37.46],
                "牡丹江":[129.58,44.6],
                "遵义":[106.9,27.7],
                "绍兴":[120.58,30.01],
                "扬州":[119.42,32.39],
                "常州":[119.95,31.79],
                "潍坊":[119.1,36.62],
                "重庆":[106.54,29.59],
                "台州":[121.420757,28.656386],
                "南京":[118.78,32.04],
                "滨州":[118.03,37.36],
                "贵阳":[106.71,26.57],
                "无锡":[120.29,31.59],
                "本溪":[123.73,41.3],
                "克拉玛依":[84.77,45.59],
                "渭南":[109.5,34.52],
                "马鞍山":[118.48,31.56],
                "宝鸡":[107.15,34.38],
                "焦作":[113.21,35.24],
                "句容":[119.16,31.95],
                "北京":[116.46,39.92],
                "徐州":[117.2,34.26],
                "衡水":[115.72,37.72],
                "包头":[110,40.58],
                "绵阳":[104.73,31.48],
                "乌鲁木齐":[87.68,43.77],
                "枣庄":[117.57,34.86],
                "杭州":[120.19,30.26],
                "淄博":[118.05,36.78],
                "鞍山":[122.85,41.12],
                "溧阳":[119.48,31.43],
                "库尔勒":[86.06,41.68],
                "安阳":[114.35,36.1],
                "开封":[114.35,34.79],
                "济南":[117,36.65],
                "德阳":[104.37,31.13],
                "温州":[120.65,28.01],
                "九江":[115.97,29.71],
                "邯郸":[114.47,36.6],
                "临安":[119.72,30.23],
                "兰州":[103.73,36.03],
                "沧州":[116.83,38.33],
                "临沂":[118.35,35.05],
                "南充":[106.110698,30.837793],
                "天津":[117.2,39.13],
                "富阳":[119.95,30.07],
                "泰安":[117.13,36.18],
                "诸暨":[120.23,29.71],
                "郑州":[113.65,34.76],
                "哈尔滨":[126.63,45.75],
                "聊城":[115.97,36.45],
                "芜湖":[118.38,31.33],
                "唐山":[118.02,39.63],
                "平顶山":[113.29,33.75],
                "邢台":[114.48,37.05],
                "德州":[116.29,37.45],
                "济宁":[116.59,35.38],
                "荆州":[112.239741,30.335165],
                "宜昌":[111.3,30.7],
                "义乌":[120.06,29.32],
                "丽水":[119.92,28.45],
                "洛阳":[112.44,34.7],
                "秦皇岛":[119.57,39.95],
                "株洲":[113.16,27.83],
                "石家庄":[114.48,38.03],
                "莱芜":[117.67,36.19],
                "常德":[111.69,29.05],
                "保定":[115.48,38.85],
                "湘潭":[112.91,27.87],
                "金华":[119.64,29.12],
                "岳阳":[113.09,29.37],
                "长沙":[113,28.21],
                "衢州":[118.88,28.97],
                "廊坊":[116.7,39.53],
                "菏泽":[115.480656,35.23375],
                "合肥":[117.27,31.86],
                "武汉":[114.31,30.52],
                "大庆":[125.03,46.58]
            };
            var res = [];
            // console.log(data)
            if(data.length>0){
                for(var i = 0;i<data.length;i++){
                    var geo = geoCoord[data[i].name];
                    if(geo){
                        res.push({
                            name:data[i].name,
                            value:geo.concat(data[i].value)
                        })
                    }
                }
                return res;
            }
        },
        convertHackData:function(data){
            var geoCoord = {
                '黑龙江省':[127.642464,45.756967],
                '广东省':[114.280637,23.125178],
                '台湾':[122.009062,25.044332],
                '广西壮族自治区':[109.320004,22.82402],
                '江苏省':[119.767413,32.041544],
                '浙江省':[121.153576,29.287459],
                '贵州省':[107.713478,26.578343],
                '江西省':[116.892151,28.676493],
                '西藏自治区':[92.132212,29.660361],
                '河南省':[114.665412,34.757975],
                '陕西省':[109.948024,34.263161],
                '山西省':[113.549248,37.857014],
                '云南省':[103.712251,25.040609],
                '内蒙古自治区':[112.670801,40.818311],
                '山东省':[118.000923,36.675807],
                '香港特别行政区':[114.173355,22.320048],
                '澳门特别行政区':[113.54909,22.198951],
                '北京':[115.805285,39.904989],
                '天津':[117.590182,39.125596],
                '上海':[122.072644,31.231706],
                '河北省':[115.502461,38.045474],
                '福建省':[118.306239,26.075302],
                '海南省':[110.53119,20.031971],
                '重庆':[107.504962,29.533155],
                '四川省':[105.065735,30.659462],
                '甘肃省':[104.823557,36.058039],
                '安徽省':[118.283042,31.86119],
                '湖北省':[115.298572,30.584355],
                '青海省':[100.778916,36.623178],
                '辽宁省':[124.429096,41.796767],
                '湖南省':[113.982279,28.19409],
                '宁夏回族自治区':[106.278179,37.46637],
                '新疆维吾尔自治区':[88.617733,43.792818],
                '吉林省':[126.3245,43.886841],

                // '黑龙江省':[126.642464,45.756967],
                // '广东省':[113.280637,23.125178],
                // '台湾':[121.509062,25.044332],
                // '广西壮族自治区':[108.320004,22.82402],
                // '江苏省':[118.767413,32.041544],
                // '浙江省':[120.153576,30.287459],
                // '贵州省':[106.713478,26.578343],
                // '江西省':[115.892151,28.676493],
                // '西藏自治区':[91.132212,29.660361],
                // '河南省':[113.665412,34.757975],
                // '陕西省':[108.948024,34.263161],
                // '山西省':[112.549248,37.857014],
                // '云南省':[102.712251,25.040609],
                // '内蒙古自治区':[111.670801,40.818311],
                // '山东省':[117.000923,36.675807],
                // '香港特别行政区':[114.173355,22.320048],
                // '澳门特别行政区':[113.54909,22.198951],
                // '北京':[116.405285,39.904989],
                // '天津':[117.190182,39.125596],
                // '河北省':[114.502461,38.045474],
                // '福建省':[119.306239,26.075302],
                // '海南省':[110.33119,20.031971],
                // '重庆':[106.504962,29.533155],
                // '四川省':[104.065735,30.659462],
                // '甘肃省':[103.823557,36.058039],
                // '安徽省':[117.283042,31.86119],
                // '湖北省':[114.298572,30.584355],
                // '青海省':[101.778916,36.623178],
                // '辽宁省':[123.429096,41.796767],
                // '湖南省':[112.982279,28.19409],
                // '宁夏回族自治区':[106.278179,38.46637],
                // '新疆维吾尔自治区':[87.617733,43.792818],
                // '吉林省':[125.3245,43.886841],
                '鹤岗':[130.3,47.33],
                '绥化':[127,46.63],
                '双鸭山市':[131.17,46.65],
                '伊春':[128.92,47.73],
                

                "海门":[121.15,31.89],
                "鄂尔多斯":[109.781327,39.608266],
                "招远":[120.38,37.35],
                "舟山":[122.207216,29.985295],
                "齐齐哈尔":[123.97,47.33],
                "盐城":[120.13,33.38],
                "赤峰":[118.87,42.28],
                "青岛":[120.33,36.07],
                "乳山":[121.52,36.89],
                "金昌":[102.188043,38.520089],
                "泉州":[118.58,24.93],
                "莱西":[120.53,36.86],
                "日照":[119.46,35.42],
                "胶南":[119.97,35.88],
                "南通":[121.05,32.08],
                "拉萨":[91.11,29.97],
                "云浮":[112.02,22.93],
                "梅州":[116.1,24.55],
                "文登":[122.05,37.2],
                // "上海":[121.48,31.22],
                "攀枝花":[101.718637,26.582347],
                "威海":[122.1,37.5],
                "承德":[117.93,40.97],
                "厦门":[118.1,24.46],
                "汕尾":[115.375279,22.786211],
                "潮州":[116.63,23.68],
                "丹东":[124.37,40.13],
                "太仓":[121.1,31.45],
                "曲靖":[103.79,25.51],
                "烟台":[121.39,37.52],
                "福州":[119.3,26.08],
                "瓦房店":[121.979603,39.627114],
                "即墨":[120.45,36.38],
                "抚顺":[123.97,41.97],
                "玉溪":[102.52,24.35],
                "张家口":[114.87,40.82],
                "阳泉":[113.57,37.85],
                "莱州":[119.942327,37.177017],
                "湖州":[120.1,30.86],
                "汕头":[116.89,23.39],
                "昆山":[120.95,31.39],
                "宁波":[121.56,29.86],
                "湛江":[110.559377,21.270708],
                "揭阳":[116.35,23.55],
                "荣成":[122.41,37.16],
                "连云港":[119.16,34.59],
                "葫芦岛":[120.836932,40.711052],
                "常熟":[120.74,31.64],
                "东莞":[113.95,23.04],
                "河源":[114.68,23.73],
                "淮安":[119.15,33.5],
                "泰州":[119.9,32.49],
                "南宁":[108.33,22.84],
                "营口":[122.18,40.65],
                "惠州":[114.4,23.09],
                "江阴":[120.26,31.91],
                "蓬莱":[120.75,37.8],
                "韶关":[113.62,24.84],
                "嘉峪关":[98.289152,39.77313],
                "广州":[113.23,23.16],
                "延安":[109.47,36.6],
                "太原":[112.53,37.87],
                "清远":[113.01,23.7],
                "中山":[113.38,22.52],
                "昆明":[102.73,25.04],
                "寿光":[118.73,36.86],
                "盘锦":[122.070714,41.119997],
                "长治":[113.08,36.18],
                "深圳":[114.07,22.62],
                "珠海":[113.52,22.3],
                "宿迁":[118.3,33.96],
                "咸阳":[108.72,34.36],
                "铜川":[109.11,35.09],
                "平度":[119.97,36.77],
                "佛山":[113.11,23.05],
                "海口":[110.35,20.02],
                "江门":[113.06,22.61],
                "章丘":[117.53,36.72],
                "肇庆":[112.44,23.05],
                "大连":[121.62,38.92],
                "临汾":[111.5,36.08],
                "吴江":[120.63,31.16],
                "石嘴山":[106.39,39.04],
                "沈阳":[123.38,41.8],
                "苏州":[120.62,31.32],
                "茂名":[110.88,21.68],
                "嘉兴":[120.76,30.77],
                "长春":[125.35,43.88],
                "胶州":[120.03336,36.264622],
                "银川":[106.27,38.47],
                "张家港":[120.555821,31.875428],
                "三门峡":[111.19,34.76],
                "锦州":[121.15,41.13],
                "南昌":[115.89,28.68],
                "柳州":[109.4,24.33],
                "三亚":[109.511909,18.252847],
                "自贡":[104.778442,29.33903],
                "吉林":[126.57,43.87],
                "阳江":[111.95,21.85],
                "泸州":[105.39,28.91],
                "西宁":[101.74,36.56],
                "宜宾":[104.56,29.77],
                "呼和浩特":[111.65,40.82],
                "成都":[104.06,30.67],
                "大同":[113.3,40.12],
                "镇江":[119.44,32.2],
                "桂林":[110.28,25.29],
                "张家界":[110.479191,29.117096],
                "宜兴":[119.82,31.36],
                "北海":[109.12,21.49],
                "西安":[108.95,34.27],
                "金坛":[119.56,31.74],
                "东营":[118.49,37.46],
                "牡丹江":[129.58,44.6],
                "遵义":[106.9,27.7],
                "绍兴":[120.58,30.01],
                "扬州":[119.42,32.39],
                "常州":[119.95,31.79],
                "潍坊":[119.1,36.62],
                // "重庆":[106.54,29.59],
                "台州":[121.420757,28.656386],
                "南京":[118.78,32.04],
                "滨州":[118.03,37.36],
                "贵阳":[106.71,26.57],
                "无锡":[120.29,31.59],
                "本溪":[123.73,41.3],
                "克拉玛依":[84.77,45.59],
                "渭南":[109.5,34.52],
                "马鞍山":[118.48,31.56],
                "宝鸡":[107.15,34.38],
                "焦作":[113.21,35.24],
                "句容":[119.16,31.95],
                // "北京":[116.46,39.92],
                "徐州":[117.2,34.26],
                "衡水":[115.72,37.72],
                "包头":[110,40.58],
                "绵阳":[104.73,31.48],
                "乌鲁木齐":[87.68,43.77],
                "枣庄":[117.57,34.86],
                "杭州":[120.19,30.26],
                "淄博":[118.05,36.78],
                "鞍山":[122.85,41.12],
                "溧阳":[119.48,31.43],
                "库尔勒":[86.06,41.68],
                "安阳":[114.35,36.1],
                "开封":[114.35,34.79],
                "济南":[117,36.65],
                "德阳":[104.37,31.13],
                "温州":[120.65,28.01],
                "九江":[115.97,29.71],
                "邯郸":[114.47,36.6],
                "临安":[119.72,30.23],
                "兰州":[103.73,36.03],
                "沧州":[116.83,38.33],
                "临沂":[118.35,35.05],
                "南充":[106.110698,30.837793],
                // "天津":[117.2,39.13],
                "富阳":[119.95,30.07],
                "泰安":[117.13,36.18],
                "诸暨":[120.23,29.71],
                "郑州":[113.65,34.76],
                "哈尔滨":[126.63,45.75],
                "聊城":[115.97,36.45],
                "芜湖":[118.38,31.33],
                "唐山":[118.02,39.63],
                "平顶山":[113.29,33.75],
                "邢台":[114.48,37.05],
                "德州":[116.29,37.45],
                "济宁":[116.59,35.38],
                "荆州":[112.239741,30.335165],
                "宜昌":[111.3,30.7],
                "义乌":[120.06,29.32],
                "丽水":[119.92,28.45],
                "洛阳":[112.44,34.7],
                "秦皇岛":[119.57,39.95],
                "株洲":[113.16,27.83],
                "石家庄":[114.48,38.03],
                "莱芜":[117.67,36.19],
                "常德":[111.69,29.05],
                "保定":[115.48,38.85],
                "湘潭":[112.91,27.87],
                "金华":[119.64,29.12],
                "岳阳":[113.09,29.37],
                "长沙":[113,28.21],
                "衢州":[118.88,28.97],
                "廊坊":[116.7,39.53],
                "菏泽":[115.480656,35.23375],
                "合肥":[117.27,31.86],
                "武汉":[114.31,30.52],
                "大庆":[125.03,46.58]
            };
            for(var k in geoCoord){
                geoCoord[k][0] = geoCoord[k][0]+0.2
            }
            var res = [];
            if(data.length>0){
                for(var i = 0;i<data.length;i++){
                    var geo = geoCoord[data[i].name];
                    if(geo){
                        res.push({
                            name:data[i].name,
                            value:geo.concat(data[i].value)
                        })
                    }
                }
                return res;
            }
        },
        convertCenterData:function(data){
            var geoCoord = {
                '黑龙江':[127.642464,45.756967],
                '广东':[114.680637,23.625178],
                '台湾':[122.009062,25.044332],
                '广西':[109.320004,22.82402],
                '江苏':[120.567413,32.341544],
                '浙江':[121.153576,29.287459],
                '贵州':[107.713478,26.578343],
                '江西':[116.892151,28.676493],
                '西藏':[92.132212,29.660361],
                '河南':[114.665412,34.757975],
                '陕西':[109.948024,34.263161],
                '山西':[113.549248,37.857014],
                '云南':[103.712251,25.040609],
                '内蒙古':[111.670801,40.818311],
                '山东':[118.000923,36.675807],
                '香港':[114.173355,22.320048],
                '澳门':[113.54909,23.198951],
                '北京':[116.505285,40.404989],
                '天津':[117.590182,39.425596],
                '上海':[122.072644,31.231706],
                '河北':[115.502461,38.045474],
                '福建':[118.306239,26.075302],
                '海南':[110.53119,20.031971],
                '重庆':[107.504962,29.833155],
                '四川':[105.065735,30.659462],
                '甘肃':[104.823557,36.058039],
                '安徽':[118.283042,31.86119],
                '湖北':[115.298572,30.584355],
                '青海':[100.778916,36.623178],
                '辽宁':[124.429096,41.796767],
                '湖南':[112.982279,28.19409],
                '宁夏':[106.278179,37.46637],
                '新疆':[88.617733,43.792818],
                '吉林':[126.3245,43.886841],
                "海门":[121.15,31.89],
                "鄂尔多斯":[109.781327,39.608266],
                "招远":[120.38,37.35],
                "舟山":[122.207216,29.985295],
                "齐齐哈尔":[123.97,47.33],
                "盐城":[120.13,33.38],
                "赤峰":[118.87,42.28],
                "青岛":[120.33,36.07],
                "乳山":[121.52,36.89],
                "金昌":[102.188043,38.520089],
                "泉州":[118.58,24.93],
                "莱西":[120.53,36.86],
                "日照":[119.46,35.42],
                "胶南":[119.97,35.88],
                "南通":[121.05,32.08],
                "拉萨":[91.11,29.97],
                "云浮":[112.02,22.93],
                "梅州":[116.1,24.55],
                "文登":[122.05,37.2],
                // "上海":[121.48,31.22],
                "攀枝花":[101.718637,26.582347],
                "威海":[122.1,37.5],
                "承德":[117.93,40.97],
                "厦门":[118.1,24.46],
                "汕尾":[115.375279,22.786211],
                "潮州":[116.63,23.68],
                "丹东":[124.37,40.13],
                "太仓":[121.1,31.45],
                "曲靖":[103.79,25.51],
                "烟台":[121.39,37.52],
                "福州":[119.3,26.08],
                "瓦房店":[121.979603,39.627114],
                "即墨":[120.45,36.38],
                "抚顺":[123.97,41.97],
                "玉溪":[102.52,24.35],
                "张家口":[114.87,40.82],
                "阳泉":[113.57,37.85],
                "莱州":[119.942327,37.177017],
                "湖州":[120.1,30.86],
                "汕头":[116.89,23.39],
                "昆山":[120.95,31.39],
                "宁波":[121.56,29.86],
                "湛江":[110.559377,21.270708],
                "揭阳":[116.35,23.55],
                "荣成":[122.41,37.16],
                "连云港":[119.16,34.59],
                "葫芦岛":[120.836932,40.711052],
                "常熟":[120.74,31.64],
                "东莞":[113.95,23.04],
                "河源":[114.68,23.73],
                "淮安":[119.15,33.5],
                "泰州":[119.9,32.49],
                "南宁":[108.33,22.84],
                "营口":[122.18,40.65],
                "惠州":[114.4,23.09],
                "江阴":[120.26,31.91],
                "蓬莱":[120.75,37.8],
                "韶关":[113.62,24.84],
                "嘉峪关":[98.289152,39.77313],
                "广州":[113.23,23.16],
                "延安":[109.47,36.6],
                "太原":[112.53,37.87],
                "清远":[113.01,23.7],
                "中山":[113.38,22.52],
                "昆明":[102.73,25.04],
                "寿光":[118.73,36.86],
                "盘锦":[122.070714,41.119997],
                "长治":[113.08,36.18],
                "深圳":[114.07,22.62],
                "珠海":[113.52,22.3],
                "宿迁":[118.3,33.96],
                "咸阳":[108.72,34.36],
                "铜川":[109.11,35.09],
                "平度":[119.97,36.77],
                "佛山":[113.11,23.05],
                "海口":[110.35,20.02],
                "江门":[113.06,22.61],
                "章丘":[117.53,36.72],
                "肇庆":[112.44,23.05],
                "大连":[121.62,38.92],
                "临汾":[111.5,36.08],
                "吴江":[120.63,31.16],
                "石嘴山":[106.39,39.04],
                "沈阳":[123.38,41.8],
                "苏州":[120.62,31.32],
                "茂名":[110.88,21.68],
                "嘉兴":[120.76,30.77],
                "长春":[125.35,43.88],
                "胶州":[120.03336,36.264622],
                "银川":[106.27,38.47],
                "张家港":[120.555821,31.875428],
                "三门峡":[111.19,34.76],
                "锦州":[121.15,41.13],
                "南昌":[115.89,28.68],
                "柳州":[109.4,24.33],
                "三亚":[109.511909,18.252847],
                "自贡":[104.778442,29.33903],
                "吉林":[126.57,43.87],
                "阳江":[111.95,21.85],
                "泸州":[105.39,28.91],
                "西宁":[101.74,36.56],
                "宜宾":[104.56,29.77],
                "呼和浩特":[111.65,40.82],
                "成都":[104.06,30.67],
                "大同":[113.3,40.12],
                "镇江":[119.44,32.2],
                "桂林":[110.28,25.29],
                "张家界":[110.479191,29.117096],
                "宜兴":[119.82,31.36],
                "北海":[109.12,21.49],
                "西安":[108.95,34.27],
                "金坛":[119.56,31.74],
                "东营":[118.49,37.46],
                "牡丹江":[129.58,44.6],
                "遵义":[106.9,27.7],
                "绍兴":[120.58,30.01],
                "扬州":[119.42,32.39],
                "常州":[119.95,31.79],
                "潍坊":[119.1,36.62],
                // "重庆":[106.54,29.59],
                "台州":[121.420757,28.656386],
                "南京":[118.78,32.04],
                "滨州":[118.03,37.36],
                "贵阳":[106.71,26.57],
                "无锡":[120.29,31.59],
                "本溪":[123.73,41.3],
                "克拉玛依":[84.77,45.59],
                "渭南":[109.5,34.52],
                "马鞍山":[118.48,31.56],
                "宝鸡":[107.15,34.38],
                "焦作":[113.21,35.24],
                "句容":[119.16,31.95],
                // "北京":[116.46,39.92],
                "徐州":[117.2,34.26],
                "衡水":[115.72,37.72],
                "包头":[110,40.58],
                "绵阳":[104.73,31.48],
                "乌鲁木齐":[87.68,43.77],
                "枣庄":[117.57,34.86],
                "杭州":[120.19,30.26],
                "淄博":[118.05,36.78],
                "鞍山":[122.85,41.12],
                "溧阳":[119.48,31.43],
                "库尔勒":[86.06,41.68],
                "安阳":[114.35,36.1],
                "开封":[114.35,34.79],
                "济南":[117,36.65],
                "德阳":[104.37,31.13],
                "温州":[120.65,28.01],
                "九江":[115.97,29.71],
                "邯郸":[114.47,36.6],
                "临安":[119.72,30.23],
                "兰州":[103.73,36.03],
                "沧州":[116.83,38.33],
                "临沂":[118.35,35.05],
                "南充":[106.110698,30.837793],
                // "天津":[117.2,39.13],
                "富阳":[119.95,30.07],
                "泰安":[117.13,36.18],
                "诸暨":[120.23,29.71],
                "郑州":[113.65,34.76],
                "哈尔滨":[126.63,45.75],
                "聊城":[115.97,36.45],
                "芜湖":[118.38,31.33],
                "唐山":[118.02,39.63],
                "平顶山":[113.29,33.75],
                "邢台":[114.48,37.05],
                "德州":[116.29,37.45],
                "济宁":[116.59,35.38],
                "荆州":[112.239741,30.335165],
                "宜昌":[111.3,30.7],
                "义乌":[120.06,29.32],
                "丽水":[119.92,28.45],
                "洛阳":[112.44,34.7],
                "秦皇岛":[119.57,39.95],
                "株洲":[113.16,27.83],
                "石家庄":[114.48,38.03],
                "莱芜":[117.67,36.19],
                "常德":[111.69,29.05],
                "保定":[115.48,38.85],
                "湘潭":[112.91,27.87],
                "金华":[119.64,29.12],
                "岳阳":[113.09,29.37],
                "长沙":[113,28.21],
                "衢州":[118.88,28.97],
                "廊坊":[116.7,39.53],
                "菏泽":[115.480656,35.23375],
                "合肥":[117.27,31.86],
                "武汉":[114.31,30.52],
                "大庆":[125.03,46.58]
            };
            for(var k in geoCoord){
                geoCoord[k][1] = geoCoord[k][1]-0.2;
            }
            var res = [];
            if(data.length>0){
                for(var i = 0;i<data.length;i++){
                    var geo = geoCoord[data[i].name];
                    if(geo){
                        res.push({
                            name:data[i].name,
                            value:geo.concat(data[i].value)
                        })
                    }
                }
                return res;
            }
        },
        _changeName:function(data){
            var res = [];
            if(data.length>0){
                data.map(function(item){
                    if(item.name.indexOf('市')>0){
                        item.name = item.name.substring(0,item.name.indexOf('市'));
                    }
                    res.push({
                        name:item.name,
                        value:item.value
                    })
                })
            }
            return res;
        },
        _renderMap:function(){
            $('.map').remove();
            $('.bd-left').append('<div class="map"></div>');
            var self = this,
                maxSizePin = 80,
                minSizePin = 20,
                max = 300,
                min = 10,
                hcMax = 0,
                hcMin = 0,
                dbMax = 0,
                dbMin = 0;
            // var dbData = [
                // {name:'南京',value:100},
                // {name:'北京',value:200},
                // {name:'南宁',value:300}
            // ]
            var hackData = []
            var dbData = []
            var dfd = $.Deferred();
            model.getSysLocations('').then(function(res){
                // console.log(res)
                dfd.resolve(res);
            })
            // console.log(self)
            model.getEach({
                areaCode:commonModel.code,
                startTime:commonModel.startTime,
                endTime:commonModel.endTime
            }).then(function(res){
                // console.log(res)
                var centerData = []
                dfd.then(function(data){
                    // console.log(data)
                    centerData = data;
                })
                // console.log(centerData)
                if(res.hcMap.length>0){
                    res.hcMap.map(function(item){
                        hackData.push({
                            name:item.areaName,
                            value:item.total
                        })
                    })
                }
                // console.log(hackData)
                // var data = [
                //     {name:'北京',value:200},
                //     {name:'青海省',value:300},
                //     {name:'河南省',value:200},
                //     {name:'广州市',value:150}
                // ]
                // hackData = hackData.concat(data);
                hackData = home._changeName(hackData);
                if(res.pbMap.length>0){
                    res.pbMap.map(function(item){
                        dbData.push({
                            name:item.areaName,
                            value:item.total
                        })
                    })
                }
                // dbData = dbData.concat(data);
                dbData = home._changeName(dbData);
                // console.log(dbData)
                hcMax = res.hcMax;
                hcMin = res.hcMin;
                dbMax = res.pbMax;
                dbMin = res.pbMin;
                var myChart = echarts.init($('.map')[0]);
                myChart.clear();
                myChart.showLoading({
                    text:'加载中...',
                });
                var self = this;
                $.get('/echarts/map/json/china.json',function(chinaJson){
                    // console.log(chinaJson)
                    var areaCode = [];
                    chinaJson.features.map(function(item){
                        areaCode.push({
                            name:item.properties.name,
                            code:item.id
                        })
                    })
                    var center = [];
                    areaCode.map(function(item){
                        centerData.map(function(item1){
                            if(item1.areaCode == item.code){
                                center.push({
                                    name:item.name,
                                    // value:100
                                })
                            }
                        })
                    })
                    center = home._changeName(center)
                    // console.log(center)
                    var option = {
                        tooltip : {
                            show:false,
                            trigger: 'item'
                        },
                        legend: {
                            show:false,
                            orient: 'vertical',
                            x:'left',
                            data:['pm2.5']
                        },
                        // dataRange: {
                        //    show:false,
                        //     min : 0,
                        //     max : 500,
                        //     calculable : true,
                        //     color: ['maroon','purple','red','orange','yellow','rgb(252, 253, 255)']
                        // },
                        geo:{
                            show:true,
                            map:'china',
                            roam:false,
                            // zoom:1.2,
                            // layoutCenter:[],
                            // layoutSize:'210%',
                            // itemStyle:{
                            //     normal:{
                            //         areaColor:'red',
                            //         borderColor:'#96bed7',
                            //         borderWidth:2,
                            //     },
                            //     emphasis:{
                            //         areaColor:'red',
                            //     }
                            // }
                        },
                        series : [
                            {
                                name: '',
                                type: 'map',
                                mapType: 'china',
                                hoverable: false,
                                roam:false,
                                data : [],
                                // layoutSize:'500%',
                                label:{
                                    normal:{
                                        show:true
                                    },
                                    emphasis:{
                                        show:true
                                    }
                                },
                                itemStyle:{
                                    normal:{
                                        areaColor:'rgb(215, 243, 252)',
                                        borderColor:'rgba(161, 176, 191,1)',
                                        borderWidth:1,
                                    },
                                    emphasis:{
                                        areaColor:'yellow',
                                        type:'default'
                                    }
                                },
                                data:[
                                    // {name:'北京',value:500}
                                ]
                            },
                            {
                                name:'center',
                                type:'scatter',
                                coordinateSystem:'geo',
                                // data:[{name:'河南省',value:100}],
                                data:home.convertCenterData(center),
                                symbol:'image://../images/d_08.png',
                                symbolSize:24,
                                zlevel:1
                            },
                            {
                                name:'db',
                                type:'scatter',
                                coordinateSystem:'geo',
                                symbol:'pin',
                                symbolSize:function(val){
                                    // console.log(val)
                                    // return val
                                    var a = (maxSizePin - minSizePin)/(dbMax - dbMin);
                                    var b = maxSizePin - a*dbMax;
                                    return a*val[2] + b;
                                },
                                label:{
                                    normal:{
                                        show:true,
                                        textStyle:{
                                            color:'#fff',
                                        }
                                    }
                                },
                                itemStyle:{
                                    normal:{
                                        color:'#d56033',
                                        opacity:0.8
                                    }
                                },
                                zlevel:6,
                                data:home.convertData(dbData)
                            },
                            {
                                name:'top5',
                                type:'effectScatter',
                                coordinateSystem:'geo',
                                data:home.convertData(dbData.sort(function(a,b){return b.value - a.value}).slice(0,0)),
                                symbolSize:function(val){
                                    return (parseInt(val[2])+100)/10
                                },
                                showEffectOn:"render",
                                rippleEffect:{
                                    brushType:'stroke'
                                },
                                hoverAnimation:true,
                                itemStyle:{
                                    normal:{
                                        color:'#e24936',
                                        shadowBlur:10,
                                        shadowColor:'#e24936'
                                    }
                                },
                                zlevel:1
                            },
                            {
                                name:'hc',
                                type:'scatter',
                                coordinateSystem:'geo',
                                symbol:'pin',
                                symbolSize:function(val){
                                    // console.log(val)
                                    // return val
                                    var a = (maxSizePin - minSizePin)/(hcMax - hcMin);
                                    var b = maxSizePin - a*hcMax;
                                    return a*val[2] + b;
                                },
                                label:{
                                    normal:{
                                        show:true,
                                        textStyle:{
                                            color:'#fff',
                                        }
                                    }
                                },
                                itemStyle:{
                                    normal:{
                                        color:'#098bff',
                                        opacity:0.8
                                    }
                                },
                                zlevel:6,
                                data:home.convertHackData(hackData)
                            },
                            // {
                            //     name: '',
                            //     type: 'map',
                            //     mapType: 'china',
                            //     data:[],
                                // markPoint : {
                                //     symbol:'emptyCircle',
                                //     symbolSize : function (v){
                                //         return 10 + v/100
                                //     },
                                //     effect : {
                                //         show: true,
                                //         shadowBlur : 0
                                //     },
                                //     itemStyle:{
                                //         normal:{
                                //             label:{show:true}
                                //         }
                                //     },
                                //     data : [
                                //         {name: "廊坊", value: 19.3},
                                //         {name: "菏泽", value: 194},
                                //         {name: "合肥", value: 229},
                                //         {name: "武汉", value: 273},
                                //         {name: "大庆", value: 279},
                                //         {name:'乌鲁木齐',value:280},
                                //         {name:'拉萨',value:300}
                                //     ]
                                // }
                            // }
                        ]
                    };
                    // console.log(center)
                    // console.log(areaCode)
                    myChart.hideLoading();
                    echarts.registerMap('china',chinaJson);
                    myChart.setOption(option);
                    myChart.on('click',function(data){
                        // console.log(data.name)
                        
                        // console.log(data)
                        // var code = '';
                        // console.log(data)
                        // console.log(areaCode)
                        var proName = ''; 
                        var code = '';
                        areaCode.map(function(item){
                            if(data.name == item.name){
                                // console.log(item.name)
                                commonModel.code = item.code
                            }
                            if(data.name.indexOf(item.name)>-1){
                                code = item.code
                            }
                        })
                        // console.log('////////////////')
                        // console.log(code)
                        
                        // console.log(commonModel.code)
                        // console.log(code)
                        switch (data.name){
                            case '安徽':
                                proName='anhui';
                                break;
                            case '澳门':
                                proName='aomen';
                                break;
                            case '北京':
                                proName='beijing';
                                break;
                            case '重庆':
                                proName='chongqing';
                                break;
                            case '福建':
                                proName='fujian';
                                break;
                            case '甘肃':
                                proName='gansu';
                                break;
                           
                            case '广西':
                                proName='guangxi';
                                break;
                            case '贵州':
                                proName='guizhou';
                                break;
                            case '海南':
                                proName='hainan';
                                break;
                            case '河北':
                                proName='hebei';
                                break;
                            case '黑龙江':
                                proName='heilongjiang';
                                break;
                            case '河南':
                                proName='henan';
                                break;
                            case '湖北':
                                proName='hubei';
                                break;
                            case '湖南':
                                proName='hunan';
                                break;
                            case '江西':
                                proName='jiangxi';
                                break;
                            case '吉林':
                                proName='jilin';
                                break;
                            case '辽宁':
                                proName='liaoning';
                                break;
                            case '内蒙古':
                                proName='neimenggu';
                                break;
                            case '宁夏':
                                proName='ningxia';
                                break;
                            case '青海':
                                proName='qinghai';
                                break;
                            case '山东':
                                proName='shandong';
                                break;
                            case '上海':
                                proName='shanghai';
                                break;
                            case '山西':
                                proName='shanxi';
                                break;
                            case '陕西':
                                proName='shanxi1';
                                break;
                            case '四川':
                                proName='sichuan';
                                break;
                            case '天津':
                                proName='tianjin';
                                break;
                            case '香港':
                                proName='xianggang';
                                break;
                            case '新疆':
                                proName='xinjiang';
                                break;
                            case '西藏':
                                proName='xizang';
                                break;
                            case '云南':
                                proName='yunnan';
                                break;
                            case '浙江':
                                proName='zhejiang';
                                break;
                            case '广东':
                                proName='guangdong';
                                // commonModel.code = '440000';
                                break;
                            case '江苏':
                                proName='jiangsu';
                                // commonModel.code = '320000';
                                break;
                            default:
                                proName = '';
                        }
                        if(data.seriesName == 'center'){
                            if(centerData[data.dataIndex].systemLink){
                                window.open(centerData[data.dataIndex].systemLink)
                            }else{
                                $('.map').remove();
                                $('.back').removeClass('hide');
                                // console.log(commonModel.code)
                                commonModel.show = false;
                                commonModel.name = proName;
                                home._renderProviceMap(proName);
                                home._renderLine();
                                home._renderdbNumber();
                                home._renderPie();
                                home._renderTop5Data();
                            }
                        }else if(proName != ''){
                            // $('.map').addClass('hide');
                            // $('.province').removeClass('hide');
                            $('.map').remove();
                            $('.back').removeClass('hide');
                            // console.log(commonModel.code)
                            commonModel.show = false;
                            commonModel.name = proName;
                            home._renderProviceMap(proName);
                            home._renderLine();
                            home._renderdbNumber();
                            home._renderPie();
                            home._renderTop5Data();
                        }else if(data.seriesName == 'db'){
                            home._detail('db','','',code,'');
                        }else if(data.seriesName == 'hc'){
                            home._detail('hc','','',code,'');
                        }else{
                            return;
                        }
                        // province.map(function(item){
                        //     if(data.name == item.name){
                        //         self._renderProviceMap(item.py);
                        //     }
                        // })
                    })
                    myChart.on('mouseover',function(data){
                        // console.log(data)
                        if(data.seriesName == 'center'){
                            console.log(data)
                            console.log(centerData)
                            $('.bd-left').append('<span class="centerTitle">'+centerData[data.dataIndex].systemName+'</span>');
                            $('.centerTitle').css({
                                'display':'inline-block',
                                'position':'absolute',
                                'top':data.event.offsetY-20,
                                'left':data.event.offsetX+10,
                                'color':'#000',
                                'z-index':10000,
                                'background':'#fff',
                                'padding':'2px'
                            })
                        }else{
                            $('.centerTitle').remove()
                        }
                    })
                })
            })
           
        },
        _renderProviceMap:function(name){
            var self = this;
            $('.province').remove();
            $('.bd-left').append('<div class="province"></div>');
            var myChart = echarts.init($('.province')[0]);
            myChart.clear();
            myChart.showLoading({
                text:'加载中...'
            });
            var dfd = $.Deferred();
            // console.log(commonModel.code)
            model.getSysLocations(commonModel.code).then(function(res){
                // console.log(res)
                dfd.resolve(res);
            })
            model.getEach({
                areaCode:commonModel.code,
                startTime:commonModel.startTime,
                endTime:commonModel.endTime
            }).then(function(res){
                // console.log(data)
                maxSizePin = 80,
                minSizePin = 20,
                hackData = [],
                dbData = [],
                max = 300,
                min = 10;
                var centerData = [];
                dfd.then(function(data){
                    console.log(data)
                    centerData = data;
                })
                if(res.hcMap.length>0){
                    res.hcMap.map(function(item){
                        hackData.push({
                            name:item.areaName,
                            value:item.total
                        })
                    })
                }
                
                // var data = [
                //     {name:'东莞',value:200},
                //     {name:'湛江',value:300},
                //     {name:'汕头',value:200},
                // ]
                // hackData = hackData.concat(data);
                hackData = home._changeName(hackData);
                if(res.pbMap.length>0){
                    res.pbMap.map(function(item){
                        dbData.push({
                            name:item.areaName,
                            value:item.total
                        })
                    })
                }
                // dbData = dbData.concat(data);
                dbData = home._changeName(dbData);
                // console.log(hackData);
                hcMax = res.hcMax;
                hcMin = res.hcMin;
                dbMax = res.pbMax;
                dbMin = res.pbMin;
                // console.log(hackData)
               
                $.get('/echarts/map/json/province/'+name+'.json',function(dataJson){
                    myChart.hideLoading();
                    var areaCode = [];
                    // console.log(dataJson)
                    dataJson.features.map(function(item){
                        areaCode.push({
                            name:item.properties.name,
                            code:item.id
                        })
                    })
                    var center = []
                    areaCode.map(function(item){
                        centerData.map(function(item1){
                            if(item1.areaCode == item.code){
                                center.push({
                                    name:item.name,
                                    value:100
                                })
                            }
                        })
                    })
                    center = home._changeName(center)
                    // console.log(center)

                    var option = {
                        tooltip : {
                            show:false,
                            trigger: 'item'
                        },
                        legend: {
                            show:false,
                            orient: 'vertical',
                            x:'left',
                            data:['pm2.5']
                        },
                        // dataRange: {
                        //    show:false,
                        //     min : 0,
                        //     max : 500,
                        //     calculable : true,
                        //     color: ['maroon','purple','red','orange','yellow','rgb(252, 253, 255)']
                        // },
                        geo:{
                            show:true,
                            map:name,
                            roam:false,
                            // zoom:1.2,
                            layoutCenter:["50%","48%"],
                            layoutSize:"80%",
                            label:{
                                show:true
                            },
                            itemStyle:{
                                normal:{
                                    areaColor:'rgb(215, 243, 252)',
                                    borderColor:'rgb(161, 176, 191)',
                                    borderWidth:2,
                                },
                                emphasis:{
                                    areaColor:'yellow',
                                }
                            }
                        },
                        series : [
                            {
                                name: '',
                                type: 'map',
                                mapType: name,
                                hoverable: false,
                                roam:false,
                                data : [],
                                layoutCenter:["50%","48%"],
                                layoutSize:"80%",
                                // layoutSize:'500%',
                                label:{
                                    normal:{
                                        show:true
                                    },
                                    emphasis:{
                                        show:true
                                    }
                                },
                                itemStyle:{
                                    normal:{
                                        areaColor:'rgb(215, 243, 252)',
                                        borderColor:'rgba(161, 176, 191,1)',
                                        borderWidth:2,
                                    },
                                    emphasis:{
                                        areaColor:'yellow',
                                        type:'default'
                                    }
                                },
                                data:[
                                    // {name:'北京',value:500}
                                ]
                            },
                            {
                                name:'center',
                                type:'scatter',
                                coordinateSystem:'geo',
                                data:home.convertCenterData(center),
                                symbol:'image://../images/d_08.png',
                                symbolSize:24,
                                zlevel:1
                            },
                            {
                                name:'hc',
                                type:'scatter',
                                coordinateSystem:'geo',
                                symbol:'pin',
                                symbolSize:function(val){
                                    // console.log(val)
                                    // return val
                                    var a = (maxSizePin - minSizePin)/(hcMax - hcMin);
                                    var b = maxSizePin - a*hcMax;
                                    return a*val[2] + b;
                                },
                                label:{
                                    normal:{
                                        show:true,
                                        textStyle:{
                                            color:'#fff',
                                        }
                                    }
                                },
                                itemStyle:{
                                    normal:{
                                        color:'#098bff',
                                        opacity:0.8
                                    }
                                },
                                zlevel:6,
                                data:home.convertHackData(hackData)
                            },
                            {
                                name:'top5',
                                type:'effectScatter',
                                coordinateSystem:'geo',
                                data:self.convertHackData(hackData.sort(function(a,b){return b.value - a.value}).slice(0,0)),
                                symbolSize:function(val){
                                    return (parseInt(val[2])+100)/10
                                },
                                showEffectOn:"render",
                                rippleEffect:{
                                    brushType:'stroke'
                                },
                                hoverAnimation:true,
                                itemStyle:{
                                    normal:{
                                        color:'#e24936',
                                        shadowBlur:10,
                                        shadowColor:'#e24936'
                                    }
                                },
                                zlevel:1
                            },
                            {
                                name:'db',
                                type:'scatter',
                                coordinateSystem:'geo',
                                symbol:'pin',
                                symbolSize:function(val){
                                    // console.log(val)
                                    // return val
                                    var a = (maxSizePin - minSizePin)/(dbMax - dbMin);
                                    var b = maxSizePin - a*dbMax;
                                    return a*val[2] + b;
                                },
                                label:{
                                    normal:{
                                        show:true,
                                        textStyle:{
                                            color:'#fff',
                                        }
                                    }
                                },
                                itemStyle:{
                                    normal:{
                                        color:'#d56033',
                                        opacity:0.8
                                    }
                                },
                                zlevel:6,
                                data:home.convertData(dbData)
                            },
                        ]
                    };
                    echarts.registerMap(name,dataJson);
                    myChart.setOption(option);
                    myChart.on('click',function(data){
                        // console.log(data.name);
                        // console.log(areaCode)
                        var code = '';
                        areaCode.map(function(item){
                            if(item.name.indexOf(data.name)>-1){
                                code = item.code
                            }
                        })
                        if(data.seriesName == 'center'){
                            if(centerData[data.dataIndex].systemLink){
                                window.open(centerData[data.dataIndex].systemLink)
                            }
                        }else if(data.seriesName == 'db'){
                            home._detail('db','','',code,'');

                        }else if(data.seriesName == 'hc'){
                            home._detail('hc','','',code,'');

                        }else{
                            // console.log('aaaaaaaa')
                            return;
                        }
                    })
                    myChart.on('mouseover',function(data){
                        // console.log(data)
                        if(data.seriesName == 'center'){
                            // console.log(data)
                            // console.log(centerData)
                            $('.bd-left').append('<span class="centerTitle">'+centerData[data.dataIndex].systemName+'</span>');
                            $('.centerTitle').css({
                                'display':'inline-block',
                                'position':'absolute',
                                'top':data.event.offsetY-20,
                                'left':data.event.offsetX+10,
                                'color':'#000',
                                'z-index':10000,
                                'background':'#fff',
                                'padding':'2px'
                            })
                        }else{
                            $('.centerTitle').remove()
                        }
                    })
                })
            })
           
            
        },
        _renderLine:function(){
            var self = this;
            $('.line').remove();
            $('.bd-right-top').append('<div class="line"></div>')
            model.getSplit({
                areaCode:commonModel.code,
                startTime:commonModel.startTime,
                endTime:commonModel.endTime
            }).then(function(res){
                // console.log(res)
                var xData = [];
                var dbData = [];
                var hcData = [];
                var timeArr = [];
                xData = res.timeArray;
                dbData = res.pbInterval;
                hcData = res.hcInterval;
                timeArr = res.timeArrayLong;
                var option = {
                    color:['rgb(225, 72, 56)','rgb(9, 140, 254)'],
                    tooltip:{
                        trigger:'axis',
                    },
                    legend: {
                        x:'70%',
                        y:0,
                        data:[
                            {
                                name:'等保情报',
                                icon:'line',
                                textStyle:{
                                    color:'rgb(225, 72, 56)'
                                },
                            },
                            {
                                name:'黑客线索',
                                icon:'line',
                                textStyle:{
                                    color:'rgb(9, 140, 254)'
                                },
                            },
                        ],
                    },
                    calculable : true,
                    grid:{
                        // show:false,
                        // borderWidth:0
                        top:'10%',
                        left:'15%',
                        right:'5%',
                        bottom:'28%'
                    },
                    xAxis : [
                        {
                            type : 'category',
                            boundaryGap : false,
                            splitLine:{show:false},
                            axisLine:{
                                show:true,
                                lineStyle:{
                                    color:'rgb(150,150,150)'
                                }
                            },
                            axisLabel:{
                                show:true,
                                interval:0,
                                rotate:30,
                                textStyle:{
                                    fontSize:12,
                                    color:'#000'
                                }
                            },
                            axisTick:{show:false},
                            data:xData
                            // data : ['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月']
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value',
                            axisLine:{
                                show:true,
                                lineStyle:{
                                    color:'rgb(150,150,150)'
                                }
                            },
                            splitLine:{
                                show:false,
                                lineStyle:{
                                    color:'rgb(255, 255, 255)'
                                }
                            },
                            axisTick:{show:false},
                            axisLabel : {
                                // show:false,
                                formatter: '{value}',
                                textStyle:{
                                    fontSize:12,
                                    color:'#000'
                                }
                            }
                        }
                    ],
                    series : [
                        {
                            name:'等保情报',
                            type:'line',
                            // smooth:true,
                            // symbol:'none',
                            itemStyle:{
                                normal:{
                                    areaStyle:{
                                        type:'default'
                                    }
                                }
                                
                            },
                            areaStyle:{
                                normal:{
                                    color: new echarts.graphic.LinearGradient(0,0,0,1,
                                    [
                                        {offset:0,color:'rgb(225, 72, 56)'},
                                        {offset:0.5,color:'rgb(235, 194, 188)'},
                                        {offset:1,color:'rgb(248, 230, 228)'}
                                    ])
                                }
                            },
                            data:dbData
                            // data:[0, 20, 30, 10, 8, 15, 30,40,45,40,30,20],
                           
                        },
                        {
                            name:'黑客线索',
                            type:'line',
                            // smooth:true,
                            // symbol:'none',
                            itemStyle:{
                                normal:{
                                    areaStyle:{
                                        type:'default'
                                    }
                                }
                            },
                            areaStyle:{
                                normal:{
                                    color: new echarts.graphic.LinearGradient(0,0,0,1,
                                    [
                                        {offset:0,color:'rgb(9, 140, 254)'},
                                        {offset:0.5,color:'rgb(195, 225, 253)'},
                                        {offset:1,color:'rgb(210, 232, 254)'}
                                    ])
                                }
                            },
                            data:hcData
                            // data:[0, 30, 45, 30, 20, 30, 20,10,24,30,24,10],
                        }
                    ]
                };
                var mychart = echarts.init($('.line')[0]);
                mychart.setOption(option) ;
                mychart.on('click',function(data){
                    console.log(data)
                    var index = data.dataIndex;
                    var startTime = '';
                    var endTime = '';
                    startTime = timeArr[index];
                    endTime = timeArr[index+1];
                    if(data.seriesName == '等保情报'){
                        self._detail('db',startTime,endTime,'','')
                    }else{
                        self._detail('hc',startTime,endTime,'','')
                    }
                })
            })
            
        },
        _renderPie:function(){
            var self = this;
            $('.pie').remove()
            $('.bd-right-center').append('<div class="pie"></div>')
            var myCharts = echarts.init($('.pie')[0]);
            myCharts.clear();
            model.getScatter({
                areaCode:commonModel.code,
                startTime:commonModel.startTime,
                endTime:commonModel.endTime
            }).then(function(res){
                // console.log(res);
                var arr = [];
                var data = [];
                var value = [];
                for(var k in res){
                    if(!Object.hasOwnProperty(k)){
                        arr.push({
                            name:k,
                            value:res[k]
                        })
                    }
                }
                arr = arr.sort(function(a,b){return b.value - a.value});
                arr.map(function(item){
                    switch(item.name){
                        case 'otherCount':
                            item.name = '中小企业';
                            break;
                        case 'eduCount':
                            item.name = '事业单位';
                            break;
                        default:
                            item.name = '党政机关'
                    }
                     // data:['事业单位','党政机关','中小企业'],
                    data.push(item.name);
                    value.push(item.value)
                })
                var option = {
                    tooltip : {
                        show:false,
                        trigger: 'item',
                        formatter: "{a} <br/>{b} : {c} ({d}%)"
                    },
                    legend: {
                        orient : 'vertical',
                        icon:'circle',
                        x : '70%',
                        y:'center',
                        itemWidth:8,
                        itemHeight:8,
                        itemGap:20,
                        // data:['事业单位','党政机关','中小企业'],
                        data:data,
                        textStyle:{
                            color:'#333'
                        },
                        formatter:function(name){
                            var index = 0;
                            // var data = ['事业单位','党政机关','中小企业'];
                            // var value = [335,210,334];
                            var total = 0;
                            value.forEach(function(item,i){
                                total+=item
                            })
                            data.forEach(function(item,i){
                                if(item == name){
                                    index = i
                                }
                            })
                            if(value[index] == 0){
                                return name +'  '+0
                            }
                            return name + ' '+(value[index]*100/total).toFixed(2)+'%'
                        }
                    },
                    color:['rgb(21, 134, 236)','rgb(251, 150, 120)','rgb(150, 152, 237)'],
                    calculable : false,
                    graphic:{
                        type:'text',
                        left:'center',
                        top:'middle',
                        style:{
                            text:'等保情报',
                            fontSize:14,
                            fill:'rgb(100,100,100)',
                            // fontWeight:'bold'
                        }
                    },
                    series : [
                        {
                            name:'',
                            type:'pie',
                            radius : ['50%', '80%'],
                            // itemStyle : {
                            //     normal : {
                            //         label : {
                            //             show : true,
                            //         },
                            //         labelLine : {
                            //             show : true,
                            //         }
                            //     },
                            //     emphasis : {
                            //         label : {
                            //             show : true,
                            //             position : '',
                            //             background:'#fff',
                            //             borderWidth:0,
                            //             textStyle : {
                            //                 fontSize : '16',
                            //                 fontWeight : 'bold'
                            //             }
                            //         }
                            //     }
                            // },
                            avoidLabelOverlap:false,
                            label:{
                                normal:{
                                    show:false,
                                    position:'center',
                                    formatter:function(res){
                                        // return '{blue|'+res.name+'}\n'+'{white|'+res.value+'%}'
                                        return res.name
                                    },     
                                    // rich:{
                                    //     blue:{
                                    //         color:'rgb(167, 224, 247)',
                                    //         fontSize:16
                                    //     },
                                    //     white:{
                                    //         color:'red',
                                    //         fontSize:20
                                    //     }
                                    // },
                                    textStyle:{
                                        fontSize:20,
                                        // color:'red'
                                    }
                                }
                            },
                            // label:{
                            //     normal:{
                            //         show:false,
                            //         position:'center'
                            //     },
                            //     emphais:{
                            //         show:true,
                            //         textStyle:{
                            //             color:'red',
                            //             fontSize:'30',
                            //             fontWeight:'bold'
                            //         }
                            //     }
                            // },
                            labelLine:{
                                normal:{
                                    show:false
                                }
                            },
                            data:arr
                            // data:[
                            //     {value:335, name:'事业单位'},
                            //     {value:310, name:'党政机关'},
                            //     {value:234, name:'中小企业'},
                            // ]
                        }
                    ]
                };
                
                myCharts.setOption(option) 
                myCharts.on('click',function(data){
                    // console.log(data)
                    var scatter = ''
                    if(data.name == '中小企业'){
                        scatter = 1
                    }else if(data.name == '党政机关'){
                        scatter = 2
                    }else{
                        scatter = 3
                    }
                    home._detail('db','','','',scatter)
                })
            })
               
        },
        _renderTop5Data:function(){
            var self = this;
            model.getTop({
                areaCode:commonModel.code,
                startTime:commonModel.startTime,
                endTime:commonModel.endTime
            }).then(function(data){
                // console.log(data)
                var dbData = [],
                    hackData = [],
                    dbMax = 0,
                    hackMax = 0;
                if(data.pbTop5.length>0){
                    dbMax = data.pbTop5[0].total;
                }else{
                    dbMax = 1
                }
                if(data.hcTop5.length>0){
                    hackMax = data.hcTop5[0].total;
                }else{
                    hackMax = 1
                }

                data.pbTop5.map(function(item){
                    dbData.push({
                        name:item.showArea,
                        value:item.total,
                        areaCode:item.areaCode,
                        length:item.total/dbMax
                    })
                })
                data.hcTop5.map(function(item){
                    hackData.push({
                        name:item.showArea,
                        value:item.total,
                        areaCode:item.areaCode,
                        length:item.total/hackMax
                    })
                })
                // console.log('aaaaaaaaaaaaaa')
                // console.log(dbData);
                // console.log(hackData)
                home._renderDbData(dbData);
                home._renderHackerData(hackData);
            })
        },
        _renderDbData:function(data){
            // console.log(data)
            // var data = [
                // {name:'黑龙江省哈尔滨市',value:81125,length:0.7},
                // {name:'上海市',value:51137,length:0.5},
                // {name:'江苏省南京市',value:1266219,length:1},
                // {name:'江苏省连云港市',value:122513,length:0.9},
                // {name:'广东省珠海市',value:97523,length:0.8},
            // ]
            // var max= 1266219
            // data = data.sort(function(a,b){return b.value - a.value});
            var str = '<ul>'
                +'{{each data as item i}}'
                +'<li>'
                +'{{if i == 0}}'
                +'<span class="first order">{{i+1}}</span>'
                +'{{else if i == 1}}'
                +'<span class="second order">{{i+1}}</span>'
                +'{{else if i == 2}}'
                +'<span class="third order">{{i+1}}</span>'
                +'{{else}}'
                +'<span class="normal order">{{i+1}}</span>'
                +'{{/if}}'
                +'<div><p style="width:calc(100%*({{item.length}}));" data-action="detail" data-type="db" data-code="{{item.areaCode}}"><span>{{item.name}}</span><small>{{item.value}}</small></p></div>'
                +'</li>'
                +'{{/each}}'
                +'</ul>'
            $('.db-data').html(template.compile(str)({data}));
           
        },
        _renderHackerData:function(data){
            // console.log(data)
            // var data = [
            //     {name:'黑龙江省哈尔滨市',value:81125,length:0.7},
            //     {name:'上海市',value:51137,length:0.5},
            //     {name:'江苏省南京市',value:1266219,length:1},
            //     {name:'江苏省连云港市',value:122513,length:0.9},
            //     {name:'广东省珠海市',value:97523,length:0.8},
            // ]
            // var max = 1266219
            // data = data.sort(function(a,b){return b.value - a.value});
            var str = '<ul>'
            +'{{each data as item i}}'
            +'<li>'
            +'{{if i == 0}}'
            +'<span class="first order">{{i+1}}</span>'
            +'{{else if i == 1}}'
            +'<span class="second order">{{i+1}}</span>'
            +'{{else if i == 2}}'
            +'<span class="third order">{{i+1}}</span>'
            +'{{else}}'
            +'<span class="normal order">{{i+1}}</span>'
            +'{{/if}}'
            +'<div><p style="width:calc(100%*({{item.length}}));" data-action="detail" data-type="hc" data-code="{{item.areaCode}}"><span>{{item.name}}</span><small>{{item.value}}</small></p></div>'
            +'</li>'
            +'{{/each}}'
            +'</ul>'
            $('.hacker-data').html(template.compile(str)({data}))
        }
    };
    var commonModel = (function(){
        var obj = {
            date:'',
            startTime:'',
            endTime:'',
            code:'',
            show:true,
            name:''
        }
        return obj;
    })()
    window.commonModel = commonModel;
    return home;
})